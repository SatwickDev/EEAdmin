<!-- Safe Global Floating Header Component without external dependencies -->
<!-- This version avoids recursion errors -->

<!-- Modern Floating Header -->
<div class="floating-header" id="globalFloatingHeader">
    <div class="floating-header-content">
        <!-- Brand Section -->
        <div class="brand-section">
            <div class="logo-container">
                <div class="modern-logo">
                    <svg width="28" height="28" viewBox="0 0 48 48">
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#6366f1"/>
                                <stop offset="50%" style="stop-color:#8b5cf6"/>
                                <stop offset="100%" style="stop-color:#06b6d4"/>
                            </linearGradient>
                        </defs>
                        <g fill="url(#logoGradient)">
                            <rect x="8" y="8" width="8" height="32" rx="3"/>
                            <rect x="8" y="8" width="24" height="8" rx="3"/>
                            <rect x="8" y="20" width="20" height="8" rx="3"/>
                        </g>
                        <g fill="url(#logoGradient)" opacity="0.6">
                            <rect x="20" y="32" width="20" height="2" rx="1"/>
                            <rect x="20" y="36" width="20" height="2" rx="1"/>
                        </g>
                    </svg>
                    <div class="status-pulse"></div>
                </div>
            </div>
            <div class="brand-info">
                <h1 class="brand-title">Finstack</h1>
                <p class="brand-subtitle">Innovation Partners for the Future of Finance</p>
            </div>
        </div>

        <!-- Navigation Pills -->
        <nav class="nav-pills" id="globalNavPills">
            <a href="/" class="nav-pill" data-page="dashboard">
                <i class="mdi mdi-view-dashboard"></i>
                <span>Dashboard</span>
            </a>
            <a href="/analytics" class="nav-pill" data-page="analytics">
                <i class="mdi mdi-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="/ai-chat-pro" class="nav-pill" data-page="ai-chat">
                <i class="mdi mdi-robot"></i>
                <span>AI Agents</span>
            </a>
            <a href="/compliance-results" class="nav-pill" data-page="compliance">
                <i class="mdi mdi-shield-check"></i>
                <span>Compliance</span>
            </a>
            <a href="/forms_dashboard" class="nav-pill" data-page="forms">
                <i class="mdi mdi-file-document-multiple"></i>
                <span>Forms</span>
            </a>
        </nav>

        <!-- Actions -->
        <div class="header-actions">
            <div class="status-indicator-modern">
                <div class="pulse-dot"></div>
                <span>Online</span>
            </div>
            <button onclick="if(typeof goBack !== 'undefined') goBack(); else window.history.back();" class="action-button secondary" title="Go Back">
                <i class="mdi mdi-arrow-left"></i>
                <span class="btn-text">Back</span>
            </button>
            <a href="/" class="action-button secondary" title="Go to Dashboard">
                <i class="mdi mdi-home"></i>
                <span class="btn-text">Home</span>
            </a>
            <button onclick="if(typeof logout !== 'undefined') logout(); else window.location.href='/';" class="action-button primary" title="Logout">
                <i class="mdi mdi-logout"></i>
                <span class="btn-text">Logout</span>
            </button>
        </div>
    </div>
</div>

<script>
// Inline script to avoid external dependencies
(function() {
    'use strict';
    
    // Set active navigation pill based on current page
    document.addEventListener('DOMContentLoaded', function() {
        const currentPath = window.location.pathname;
        const navPills = document.querySelectorAll('#globalNavPills .nav-pill');
        
        navPills.forEach(pill => {
            pill.classList.remove('active');
            const href = pill.getAttribute('href');
            
            if (currentPath === href || 
                (currentPath.includes('trade_finance') && pill.dataset.page === 'forms') ||
                (currentPath.includes('treasury') && pill.dataset.page === 'forms') ||
                (currentPath.includes('cash_management') && pill.dataset.page === 'forms')) {
                pill.classList.add('active');
            }
        });
    });
    
    // Define global functions if not already defined
    if (typeof window.goBack === 'undefined') {
        window.goBack = function() {
            if (document.referrer && document.referrer !== window.location.href) {
                window.history.back();
            } else {
                window.location.href = '/';
            }
        };
    }
    
    if (typeof window.logout === 'undefined') {
        window.logout = function() {
            if (confirm('Are you sure you want to logout?')) {
                fetch('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                })
                .then(response => {
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = '/';
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    window.location.href = '/';
                });
            }
        };
    }
})();
</script>