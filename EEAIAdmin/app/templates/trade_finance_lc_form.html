<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Finance - Import Letter of Credit</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/floating-header.css') }}">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --bg-color: #f8f9fa;
            --text-color: #2d3748;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --focus-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            padding-top: 120px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmZmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyem0wLTE2djJIMjR2LTJoMTJ6Ii8+PC9nPjwvZz48L3N2Zz4=');
            pointer-events: none;
            opacity: 0.5;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Modern Floating Header from index.html */
        .floating-header {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .floating-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 28px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Brand Section */
        .brand-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-container {
            position: relative;
        }

        .modern-logo {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: logoFloat 4s ease-in-out infinite;
        }

        .modern-logo:hover {
            transform: scale(1.05) rotate(2deg);
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(99, 102, 241, 0.1);
        }

        .status-pulse {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.9);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .brand-info h1 {
            font-size: 24px !important;
            font-weight: 800 !important;
            margin: 0 !important;
            background: linear-gradient(135deg, #1e293b, #475569, #64748b);
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            letter-spacing: -0.5px;
        }

        .brand-info p {
            font-size: 13px !important;
            color: rgba(100, 116, 139, 0.8) !important;
            margin: 0 !important;
            font-weight: 500 !important;
        }

        .brand-title {
            font-size: 24px !important;
            font-weight: 800 !important;
            margin: 0 !important;
            background: linear-gradient(135deg, #1e293b, #475569, #64748b);
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            letter-spacing: -0.5px;
        }

        .brand-subtitle {
            font-size: 13px !important;
            color: rgba(100, 116, 139, 0.8) !important;
            margin: 0 !important;
            font-weight: 500 !important;
        }

        /* Navigation Pills */
        .nav-pills {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 4px;
        }

        .nav-pill {
            display: flex !important;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 12px;
            text-decoration: none !important;
            color: rgba(100, 116, 139, 0.8) !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-pill:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(30, 41, 59, 0.9) !important;
            transform: translateY(-1px);
        }

        .nav-pill.active {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #1e293b !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .nav-pill i {
            font-size: 16px;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator-modern {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            color: #059669;
        }

        .pulse-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .action-button {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 10px 18px !important;
            border-radius: 12px !important;
            font-size: 13px !important;
            font-weight: 600 !important;
            text-decoration: none !important;
            border: none !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .action-button.primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 70%, #06b6d4 100%) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .action-button.primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4) !important;
        }

        .action-button.secondary {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #374151 !important;
            border: 1px solid rgba(229, 231, 235, 0.8) !important;
        }

        .action-button.secondary:hover {
            background: rgba(255, 255, 255, 1) !important;
            color: #1f2937 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
        }

        /* Animations */
        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes logoFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-2px);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        .nav-pill.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Main Content Area */
        .main-content {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            color: white;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 15px;
        }

        .form-container {
            background: #ffffff;
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(229, 231, 235, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4, #6366f1);
            background-size: 200% 100%;
            animation: gradientShift 3s linear infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
            font-size: 14px;
        }

        .form-group label .required {
            color: #e53e3e;
            margin-left: 2px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: var(--focus-shadow);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 70%, #06b6d4 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }
        
        /* Enhanced Smart Capture Button - Premium Design */
        .btn-smart-capture {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 70%, #06b6d4 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-smart-capture::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn-smart-capture:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }
        
        .btn-smart-capture:hover::before {
            left: 100%;
        }
        
        .btn-smart-capture i {
            font-size: 20px;
            /* animation removed - static icon for better UX */
        }
        
        /* @keyframes float removed - no floating animations needed */
        
        /* Smart Capture Top Button */
        /* Smart Capture Section - Premium Card */
        .smart-capture-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .smart-capture-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4);
            /* animation removed - no shimmer needed */
        }
        
        /* @keyframes shimmer removed - no animation needed */
        
        .smart-capture-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .smart-capture-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            font-size: 28px;
            /* animation removed - static icon */
        }
        
        /* @keyframes iconPulse removed - no pulsing animation */
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .smart-capture-text h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .smart-capture-text p {
            font-size: 14px;
            color: #64748b;
        }
        
        /* Modal Overlay for Smart Capture - Matching index.html design */
        .smart-capture-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(30, 41, 59, 0.4));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 10000;
            animation: fadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .smart-capture-modal.active {
            display: block;
        }
        
        .smart-capture-iframe-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            max-width: 1400px;
            max-height: 900px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
            backdrop-filter: blur(24px) saturate(1.5);
            -webkit-backdrop-filter: blur(24px) saturate(1.5);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 
                0 24px 48px rgba(99, 102, 241, 0.15),
                0 12px 24px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.5),
                inset 0 0 0 1px rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(229, 231, 235, 0.3);
            animation: slideUpModal 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
        }
        
        @keyframes slideUpModal {
            from {
                transform: translate(-50%, -45%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }
        
        .smart-capture-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(24px) saturate(1.2);
            -webkit-backdrop-filter: blur(24px) saturate(1.2);
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
            border-radius: 24px 24px 0 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 1;
        }
        
        .smart-capture-header-title {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }
        
        .smart-capture-header-title i {
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            position: relative;
        }
        
        .smart-capture-header-title i::before {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .smart-capture-header-title h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #1e293b, #475569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .smart-capture-header-subtitle {
            font-size: 14px;
            color: #64748b;
            margin-top: 2px;
            font-weight: 500;
        }
        
        .smart-capture-close {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            border: 1px solid rgba(229, 231, 235, 0.5);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            color: #64748b;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .smart-capture-close:hover {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
            border-color: transparent;
        }
        
        .smart-capture-close:active {
            transform: scale(0.95);
        }
        
        .smart-capture-iframe {
            width: 100%;
            height: calc(100% - 96px);
            border: none;
            background: #ffffff;
            position: relative;
        }
        
        /* Loading indicator for iframe */
        .smart-capture-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            z-index: 10;
        }
        
        .smart-capture-modal.loading .smart-capture-loading {
            display: flex;
        }
        
        .smart-capture-modal.loading .smart-capture-iframe {
            opacity: 0;
        }
        
        .smart-capture-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .smart-capture-loading-text {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }


        /* Enhanced Chatbot Icon */
        .chatbot-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5); }
            100% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        }
        
        @keyframes slideUpChat {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chatbot-icon:hover {
            transform: scale(1.1);
            animation: none;
        }

        .chatbot-icon i {
            color: white;
            font-size: 26px;
        }

        /* Enhanced Chatbot Overlay */
        .chatbot-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: none;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .chatbot-overlay.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Enhanced Chatbot Window */
        .chatbot-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            height: 650px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            animation: slideUpChat 0.3s ease;
        }

        .chatbot-window.maximized {
            width: 90vw;
            height: 90vh;
            max-width: 1200px;
            max-height: 900px;
        }

        .chatbot-window.minimized {
            height: 60px;
            width: 300px;
            bottom: 30px;
            right: 30px;
            top: auto;
            left: auto;
            transform: none;
        }

        @keyframes slideUpModal {
            from {
                transform: translate(-50%, -45%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        /* Enhanced Chatbot Header */
        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .chatbot-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chatbot-header-left i {
            font-size: 20px;
        }

        .chatbot-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chatbot-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            opacity: 0.9;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Window Controls */
        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .control-btn i {
            font-size: 14px;
        }

        /* Chatbot Body */
        .chatbot-body {
            flex: 1;
            overflow: hidden;
            border-radius: 0 0 16px 16px;
        }

        .chatbot-window.minimized .chatbot-body {
            display: none;
        }

        .chatbot-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Status Messages */
        .status-message {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .status-message.error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }

        .status-message.info {
            background: #bee3f8;
            color: #2c5282;
            border-left: 4px solid #4299e1;
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .chatbot-container {
                width: 90%;
                right: 5%;
                left: 5%;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
            
            .action-buttons-container {
                flex-direction: column;
            }
        }


    </style>
</head>
<body>
    <div id="app">
    <!-- Global Floating Header -->
    {% include 'components/floating_header.html' %}

    <div class="container">
        <div class="main-content">
            <div class="header">
                <h1><i class="fas fa-file-invoice-dollar"></i> Import Letter of Credit</h1>
                <p>Trade Finance - SWIFT MT700 Format</p>
            </div>

            <div class="form-container">
            
            <!-- Enhanced Smart Capture Section -->
            <div class="smart-capture-section">
                <div class="smart-capture-info">
                    <div class="smart-capture-icon">
                        <i class="mdi mdi-scan-helper"></i>
                    </div>
                    <div class="smart-capture-text">
                        <h3>Smart Document Capture</h3>
                        <p>Upload and extract LC information from documents automatically</p>
                    </div>
                </div>
                <button type="button" class="btn btn-smart-capture" onclick="openSmartCapture()">
                    <i class="mdi mdi-scan-helper"></i> 
                    <span>Start Smart Capture</span>
                </button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>

            <form id="lcForm">
                <!-- Basic Information Section -->
                <div class="form-section">
                    <h2 class="section-title">Basic Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="lcNumber">LC Number <span class="required">*</span></label>
                            <input type="text" id="lcNumber" name="lcNumber" required placeholder="e.g., LC2024001">
                        </div>
                        <div class="form-group">
                            <label for="lcType">LC Type <span class="required">*</span></label>
                            <select id="lcType" name="lcType" required>
                                <option value="">Select Type</option>
                                <option value="irrevocable">Irrevocable</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="transferable">Transferable</option>
                                <option value="standby">Standby</option>
                                <option value="revolving">Revolving</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="issueDate">Issue Date <span class="required">*</span></label>
                            <input type="date" id="issueDate" name="issueDate" required>
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date <span class="required">*</span></label>
                            <input type="date" id="expiryDate" name="expiryDate" required>
                        </div>
                    </div>
                </div>

                <!-- Parties Section -->
                <div class="form-section">
                    <h2 class="section-title">Parties Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="applicant">Applicant (50) <span class="required">*</span></label>
                            <input type="text" id="applicant" name="applicant" required placeholder="Importer Name and Address">
                        </div>
                        <div class="form-group">
                            <label for="beneficiary">Beneficiary (59) <span class="required">*</span></label>
                            <input type="text" id="beneficiary" name="beneficiary" required placeholder="Exporter Name and Address">
                        </div>
                        <div class="form-group">
                            <label for="issuingBank">Issuing Bank (51A) <span class="required">*</span></label>
                            <input type="text" id="issuingBank" name="issuingBank" required placeholder="Bank Name and SWIFT Code">
                        </div>
                        <div class="form-group">
                            <label for="advisingBank">Advising Bank (57A)</label>
                            <input type="text" id="advisingBank" name="advisingBank" placeholder="Bank Name and SWIFT Code (Optional)">
                        </div>
                    </div>
                </div>

                <!-- Amount and Payment Section -->
                <div class="form-section">
                    <h2 class="section-title">Amount and Payment Details</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="currency">Currency (32B) <span class="required">*</span></label>
                            <select id="currency" name="currency" required>
                                <option value="">Select Currency</option>
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="JPY">JPY - Japanese Yen</option>
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="AED">AED - UAE Dirham</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount (32B) <span class="required">*</span></label>
                            <input type="number" id="amount" name="amount" required placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="tolerancePercent">Tolerance % (39A)</label>
                            <input type="number" id="tolerancePercent" name="tolerancePercent" placeholder="e.g., 10" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label for="paymentTerms">Payment Terms (42C) <span class="required">*</span></label>
                            <select id="paymentTerms" name="paymentTerms" required>
                                <option value="">Select Terms</option>
                                <option value="sight">At Sight</option>
                                <option value="deferred">Deferred Payment</option>
                                <option value="acceptance">Acceptance</option>
                                <option value="negotiation">Negotiation</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Shipment Details Section -->
                <div class="form-section">
                    <h2 class="section-title">Shipment Details</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="placeOfTaking">Place of Taking in Charge (44E)</label>
                            <input type="text" id="placeOfTaking" name="placeOfTaking" placeholder="Port/City Name">
                        </div>
                        <div class="form-group">
                            <label for="portOfLoading">Port of Loading (44F)</label>
                            <input type="text" id="portOfLoading" name="portOfLoading" placeholder="Port Name">
                        </div>
                        <div class="form-group">
                            <label for="portOfDischarge">Port of Discharge (44B)</label>
                            <input type="text" id="portOfDischarge" name="portOfDischarge" placeholder="Port Name">
                        </div>
                        <div class="form-group">
                            <label for="finalDestination">Final Destination (44A)</label>
                            <input type="text" id="finalDestination" name="finalDestination" placeholder="City/Country">
                        </div>
                        <div class="form-group">
                            <label for="latestShipmentDate">Latest Shipment Date (44C) <span class="required">*</span></label>
                            <input type="date" id="latestShipmentDate" name="latestShipmentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="partialShipment">Partial Shipment (43P)</label>
                            <select id="partialShipment" name="partialShipment">
                                <option value="allowed">Allowed</option>
                                <option value="not_allowed">Not Allowed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transhipment">Transhipment (43T)</label>
                            <select id="transhipment" name="transhipment">
                                <option value="allowed">Allowed</option>
                                <option value="not_allowed">Not Allowed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="incoterms">Incoterms</label>
                            <select id="incoterms" name="incoterms">
                                <option value="">Select Incoterms</option>
                                <option value="EXW">EXW - Ex Works</option>
                                <option value="FOB">FOB - Free On Board</option>
                                <option value="CFR">CFR - Cost and Freight</option>
                                <option value="CIF">CIF - Cost, Insurance and Freight</option>
                                <option value="DDP">DDP - Delivered Duty Paid</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Goods Description Section -->
                <div class="form-section">
                    <h2 class="section-title">Goods Description</h2>
                    <div class="form-group">
                        <label for="goodsDescription">Description of Goods (45A) <span class="required">*</span></label>
                        <textarea id="goodsDescription" name="goodsDescription" required placeholder="Detailed description of goods/services"></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="hsCode">HS Code</label>
                            <input type="text" id="hsCode" name="hsCode" placeholder="Harmonized System Code">
                        </div>
                        <div class="form-group">
                            <label for="quantity">Quantity</label>
                            <input type="text" id="quantity" name="quantity" placeholder="e.g., 1000 units">
                        </div>
                    </div>
                </div>

                <!-- Documents Required Section -->
                <div class="form-section">
                    <h2 class="section-title">Documents Required (46A)</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="commercial_invoice"> Commercial Invoice
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="bill_of_lading"> Bill of Lading
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="packing_list"> Packing List
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="certificate_of_origin"> Certificate of Origin
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="insurance_certificate"> Insurance Certificate
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="documents" value="inspection_certificate"> Inspection Certificate
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="additionalDocuments">Additional Documents</label>
                        <textarea id="additionalDocuments" name="additionalDocuments" placeholder="Specify any additional documents required"></textarea>
                    </div>
                </div>

                <!-- Additional Conditions Section -->
                <div class="form-section">
                    <h2 class="section-title">Additional Conditions</h2>
                    <div class="form-group">
                        <label for="additionalConditions">Additional Conditions (47A)</label>
                        <textarea id="additionalConditions" name="additionalConditions" placeholder="Any special terms or conditions"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="charges">Charges (71B)</label>
                        <select id="charges" name="charges">
                            <option value="beneficiary">All charges outside issuing bank's country for beneficiary</option>
                            <option value="applicant">All charges for applicant</option>
                        </select>
                    </div>
                </div>

                <!-- Button Group -->
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">
                        <i class="fas fa-times"></i> Clear
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                        <i class="fas fa-save"></i> Save Draft
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Submit LC
                    </button>
                </div>
            </form>
            </div>
        </div>
    </div>
    
    <!-- Smart Capture Modal -->
    <div id="smartCaptureModal" class="smart-capture-modal">
        <div class="smart-capture-iframe-container">
            <div class="smart-capture-header">
                <div class="smart-capture-header-title">
                    <i class="mdi mdi-scan-helper"></i>
                    <div>
                        <h3>Smart Document Capture</h3>
                        <div class="smart-capture-header-subtitle">Upload and extract data from your documents</div>
                    </div>
                </div>
                <button class="smart-capture-close" onclick="closeSmartCapture()" title="Close">
                    <i class="mdi mdi-close"></i>
                </button>
            </div>
            <div class="smart-capture-loading">
                <div class="smart-capture-spinner"></div>
                <div class="smart-capture-loading-text">Loading Smart Capture...</div>
            </div>
            <iframe id="smartCaptureIframe" class="smart-capture-iframe" src="" onload="hideSmartCaptureLoading()"></iframe>
        </div>
    </div>

    <!-- Enhanced Chatbot Icon -->
    <div class="chatbot-icon" onclick="openChatbot()">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Enhanced Chatbot Overlay -->
    <div id="chatbotOverlay" class="chatbot-overlay" onclick="closeChatbotOnOverlay(event)">
        <div id="chatbotWindow" class="chatbot-window" onclick="event.stopPropagation()">
            <div class="chatbot-header" id="chatbotHeader">
                <div class="chatbot-header-left">
                    <i class="fas fa-robot"></i>
                    <div>
                        <h3>AI Assistant</h3>
                        <div class="chatbot-status">
                            <span class="status-dot"></span>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
                <div class="window-controls">
                    <button class="control-btn" onclick="minimizeChatbot()" title="Minimize">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button class="control-btn" onclick="maximizeChatbot()" title="Maximize">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="control-btn" onclick="closeChatbot()" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="chatbot-body">
                <iframe id="chatbotFrame" class="chatbot-iframe" src="/ai_chat_modern_overylay"></iframe>
            </div>
        </div>
    </div>

    <script>
        // Repository Configuration - dynamically set based on selection from dashboard
        const selectedRepo = sessionStorage.getItem('selectedRepository');
        const REPOSITORY_CONFIG = {
            repository_id: selectedRepo || 'trade_finance',
            repository_name: 'Trade Finance',
            repository_type: 'import_lc',
            collection: 'trade_finance_data',
            selected_from_dashboard: selectedRepo ? true : false
        };

        // Initialize repository context on page load
        window.addEventListener('load', function() {
            // Log repository selection
            console.log('Repository context loaded:', REPOSITORY_CONFIG);
            console.log('Selected from dashboard:', REPOSITORY_CONFIG.selected_from_dashboard);
            
            // Set repository in session storage
            sessionStorage.setItem('active_repository', JSON.stringify(REPOSITORY_CONFIG));
            
            // Update UI to show repository connection status
            if (REPOSITORY_CONFIG.selected_from_dashboard) {
                const navBrand = document.querySelector('.nav-brand h1');
                if (navBrand) {
                    navBrand.innerHTML = `Trade Finance LC Form <span style="font-size: 12px; color: #667eea; margin-left: 10px;">
                        <i class="fas fa-link"></i> Connected to Repository
                    </span>`;
                }
                
                // Show connection notification
                setTimeout(() => {
                    showMessage('Connected to Trade Finance Repository', 'success');
                }, 500);
            }
            
            // Initialize chatbot iframe with repository context
            initializeChatbotWithRepository();
            
            // Initialize form with repository context
            initializeRepositoryContext();
            
            // Load any saved draft
            loadDraftFromRepository();
        });
        
        // Initialize chatbot iframe with repository context
        function initializeChatbotWithRepository() {
            const chatbotFrame = document.getElementById('chatbotFrame');
            if (chatbotFrame) {
                // Build URL with repository parameters
                const params = new URLSearchParams({
                    repository_id: REPOSITORY_CONFIG.repository_id,
                    repository_name: REPOSITORY_CONFIG.repository_name,
                    repository_type: REPOSITORY_CONFIG.repository_type,
                    source: 'trade_finance_form'
                });
                
                // Set the iframe source with parameters
                chatbotFrame.src = `/ai_chat_modern_overylay?${params.toString()}`;
                
                // Also set up load event to send context after iframe loads
                chatbotFrame.onload = function() {
                    setTimeout(() => {
                        chatbotFrame.contentWindow.postMessage({
                            type: 'repository_context',
                            repository: REPOSITORY_CONFIG,
                            source: 'trade_finance_form',
                            connected: true
                        }, '*');
                        console.log('Repository context sent to chatbot iframe');
                    }, 500);
                };
            }
        }

        // Initialize repository context
        function initializeRepositoryContext() {
            // Add repository identifier to form
            const form = document.getElementById('lcForm');
            if (form) {
                const repoInput = document.createElement('input');
                repoInput.type = 'hidden';
                repoInput.name = 'repository_id';
                repoInput.value = REPOSITORY_CONFIG.repository_id;
                form.appendChild(repoInput);
            }

            // Update page title with repository
            const headerTitle = document.querySelector('.header h1');
            if (headerTitle) {
                headerTitle.innerHTML = `<i class="fas fa-file-invoice-dollar"></i> ${REPOSITORY_CONFIG.repository_name} - Import Letter of Credit`;
            }
            
            // Send repository context to chatbot iframe
            setTimeout(() => {
                const chatbotFrame = document.getElementById('chatbotFrame');
                if (chatbotFrame && chatbotFrame.contentWindow) {
                    chatbotFrame.contentWindow.postMessage({
                        type: 'repository_context',
                        repository: REPOSITORY_CONFIG,
                        source: 'trade_finance_form',
                        connected: REPOSITORY_CONFIG.selected_from_dashboard
                    }, '*');
                }
                
                // Also set in chatbot repository integration if available
                if (window.chatbotRepository) {
                    window.chatbotRepository.setContext(REPOSITORY_CONFIG);
                }
            }, 1000);

            // Send repository context to chatbot when it opens
            window.addEventListener('message', handleChatbotMessages);
        }

        // Handle messages between form and chatbot
        function handleChatbotMessages(event) {
            if (event.data) {
                switch(event.data.type) {
                    case 'chatbot_ready':
                        sendRepositoryContextToChatbot();
                        break;
                    case 'autofill_lc':
                        autoFillForm(event.data.formData);
                        break;
                    case 'get_repository_context':
                        sendRepositoryContextToChatbot();
                        break;
                }
            }
        }

        // Send repository context to chatbot
        function sendRepositoryContextToChatbot() {
            const chatbotFrame = document.getElementById('chatbotFrame');
            if (chatbotFrame && chatbotFrame.contentWindow) {
                chatbotFrame.contentWindow.postMessage({
                    type: 'repository_context',
                    repository: REPOSITORY_CONFIG,
                    form_type: 'import_lc',
                    form_fields: getFormFields(),
                    timestamp: new Date().toISOString()
                }, '*');
            }
        }

        // Get current form fields for context
        function getFormFields() {
            const formData = new FormData(document.getElementById('lcForm'));
            const fields = {};
            for (let [key, value] of formData.entries()) {
                fields[key] = value;
            }
            return fields;
        }

        // Load draft from repository-specific storage
        function loadDraftFromRepository() {
            const draftKey = `draft_${REPOSITORY_CONFIG.repository_id}_import_lc`;
            const draft = localStorage.getItem(draftKey);
            if (draft) {
                try {
                    const data = JSON.parse(draft);
                    Object.keys(data).forEach(key => {
                        const element = document.querySelector(`[name="${key}"]`);
                        if (element) {
                            element.value = data[key];
                        }
                    });
                    showMessage('Draft loaded from repository', 'info');
                } catch (e) {
                    console.error('Error loading draft:', e);
                }
            }
        }

        // Save draft to repository-specific storage
        function saveDraft() {
            const formData = new FormData(document.getElementById('lcForm'));
            const data = Object.fromEntries(formData);
            const draftKey = `draft_${REPOSITORY_CONFIG.repository_id}_import_lc`;
            
            // Add repository metadata
            data.repository_id = REPOSITORY_CONFIG.repository_id;
            data.saved_at = new Date().toISOString();
            
            localStorage.setItem(draftKey, JSON.stringify(data));
            showMessage('Draft saved to Trade Finance repository', 'success');
        }

        // Form submission
        document.getElementById('lcForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitLC();
        });

        // Submit LC with repository context
        async function submitLC() {
            const formData = new FormData(document.getElementById('lcForm'));
            const data = Object.fromEntries(formData);
            
            // Add repository context
            data.repository = REPOSITORY_CONFIG;
            data.submitted_from = 'trade_finance_form';
            
            // Get checked documents
            data.documents = Array.from(document.querySelectorAll('input[name="documents"]:checked'))
                .map(cb => cb.value);

            try {
                const response = await fetch('/api/repository/trade_finance/lc/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage(`Letter of Credit submitted to ${REPOSITORY_CONFIG.repository_name}! LC Number: ${result.lcNumber}`, 'success');
                    
                    // Clear draft after successful submission
                    const draftKey = `draft_${REPOSITORY_CONFIG.repository_id}_import_lc`;
                    localStorage.removeItem(draftKey);
                    
                    // Notify chatbot of successful submission
                    sendSubmissionNotificationToChatbot(result);
                    
                    setTimeout(() => {
                        document.getElementById('lcForm').reset();
                    }, 2000);
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                showMessage('Error submitting LC to repository. Please try again.', 'error');
            }
        }

        // Notify chatbot of successful submission
        function sendSubmissionNotificationToChatbot(result) {
            const chatbotFrame = document.getElementById('chatbotFrame');
            if (chatbotFrame && chatbotFrame.contentWindow) {
                chatbotFrame.contentWindow.postMessage({
                    type: 'form_submitted',
                    repository: REPOSITORY_CONFIG,
                    transaction_id: result.lcNumber,
                    status: 'success',
                    timestamp: new Date().toISOString()
                }, '*');
            }
        }

        // Function to get current form data
        function getCurrentFormData() {
            const formData = {};
            const form = document.getElementById('lcForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                if (input.name && input.value) {
                    if (input.type === 'checkbox') {
                        if (input.checked) {
                            if (!formData[input.name]) {
                                formData[input.name] = [];
                            }
                            formData[input.name].push(input.value);
                        }
                    } else {
                        formData[input.name] = input.value;
                    }
                }
            });
            
            return formData;
        }
        
        // Function to send form context to chatbot
        function sendFormContextToChatbot() {
            const chatbotFrame = document.getElementById('chatbotFrame');
            if (chatbotFrame && chatbotFrame.contentWindow) {
                const formData = getCurrentFormData();
                chatbotFrame.contentWindow.postMessage({
                    type: 'form_context',
                    formData: formData,
                    formType: 'import_lc',
                    timestamp: new Date().toISOString()
                }, '*');
                console.log('Form context sent to chatbot:', formData);
            }
        }

        // Enhanced Chatbot Controls
        let isMaximized = false;
        let isMinimized = false;

        function openChatbot() {
            const overlay = document.getElementById('chatbotOverlay');
            const window = document.getElementById('chatbotWindow');
            overlay.classList.add('active');
            window.classList.remove('minimized');
            isMinimized = false;
            
            // Send current form data to chatbot when it opens
            setTimeout(() => {
                sendFormContextToChatbot();
            }, 500);
        }

        function closeChatbot() {
            const overlay = document.getElementById('chatbotOverlay');
            overlay.classList.remove('active');
            isMaximized = false;
            isMinimized = false;
            const window = document.getElementById('chatbotWindow');
            window.classList.remove('maximized', 'minimized');
        }

        function closeChatbotOnOverlay(event) {
            if (event.target === event.currentTarget) {
                closeChatbot();
            }
        }

        function minimizeChatbot() {
            const window = document.getElementById('chatbotWindow');
            if (isMinimized) {
                window.classList.remove('minimized');
                isMinimized = false;
            } else {
                window.classList.add('minimized');
                window.classList.remove('maximized');
                isMinimized = true;
                isMaximized = false;
            }
        }

        function maximizeChatbot() {
            const window = document.getElementById('chatbotWindow');
            if (isMaximized) {
                window.classList.remove('maximized');
                isMaximized = false;
            } else {
                window.classList.add('maximized');
                window.classList.remove('minimized');
                isMaximized = true;
                isMinimized = false;
            }
        }

        // Make chatbot window draggable
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        const chatbotHeader = document.getElementById('chatbotHeader');
        const chatbotWindow = document.getElementById('chatbotWindow');

        chatbotHeader.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
            if (e.target.closest('.window-controls')) return;
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;

            if (e.target === chatbotHeader || chatbotHeader.contains(e.target)) {
                isDragging = true;
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                if (!isMaximized && !isMinimized) {
                    chatbotWindow.style.transform = `translate(calc(-50% + ${currentX}px), calc(-50% + ${currentY}px))`;
                }
            }
        }

        function dragEnd() {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }

        // Clear form
        function clearForm() {
            if (confirm('Are you sure you want to clear all fields?')) {
                document.getElementById('lcForm').reset();
                showMessage('Form cleared', 'info');
            }
        }

        // Save draft
        function saveDraft() {
            const formData = new FormData(document.getElementById('lcForm'));
            const data = Object.fromEntries(formData);
            localStorage.setItem('lcDraft', JSON.stringify(data));
            showMessage('Draft saved successfully', 'success');
        }
        
        // Open Smart Capture Document Classification Modal
        function openSmartCapture() {
            const modal = document.getElementById('smartCaptureModal');
            const iframe = document.getElementById('smartCaptureIframe');

            // Show loading state
            modal.classList.add('loading');

            // Set the iframe source with context parameters
            // Pass functionName for enhanced classification with field mappings
            const params = new URLSearchParams({
                functionName: 'Register LC',
                productName: 'Trade Finance'
            });
            iframe.src = `/document-classification-overlay?${params.toString()}`;

            // Show the modal with animation
            modal.classList.add('active');
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
            
            // Add escape key handler
            document.addEventListener('keydown', handleSmartCaptureEscape);
        }
        
        // Hide loading indicator when iframe loads
        function hideSmartCaptureLoading() {
            const modal = document.getElementById('smartCaptureModal');
            setTimeout(() => {
                modal.classList.remove('loading');
            }, 300);
        }
        
        // Handle escape key
        function handleSmartCaptureEscape(e) {
            if (e.key === 'Escape') {
                closeSmartCapture();
            }
        }
        
        // Close Smart Capture Modal
        function closeSmartCapture() {
            const modal = document.getElementById('smartCaptureModal');
            const iframe = document.getElementById('smartCaptureIframe');
            
            // Hide the modal with animation
            modal.classList.remove('active');
            modal.classList.remove('loading');
            
            // Clear iframe source after animation
            setTimeout(() => {
                iframe.src = '';
            }, 300);
            
            // Restore body scroll
            document.body.style.overflow = 'auto';
            
            // Remove escape key handler
            document.removeEventListener('keydown', handleSmartCaptureEscape);
        }
        
        // Close modal when clicking outside
        document.getElementById('smartCaptureModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSmartCapture();
            }
        });

        // Load draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('lcDraft');
            if (draft) {
                const data = JSON.parse(draft);
                Object.keys(data).forEach(key => {
                    const element = document.querySelector(`[name="${key}"]`);
                    if (element) {
                        element.value = data[key];
                    }
                });
            }

            // Set up message listener for chatbot auto-fill
            window.addEventListener('message', handleChatbotMessage);
            
            // Set up form field change listeners to sync with chatbot
            setupFormSyncWithChatbot();
        });
        
        // Function to set up form sync with chatbot
        function setupFormSyncWithChatbot() {
            const form = document.getElementById('lcForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            // Debounce function to avoid too many updates
            let syncTimeout;
            const debouncedSync = () => {
                clearTimeout(syncTimeout);
                syncTimeout = setTimeout(() => {
                    sendFormContextToChatbot();
                }, 1000); // Wait 1 second after user stops typing
            };
            
            // Add change listeners to all form fields
            inputs.forEach(input => {
                input.addEventListener('change', debouncedSync);
                input.addEventListener('input', debouncedSync);
            });
            
            // Also sync when focus changes
            inputs.forEach(input => {
                input.addEventListener('blur', () => {
                    sendFormContextToChatbot();
                });
            });
        }

        // Handle messages from chatbot for auto-fill
        function handleChatbotMessage(event) {
            if (event.data && event.data.type === 'autofill_lc') {
                autoFillForm(event.data.formData);
            }
            
            // Handle transaction confirmation from chatbot
            if (event.data && event.data.type === 'transaction_confirmed') {
                populateFormFromTransaction(event.data.formData);
            }
            
            // Handle direct form population from chatbot
            if (event.data && event.data.type === 'POPULATE_LC_FORM') {
                const formData = event.data.data;
                populateFormFromTransaction(formData);
            }
            
            // Handle messages from Smart Capture modal
            if (event.data && event.data.type === 'POPULATE_LC_FORM' && event.data.source === 'smart_capture') {
                const formData = event.data.data;
                
                // Populate form fields with extracted data
                Object.keys(formData).forEach(fieldName => {
                    const element = document.getElementById(fieldName) || document.querySelector(`[name="${fieldName}"]`);
                    if (element) {
                        element.value = formData[fieldName];
                        
                        // Trigger change event for any field listeners
                        const changeEvent = new Event('change', { bubbles: true });
                        element.dispatchEvent(changeEvent);
                    }
                });
                
                // Show success message
                showMessage('Form fields populated from document', 'success');
                
                // Close the Smart Capture modal
                closeSmartCapture();
            }
        }
        
        // Function to populate form from transaction data
        function populateFormFromTransaction(formData) {
            console.log('Populating form from transaction:', formData);
            
            // Map the transaction data fields to form fields
            const fieldMapping = {
                'lc_number': 'lcNumber',
                'applicant': 'applicant',
                'beneficiary': 'beneficiary',
                'issue_date': 'issueDate',
                'amount': 'amount',
                'currency': 'currency',
                'status': 'lcType',
                'expiry_date': 'expiryDate',
                'country': 'finalDestination',
                'product_type': 'goodsDescription',
                'issuing_bank': 'issuingBank',
                'advising_bank': 'advisingBank',
                'payment_terms': 'paymentTerms',
                'port_of_loading': 'portOfLoading',
                'port_of_discharge': 'portOfDischarge',
                'latest_shipment_date': 'latestShipmentDate',
                'partial_shipment': 'partialShipment',
                'transhipment': 'transhipment',
                'incoterms': 'incoterms',
                'hs_code': 'hsCode',
                'quantity': 'quantity'
            };
            
            // Populate each field
            Object.keys(formData).forEach(key => {
                const formFieldId = fieldMapping[key] || key;
                const element = document.getElementById(formFieldId) || document.querySelector(`[name="${formFieldId}"]`);
                
                if (element) {
                    // Handle date fields - ensure proper format
                    if (element.type === 'date' && formData[key]) {
                        // Convert date to YYYY-MM-DD format if needed
                        const dateValue = new Date(formData[key]);
                        if (!isNaN(dateValue)) {
                            element.value = dateValue.toISOString().split('T')[0];
                        } else {
                            element.value = formData[key];
                        }
                    } else {
                        element.value = formData[key];
                    }
                    
                    // Highlight the field briefly
                    element.style.backgroundColor = '#e6f7ff';
                    setTimeout(() => {
                        element.style.backgroundColor = '';
                    }, 2000);
                    
                    // Trigger change event
                    const changeEvent = new Event('change', { bubbles: true });
                    element.dispatchEvent(changeEvent);
                }
            });
            
            // Show success message
            showMessage('Form populated with transaction data from AI Assistant', 'success');
            
            // Scroll to top of form
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Auto-fill form with data from chatbot
        function autoFillForm(data) {
            Object.keys(data).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = data[key];
                    element.style.backgroundColor = '#e6f7ff';
                    setTimeout(() => {
                        element.style.backgroundColor = '';
                    }, 2000);
                }
            });
            showMessage('Form auto-filled from AI Assistant', 'success');
        }

        // Submit LC
        async function submitLC() {
            const formData = new FormData(document.getElementById('lcForm'));
            const data = Object.fromEntries(formData);
            
            // Get checked documents
            data.documents = Array.from(document.querySelectorAll('input[name="documents"]:checked'))
                .map(cb => cb.value);

            try {
                const response = await fetch('/api/lc/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    showMessage('Letter of Credit submitted successfully! LC Number: ' + result.lcNumber, 'success');
                    localStorage.removeItem('lcDraft');
                    setTimeout(() => {
                        document.getElementById('lcForm').reset();
                    }, 2000);
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                showMessage('Error submitting LC. Please try again.', 'error');
            }
        }

        // Show status message
        function showMessage(message, type) {
            const messageDiv = document.getElementById('statusMessage');
            messageDiv.textContent = message;
            messageDiv.className = `status-message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Form validation
        document.getElementById('expiryDate').addEventListener('change', function() {
            const issueDate = document.getElementById('issueDate').value;
            const expiryDate = this.value;
            
            if (issueDate && expiryDate && new Date(expiryDate) <= new Date(issueDate)) {
                this.setCustomValidity('Expiry date must be after issue date');
            } else {
                this.setCustomValidity('');
            }
        });

        document.getElementById('latestShipmentDate').addEventListener('change', function() {
            const expiryDate = document.getElementById('expiryDate').value;
            const shipmentDate = this.value;
            
            if (expiryDate && shipmentDate && new Date(shipmentDate) >= new Date(expiryDate)) {
                this.setCustomValidity('Shipment date must be before expiry date');
            } else {
                this.setCustomValidity('');
            }
        });


        // Document processing functionality has been removed
        // Removed duplicate openChatbot function - using the one defined at line 1221
    </script>

    <!-- Minimal Vue.js App Script -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Minimal Vue app for modern design compatibility
                }
            }
        }).mount('#app');
    </script>
    </div>
</body>
</html>