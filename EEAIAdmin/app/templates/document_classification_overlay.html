<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Classification - Finstack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- Socket.IO for WebSocket Connection -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- WebSocket Client and Progress Loader -->
    <script src="{{ url_for('static', filename='js/websocket_client.js') }}"></script>
    <script src="{{ url_for('static', filename='js/progress_loader.js') }}"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/finstack-master.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global-components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/professional-loader.css') }}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 25%, #e2e8f0 50%, #cbd5e0 75%, #a0aec0 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmZmZmYiIGZpbGwtb3BhY2l0eT0iMC4wMyI+PHBhdGggZD0iTTM2IDM0djItSDI0di0yaDEyem0wLTE2djJIMjR2LTJoMTJ6Ii8+PC9nPjwvZz48L3N2Zz4=');
            pointer-events: none;
            opacity: 0.5;
        }

        /* Modern Floating Header - Matching index.html */
        .floating-header {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .floating-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 28px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Brand Section */
        .brand-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-container {
            position: relative;
        }

        .modern-logo {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: logoFloat 4s ease-in-out infinite;
        }

        .modern-logo:hover {
            transform: scale(1.05) rotate(2deg);
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(99, 102, 241, 0.1);
        }

        .status-pulse {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.9);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .brand-info h1 {
            font-size: 24px !important;
            font-weight: 800 !important;
            margin: 0 !important;
            background: linear-gradient(135deg, #1e293b, #475569, #64748b);
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            letter-spacing: -0.5px;
        }

        .brand-info p {
            font-size: 13px !important;
            color: rgba(100, 116, 139, 0.8) !important;
            margin: 0 !important;
            font-weight: 500 !important;
        }

        /* Navigation Pills */
        .nav-pills {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 4px;
        }

        .nav-pill {
            display: flex !important;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 12px;
            text-decoration: none !important;
            color: rgba(100, 116, 139, 0.8) !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-pill:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(30, 41, 59, 0.9) !important;
            transform: translateY(-1px);
        }

        .nav-pill.active {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #1e293b !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .nav-pill i {
            font-size: 16px;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator-modern {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            color: #059669;
        }

        .pulse-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .action-button {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            padding: 8px 16px !important;
            border-radius: 12px !important;
            font-size: 13px !important;
            font-weight: 600 !important;
            text-decoration: none !important;
            border: none !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .action-button.primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 70%, #06b6d4 100%) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .action-button.primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4) !important;
        }

        .action-button.secondary {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #374151 !important;
            border: 1px solid rgba(229, 231, 235, 0.8) !important;
        }

        .action-button.secondary:hover {
            background: rgba(255, 255, 255, 1) !important;
            color: #1f2937 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
        }

        /* Animations */
        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Body styling optimized for popup */
        body {
            padding: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            overflow-y: auto;
        }

        /* Main content styling for popup */
        .main-content {
            background: transparent;
            min-height: calc(100vh - 20px);
        }

        .page-container {
            max-width: 100%;
            margin: 0;
            padding: 15px;
        }

        @keyframes logoFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-2px);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        /* Enhanced Welcome Screen Animations */
        @keyframes animate-bounce-slow {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .animate-bounce-slow {
            animation: animate-bounce-slow 3s ease-in-out infinite;
        }

        @keyframes animate-spin-slow {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-slow {
            animation: animate-spin-slow 8s linear infinite;
        }

        /* Gradient text effects */
        .bg-gradient-to-r {
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
        }
        .from-indigo-600 {
            --tw-gradient-from: #4f46e5;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(79, 70, 229, 0));
        }
        .via-purple-600 {
            --tw-gradient-stops: var(--tw-gradient-from), #7c3aed, var(--tw-gradient-to, rgba(124, 58, 237, 0));
        }
        .to-pink-600 {
            --tw-gradient-to: #db2777;
        }
        .bg-clip-text {
            background-clip: text;
            -webkit-background-clip: text;
        }
        .text-transparent {
            color: transparent;
        }

        /* Enhanced glass card styling - matching analytics_new.html */
        .glass-card {
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(12px) !important;
            -webkit-backdrop-filter: blur(12px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 24px !important;
            box-shadow:
                0 4px 16px rgba(0, 0, 0, 0.08),
                0 1px 4px rgba(0, 0, 0, 0.04) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow:
                0 12px 40px rgba(0, 0, 0, 0.08),
                0 4px 12px rgba(0, 0, 0, 0.04);
            background: rgba(255, 255, 255, 1);
            border-color: rgba(102, 126, 234, 0.2);
        }

        /* Premium Upload area design */
        .upload-area {
            background: linear-gradient(135deg, #fafbfc 0%, #f3f4f6 100%);
            border: 2px dashed #e5e7eb;
            position: relative;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            min-height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.04);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 20%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .upload-area::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #667eea);
            border-radius: 24px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.4s ease;
            animation: gradient-shift 3s ease infinite;
            background-size: 300% 300%;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .upload-area:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.1),
                        inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
        }

        .upload-area:hover::before {
            opacity: 1;
        }

        .upload-area:hover::after {
            opacity: 0.1;
        }

        .upload-area.dragging {
            background: linear-gradient(135deg, #e9ecff 0%, #e0e6ff 100%);
            border-color: #667eea;
            border-width: 2px;
            transform: scale(1.01);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.15),
                        inset 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .upload-area.dragging::before {
            opacity: 1;
        }

        .upload-area.dragging::after {
            opacity: 0.2;
        }

        /* Upload content styling */
        .upload-content {
            text-align: center;
            z-index: 10;
            position: relative;
        }

        /* Animated background pattern */
        .upload-area-pattern {
            position: absolute;
            inset: 0;
            opacity: 0.05;
            background-image:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 219, 112, 0.3) 0%, transparent 50%);
            animation: patternFloat 20s ease-in-out infinite;
        }

        @keyframes patternFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-20px, -20px) scale(1.1); }
            66% { transform: translate(20px, -10px) scale(0.9); }
        }

        /* Floating particles */
        .upload-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(147, 51, 234, 0.6);
            border-radius: 50%;
            animation: particleFloat 8s infinite ease-in-out;
        }

        .particle:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
            background: rgba(59, 130, 246, 0.6);
        }

        .particle:nth-child(2) {
            left: 30%;
            animation-delay: 1s;
            background: rgba(236, 72, 153, 0.6);
        }

        .particle:nth-child(3) {
            left: 50%;
            animation-delay: 2s;
            background: rgba(147, 51, 234, 0.6);
        }

        .particle:nth-child(4) {
            left: 70%;
            animation-delay: 3s;
            background: rgba(245, 158, 11, 0.6);
        }

        .particle:nth-child(5) {
            left: 90%;
            animation-delay: 4s;
            background: rgba(16, 185, 129, 0.6);
        }

        @keyframes particleFloat {
            0% {
                bottom: -10px;
                opacity: 0;
                transform: translateX(0) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateX(10px) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateX(-10px) scale(1);
            }
            100% {
                bottom: 100%;
                opacity: 0;
                transform: translateX(0) scale(0);
            }
        }

        /* Upload icon container */
        .upload-icon-container {
            position: relative;
            display: inline-block;
            margin-bottom: 32px;
        }

        .upload-icon-bg {
            position: absolute;
            inset: -30px;
            background: radial-gradient(circle at center, rgba(147, 51, 234, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            animation: iconPulse 3s ease-in-out infinite;
            filter: blur(20px);
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.3); opacity: 0.6; }
        }

        .upload-icon {
            font-size: 84px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            animation: float 4s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(147, 51, 234, 0.3));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-12px) rotate(3deg) scale(1.05); }
            50% { transform: translateY(-8px) rotate(-2deg) scale(1.02); }
            75% { transform: translateY(-10px) rotate(2deg) scale(1.03); }
        }

        /* Drag indicator */
        .drag-indicator {
            position: absolute;
            inset: 12px;
            border: 3px solid transparent;
            border-radius: 20px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #3b82f6) border-box;
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .upload-area.dragging .drag-indicator {
            opacity: 1;
            animation: borderRotate 2s linear infinite;
        }

        @keyframes borderRotate {
            to {
                transform: rotate(360deg);
            }
        }

        /* File type badges */
        .file-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(147, 51, 234, 0.08);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            color: #4b5563;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .file-type-badge::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .file-type-badge:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(147, 51, 234, 0.3);
        }

        .file-type-badge:hover::before {
            transform: translateX(100%);
        }

        .file-type-badge i {
            font-size: 20px;
        }

        /* Badge colors */
        .badge-pdf { color: #dc2626; }
        .badge-image { color: #2563eb; }
        .badge-doc { color: #7c3aed; }
        .badge-excel { color: #059669; }

        /* File list transitions */
        .file-fade-enter-active {
            transition: all 0.3s ease;
        }

        .file-fade-leave-active {
            transition: all 0.3s ease;
        }

        .file-fade-enter-from {
            opacity: 0;
            transform: translateX(30px);
        }

        .file-fade-leave-to {
            opacity: 0;
            transform: translateX(-30px);
        }

        /* Button from index.html */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.5px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            background: linear-gradient(135deg, #5a67d8 0%, #6b4b9a 100%);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 12px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        /* Animate float from index.html */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        /* Status indicator from index.html */
        .status-indicator {
            width: 6px;
            height: 6px;
            background: #67e8f9;
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(103, 232, 249, 0.2);
            animation: pulse-indicator 2s ease-in-out infinite;
        }

        @keyframes pulse-indicator {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        /* Enhanced Result cards */
        .result-item {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 0, 0, 0.06);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border-color: rgba(102, 126, 234, 0.2);
        }

        .result-item:hover::before {
            left: 100%;
        }

        /* Confidence meter */
        .confidence-meter {
            height: 6px;
            background: rgba(103, 126, 234, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Stats card */
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.2);
        }

        /* Metric number from index.html */
        .metric-number {
            font-size: 42px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 16px 0;
            display: inline-block;
        }

        /* Legacy processing card styles - now handled by professional-loader.css */
        .old-processing-card {
            /* Kept for reference but replaced by professional-loader.css */
        }
        
        /* Override specific Vue behaviors for professional loader */
        .processing-card[data-vue="true"] .step-indicator {
            /* Vue-specific step handling */
        }
        
        /* Keep step-number for Vue compatibility */
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }

        /* Insights expand/collapse transition */
        .insights-enter-active, .insights-leave-active {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 600px;
            overflow: hidden;
        }
        .insights-enter, .insights-leave-to {
            max-height: 0;
            opacity: 0;
            transform: translateY(-20px);
        }

        /* Enhanced Glass Card Effects */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        /* Animated Progress Rings */
        .glass-card svg path:last-child {
            animation: progressFill 1.5s ease-out forwards;
        }

        @keyframes progressFill {
            from { stroke-dasharray: 0, 100; }
            to { stroke-dasharray: var(--progress), 100; }
        }

        /* Gradient Text Effects */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Micro Animations */
        .glass-card .mdi {
            transition: transform 0.3s ease;
        }

        .glass-card:hover .mdi {
            transform: scale(1.1);
        }

        /* Status Badge Animations */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
        }

        .bg-green-100 {
            animation: pulse-glow 2s infinite;
        }

        /* Enhanced File preview */
        .file-preview {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-preview:hover {
            border-color: rgba(147, 51, 234, 0.4);
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            transform: translateX(-4px);
        }

        .file-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .file-preview:hover::before {
            left: 100%;
        }

        .file-icon-wrapper {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .file-icon-wrapper.pdf {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .file-icon-wrapper.image {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .file-icon-wrapper.document {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .file-icon-wrapper.excel {
            background: linear-gradient(135deg, #10b981, #047857);
        }

        .file-icon-wrapper.default {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .file-icon-wrapper i {
            color: white;
            font-size: 24px;
        }

        .file-progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .file-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 2px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .file-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* File preview section */
        .file-list-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.8);
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .file-preview:hover {
            background: rgba(103, 126, 234, 0.15);
            transform: translateX(4px);
        }

        /* Enhanced Modal Styles */
        .details-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        /* Enhanced Modal styles */
        .modal-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            width: 100%;
            max-width: 1600px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.05) 0%, rgba(103, 126, 234, 0.02) 100%);
            border-bottom: 1px solid rgba(103, 126, 234, 0.1);
            padding: 24px 32px;
        }

        .modal-tab-button {
            padding: 12px 24px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .modal-tab-button:hover {
            color: #4b5563;
        }

        .modal-tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .modal-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px 2px 0 0;
        }

        /* Image viewer styles */
        .image-viewer {
            position: relative;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: grab;
            height: 100%;
        }

        .image-viewer.panning {
            cursor: grabbing !important;
        }

        .image-container {
            position: relative;
            transform-origin: center;
            transition: transform 0.2s ease;
        }

        .canvas-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .canvas-overlay.drawing {
            pointer-events: all;
            cursor: crosshair !important;
        }

        .image-viewer.tool-active {
            cursor: crosshair !important;
        }


        .zoom-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: white;
            color: #667eea;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }


        .page-info {
            color: #ffffff;
            font-weight: 500;
            font-size: 14px;
            min-width: 100px;
            text-align: center;
        }

        /* Field item styles */
        .field-item-enhanced {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(103, 126, 234, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .field-item-enhanced:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(103, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .field-item-enhanced.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.1) 0%, rgba(103, 126, 234, 0.05) 100%);
        }

        .field-confidence {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .confidence-high {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .confidence-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .confidence-low {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* Drawing tools */
        .drawing-tools {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background: #f3f4f6;
        }

        .tool-btn.active {
            background: #667eea;
            color: white;
        }

        /* Enhanced Bounding box styles */
        .bounding-box {
            position: absolute;
            border: 2px solid #667eea;
            background: rgba(103, 126, 234, 0.1);
            pointer-events: auto;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bounding-box:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }

        .bounding-box.active {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.2);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
            animation: pulse-box 2s ease-in-out infinite;
        }

        @keyframes pulse-box {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(245, 158, 11, 0.2);
            }
        }

        .bounding-box-label {
            position: absolute;
            top: -25px;
            left: 0;
            background: rgba(103, 126, 234, 0.9);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .bounding-box:hover .bounding-box-label,
        .bounding-box.active .bounding-box-label {
            opacity: 1;
        }

        /* Image container styles */
        .image-container {
            position: relative;
            display: inline-block;
            overflow: hidden;
            max-width: 100%;
            max-height: 100%;
        }

        .document-image {
            display: block;
            max-width: 100%;
            max-height: calc(90vh - 180px);
            width: auto;
            height: auto;
            object-fit: contain;
        }

        .color-palette {
            display: flex;
            gap: 6px;
            margin-left: 12px;
            padding-left: 12px;
            border-left: 1px solid #e5e7eb;
        }

        .color-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-btn:hover {
            transform: scale(1.2);
        }

        .color-btn.active {
            border-color: #1a1a1a;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        /* Responsive styles for floating header */
        @media (max-width: 1200px) {
            .nav-pills {
                gap: 4px;
            }

            .nav-pill {
                padding: 6px 12px;
                font-size: 12px;
            }

            .nav-pill span {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .floating-header {
                top: 12px;
                left: 12px;
                right: 12px;
            }

            .floating-header-content {
                padding: 12px 20px;
            }

            .page-container {
                padding: 20px;
            }

            body {
                padding-top: 100px;
            }

            .brand-info p {
                display: none !important;
            }

            .nav-pills {
                display: none;
            }

            .header-actions {
                gap: 8px;
            }

            .action-button span {
                display: none !important;
            }

            .action-button {
                padding: 8px 12px !important;
            }
        }

        @media (max-width: 480px) {
            .status-indicator-modern {
                display: none;
            }

            .brand-info h1 {
                font-size: 20px !important;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Modern Floating Header -->


        <!-- Main Content -->
        <div class="main-content">
            <div class="page-container">
                <!-- Document Types Management Panel Button -->
                <div v-if="isAllowed && !results" class="mb-6">
                    <button @click="showAdminPanel = !showAdminPanel"
                            class="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center space-x-2">
                        <i class="mdi mdi-cog-outline text-xl"></i>
                        <span class="font-semibold">Manage Document Types</span>
                        <i :class="['mdi', showAdminPanel ? 'mdi-chevron-up' : 'mdi-chevron-down', 'text-xl']"></i>
                    </button>
                </div>

                <!-- Document Types Management Panel (visible when toggled) -->
                <div v-if="isAllowed && showAdminPanel && !results" class="mb-8 animate-slide-in">
                    <div class="glass-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 flex items-center space-x-2">
                                <i class="mdi mdi-file-document-edit-outline text-purple-600"></i>
                                <span>Document Type Management</span>
                            </h2>
                            <button @click="showNewDocTypeDialog = true"
                                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center space-x-1">
                                <i class="mdi mdi-plus"></i>
                                <span>Add New Type</span>
                            </button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Document Types List -->
                            <div class="lg:col-span-1">
                                <h3 class="text-lg font-semibold mb-3 text-gray-700">Document Types</h3>
                                <div class="space-y-2 max-h-96 overflow-y-auto">
                                    <div v-for="docType in documentTypes" :key="docType.name"
                                         @click="selectDocType(docType)"
                                         :class="['p-3 rounded-lg cursor-pointer transition-all',
                                                  selectedDocType?.name === docType.name ? 'bg-purple-100 border-2 border-purple-500' : 'bg-gray-50 hover:bg-gray-100 border-2 border-transparent']">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-gray-800">{% raw %}{{ docType.name }}{% endraw %}</p>
                                                <p class="text-sm text-gray-500">{% raw %}{{ docType.field_count }}{% endraw %} fields</p>
                                            </div>
                                            <button @click.stop="deleteDocType(docType)"
                                                    class="text-red-500 hover:text-red-700 p-1">
                                                <i class="mdi mdi-delete-outline"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div v-if="documentTypes.length === 0" class="text-gray-500 text-center py-4">
                                        No document types found
                                    </div>
                                </div>
                            </div>

                            <!-- Selected Document Type Fields -->
                            <div class="lg:col-span-2">
                                <div v-if="selectedDocType">
                                    <div class="flex items-center justify-between mb-3">
                                        <h3 class="text-lg font-semibold text-gray-700">
                                            Fields for {% raw %}{{ selectedDocType.name }}{% endraw %}
                                        </h3>
                                        <button v-if="editingDocType"
                                                @click="saveDocType"
                                                :disabled="adminLoading"
                                                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 flex items-center space-x-1">
                                            <i class="mdi mdi-content-save"></i>
                                            <span>Save Changes</span>
                                        </button>
                                    </div>

                                    <!-- Add New Field Form -->
                                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                        <div class="flex items-end space-x-2">
                                            <div class="flex-1">
                                                <label class="text-sm font-medium text-gray-600">Field Name</label>
                                                <input v-model="newFieldName"
                                                       type="text"
                                                       placeholder="e.g., Invoice Number"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                            </div>
                                            <div>
                                                <label class="text-sm font-medium text-gray-600">Type</label>
                                                <select v-model="newFieldType"
                                                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                                    <option value="text">Text</option>
                                                    <option value="number">Number</option>
                                                    <option value="date">Date</option>
                                                    <option value="currency">Currency</option>
                                                    <option value="email">Email</option>
                                                </select>
                                            </div>
                                            <button @click="addFieldToDocType"
                                                    class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                                                <i class="mdi mdi-plus"></i> Add
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Fields List -->
                                    <div class="space-y-2 max-h-64 overflow-y-auto">
                                        <div v-for="(field, index) in selectedDocType.fields" :key="index"
                                             class="bg-white p-3 rounded-lg border border-gray-200 flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <input type="checkbox"
                                                       :checked="field.required"
                                                       @change="toggleFieldRequired(field)"
                                                       class="w-4 h-4 text-purple-600">
                                                <div>
                                                    <p class="font-medium text-gray-800">{% raw %}{{ field.name }}{% endraw %}</p>
                                                    <p class="text-sm text-gray-500">Type: {% raw %}{{ field.type }}{% endraw %} {% raw %}{{ field.required ? '(Required)' : '' }}{% endraw %}</p>
                                                </div>
                                            </div>
                                            <button @click="removeFieldFromDocType(index)"
                                                    class="text-red-500 hover:text-red-700 p-1">
                                                <i class="mdi mdi-close"></i>
                                            </button>
                                        </div>
                                        <div v-if="!selectedDocType.fields || selectedDocType.fields.length === 0"
                                             class="text-gray-500 text-center py-4">
                                            No fields defined. Add fields above.
                                        </div>
                                    </div>
                                </div>
                                <div v-else class="text-gray-500 text-center py-8">
                                    <i class="mdi mdi-file-document-outline text-4xl mb-2"></i>
                                    <p>Select a document type to manage its fields</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Document Type Dialog -->
                <div v-if="showNewDocTypeDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl p-6 w-96 shadow-xl">
                        <h3 class="text-xl font-bold mb-4">Create New Document Type</h3>
                        <input v-model="newDocTypeName"
                               type="text"
                               placeholder="Document Type Name"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 mb-4">
                        <div class="flex space-x-2">
                            <button @click="createNewDocType"
                                    :disabled="!newDocTypeName || adminLoading"
                                    class="flex-1 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 disabled:opacity-50 transition-colors">
                                Create
                            </button>
                            <button @click="showNewDocTypeDialog = false; newDocTypeName = ''"
                                    class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upload Section -->
                <div v-if="!results" class="glass-card animate-slide-in" style="padding: 48px; margin-bottom: 32px;">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold mb-3 text-gray-800">Ready to Get Started?</h2>
                        <p class="text-base text-gray-600 font-medium">Upload your documents and experience the power of AI classification</p>
                    </div>

                    <!-- Premium Drag Drop Area -->
                    <div
                        class="upload-area"
                        :class="{ 'dragging': isDragging }"
                        @click="$refs.fileInput.click()"
                        @dragover.prevent="isDragging = true"
                        @dragleave.prevent="isDragging = false"
                        @drop.prevent="handleDrop"
                    >
                        <div class="drag-indicator"></div>
                        <div class="upload-area-pattern"></div>
                        <div class="upload-particles">
                            <span class="particle"></span>
                            <span class="particle"></span>
                            <span class="particle"></span>
                            <span class="particle"></span>
                            <span class="particle"></span>
                        </div>

                        <div class="upload-content">
                            <div class="upload-icon-container">
                                <div class="upload-icon-bg"></div>
                                <i class="mdi mdi-cloud-upload upload-icon"></i>
                            </div>

                            <h3 class="text-3xl font-black mb-3 text-gray-800">
                                {% raw %}{{ isDragging ? 'Release to upload' : 'Drop your files here' }}{% endraw %}
                            </h3>
                            <p class="text-gray-600 text-lg mb-8 font-medium">
                                {% raw %}{{ isDragging ? 'We\'ll take it from here' : 'or click anywhere to browse' }}{% endraw %}
                            </p>

                            <div class="flex items-center justify-center gap-3 flex-wrap mb-8">
                                <div class="file-type-badge">
                                    <i class="mdi mdi-file-pdf-box badge-pdf"></i>
                                    <span>PDF</span>
                                </div>
                                <div class="file-type-badge">
                                    <i class="mdi mdi-file-image badge-image"></i>
                                    <span>Images</span>
                                </div>
                                <div class="file-type-badge">
                                    <i class="mdi mdi-file-document badge-doc"></i>
                                    <span>Documents</span>
                                </div>
                                <div class="file-type-badge">
                                    <i class="mdi mdi-file-excel badge-excel"></i>
                                    <span>Excel</span>
                                </div>
                            </div>

                            <div class="flex items-center justify-center gap-8 text-gray-600 text-sm font-medium">
                                <div class="flex items-center gap-2 hover:text-gray-800 transition-colors cursor-default">
                                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                                        <i class="mdi mdi-shield-check text-green-600 text-lg"></i>
                                    </div>
                                    <span>Secure Upload</span>
                                </div>
                                <div class="flex items-center gap-2 hover:text-gray-800 transition-colors cursor-default">
                                    <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center">
                                        <i class="mdi mdi-lightning-bolt text-yellow-600 text-lg"></i>
                                    </div>
                                    <span>Fast Processing</span>
                                </div>
                                <div class="flex items-center gap-2 hover:text-gray-800 transition-colors cursor-default">
                                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                        <i class="mdi mdi-file-multiple text-blue-600 text-lg"></i>
                                    </div>
                                    <span>Max 50MB/file</span>
                                </div>
                            </div>
                        </div>

                        <input
                            ref="fileInput"
                            type="file"
                            class="hidden"
                            accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.tiff,.xlsx,.xls"
                            @change="handleFileSelect"
                            multiple
                        />
                    </div>

                    <!-- Premium Selected Files Preview -->
                    <div v-if="selectedFiles.length > 0" class="file-list-section">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mr-3">
                                    <i class="mdi mdi-file-multiple text-white text-lg"></i>
                                </div>
                                Selected Files
                                <span class="ml-2 px-3 py-1 bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 rounded-full text-sm font-semibold">
                                    {% raw %}{{ selectedFiles.length }}{% endraw %}
                                </span>
                            </h3>
                            <button @click="clearFiles" class="px-4 py-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all flex items-center gap-2">
                                <i class="mdi mdi-trash-can-outline"></i>
                                <span class="text-sm font-medium">Clear All</span>
                            </button>
                        </div>

                        <transition-group name="file-fade" tag="div" class="space-y-3">
                            <div v-for="(file, index) in selectedFiles" :key="file.name + index"
                                 class="file-preview group hover:scale-[1.01] hover:shadow-lg transition-all">
                                <div :class="getFileIconClass(file.name)" class="file-icon-wrapper">
                                    <i :class="getFileIcon(file.name)"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="font-semibold text-gray-800 truncate">{% raw %}{{ file.name }}{% endraw %}</p>
                                    <div class="flex items-center gap-3 mt-1">
                                        <p class="text-sm text-gray-500">{% raw %}{{ formatFileSize(file.size) }}{% endraw %}</p>
                                        <span class="text-gray-300">•</span>
                                        <p class="text-sm text-gray-500">{% raw %}{{ getFileType(file.name) }}{% endraw %}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div v-if="file.uploading" class="w-32">
                                        <div class="file-progress-bar">
                                            <div class="file-progress-fill" :style="{ width: (file.progress || 0) + '%' }"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1 text-right">{% raw %}{{ file.progress || 0 }}{% endraw %}%</p>
                                    </div>
                                    <button @click="removeFile(index)"
                                            class="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-white hover:bg-red-500 transition-all opacity-0 group-hover:opacity-100">
                                        <i class="mdi mdi-close text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </transition-group>

                        <!-- Trade Document Type Selector -->
                        <div class="mt-6 p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border-2 border-indigo-100">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                    <i class="mdi mdi-file-document-outline text-white text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-sm font-bold text-gray-800 mb-2">
                                        <i class="mdi mdi-tag-outline mr-1"></i>
                                        Document Type (Optional)
                                    </label>
                                    <p class="text-xs text-gray-600 mb-3">
                                        Select a document type to extract standardized UN/CEFACT fields. Leave blank for auto-detection.
                                    </p>
                                    <select v-model="selectedTradeDocumentType"
                                            @change="onTradeDocumentTypeChange"
                                            class="w-full px-4 py-3 border-2 border-indigo-200 rounded-lg focus:outline-none focus:border-indigo-500 bg-white text-gray-800 font-medium transition-all hover:border-indigo-300">
                                        <option value="">Auto-detect document type</option>
                                        <optgroup label="Trade Finance">
                                            <option v-for="doc in tradeFinanceDocuments" :key="doc.code" :value="doc.code">
                                                {% raw %}{{ doc.code }} - {{ doc.name }}{% endraw %}
                                            </option>
                                        </optgroup>
                                        <optgroup label="Transport Documents">
                                            <option v-for="doc in transportDocuments" :key="doc.code" :value="doc.code">
                                                {% raw %}{{ doc.code }} - {{ doc.name }}{% endraw %}
                                            </option>
                                        </optgroup>
                                        <optgroup label="Customs & Compliance">
                                            <option v-for="doc in customsDocuments" :key="doc.code" :value="doc.code">
                                                {% raw %}{{ doc.code }} - {{ doc.name }}{% endraw %}
                                            </option>
                                        </optgroup>
                                        <optgroup label="Other Documents">
                                            <option v-for="doc in otherDocuments" :key="doc.code" :value="doc.code">
                                                {% raw %}{{ doc.code }} - {{ doc.name }}{% endraw %}
                                            </option>
                                        </optgroup>
                                    </select>

                                    <!-- Processing Mode Selection -->
                                    <div class="mt-4">
                                        <label for="processing-mode" class="block text-sm font-bold text-gray-800 mb-2">
                                            <i class="mdi mdi-file-multiple text-indigo-600 mr-1"></i>
                                            Processing Mode
                                        </label>
                                        <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                            <div class="flex items-center space-x-4">
                                                <label class="flex items-center cursor-pointer">
                                                    <input type="radio"
                                                           v-model="processingMode"
                                                           value="single"
                                                           name="processing-mode"
                                                           class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                                    <span class="ml-2 text-sm text-gray-700">
                                                        <span class="font-medium">Single Document</span>
                                                        <div class="text-xs text-gray-500">Treat all pages as one document</div>
                                                    </span>
                                                </label>
                                                <label class="flex items-center cursor-pointer">
                                                    <input type="radio"
                                                           v-model="processingMode"
                                                           value="page_by_page"
                                                           name="processing-mode"
                                                           class="w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                                    <span class="ml-2 text-sm text-gray-700">
                                                        <span class="font-medium">Page-by-Page</span>
                                                        <div class="text-xs text-gray-500">Detect different document types per page</div>
                                                    </span>
                                                </label>
                                            </div>
                                            <div class="mt-2 text-xs text-gray-600 bg-blue-50 border border-blue-200 rounded p-2">
                                                <i class="mdi mdi-information text-blue-600 mr-1"></i>
                                                <strong>Page-by-Page Mode:</strong> Ideal for multi-document uploads (e.g., LC + Payment Confirmation in one PDF)
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Field Requirements Display -->
                                    <div v-if="selectedTradeDocumentType && tradeDocumentFields" class="mt-4 p-4 bg-white rounded-lg border border-indigo-200">
                                        <div class="flex items-center justify-between mb-3">
                                            <h4 class="text-sm font-bold text-gray-800">
                                                <i class="mdi mdi-format-list-checks text-indigo-600 mr-1"></i>
                                                Field Requirements
                                            </h4>
                                            <span class="text-xs text-gray-500">{% raw %}{{ (tradeDocumentFields.statistics && tradeDocumentFields.statistics.total) || 0 }}{% endraw %} total fields</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-3 text-xs">
                                            <div class="bg-red-50 border border-red-200 rounded-lg p-2 text-center">
                                                <div class="font-bold text-red-700">{% raw %}{{ (tradeDocumentFields.statistics && tradeDocumentFields.statistics.mandatory) || 0 }}{% endraw %}</div>
                                                <div class="text-red-600">Mandatory</div>
                                            </div>
                                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-2 text-center">
                                                <div class="font-bold text-blue-700">{% raw %}{{ (tradeDocumentFields.statistics && tradeDocumentFields.statistics.optional) || 0 }}{% endraw %}</div>
                                                <div class="text-blue-600">Optional</div>
                                            </div>
                                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-2 text-center">
                                                <div class="font-bold text-yellow-700">{% raw %}{{ (tradeDocumentFields.statistics && tradeDocumentFields.statistics.conditional) || 0 }}{% endraw %}</div>
                                                <div class="text-yellow-600">Conditional</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button @click="processFiles" class="btn-primary w-full mt-6 group relative overflow-hidden">
                            <span class="relative z-10 flex items-center justify-center">
                                <i class="mdi mdi-rocket-launch mr-2 group-hover:animate-bounce"></i>
                                Analyze {% raw %}{{ selectedFiles.length }}{% endraw %} Document{% raw %}{{ selectedFiles.length > 1 ? 's' : '' }}{% endraw %}
                            </span>
                            <div class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-purple-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        </button>
                    </div>
                </div>

                <!-- Professional Processing Overlay -->
                <div v-if="processing" class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50">
                    <div class="processing-card text-center animate-slide-in" :data-progress="Math.round((currentStep + 1) / steps.length * 100) + '%'" data-vue="true">
                        <!-- Left Section - Icon and Title -->
                        <div class="processing-left">
                            <!-- Professional Animated Icon Section -->
                            <div class="processing-brain">
                                <div class="processing-brain-bg"></div>
                                <div class="processing-brain-inner">
                                    <i class="mdi mdi-file-document-check"></i>
                                </div>
                            </div>

                            <!-- Enhanced Title Section -->
                            <h3>Processing Documents</h3>
                            <p>{% raw %}{{ processingStatus || 'AI-Powered Compliance Verification' }}{% endraw %}</p>
                        </div>

                        <!-- Right Section - Steps and Progress -->
                        <div class="processing-right">
                            <!-- Professional Step Indicators -->
                            <div class="space-y-2">
                                <div v-for="(step, index) in steps" :key="index"
                                     class="step-indicator"
                                     :class="{
                                         'active': currentStep > index,
                                         'processing': currentStep === index
                                     }">
                                    <div class="step-number">
                                        <i v-if="currentStep > index" class="mdi mdi-check"></i>
                                        <i v-else-if="currentStep === index" class="mdi mdi-loading"></i>
                                        <span v-else>{% raw %}{{ index + 1 }}{% endraw %}</span>
                                    </div>
                                    <div class="flex-1 text-left">
                                        <span>{% raw %}{{ step }}{% endraw %}</span>
                                    </div>
                                    <div class="step-status">
                                        <i v-if="currentStep > index" class="mdi mdi-check-circle text-green-500"></i>
                                        <i v-else-if="currentStep === index" class="mdi mdi-loading text-blue-500"></i>
                                        <i v-else class="mdi mdi-circle-outline text-gray-400"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Progress Bar -->
                            <div class="mt-8">
                                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-purple-500 to-indigo-500 transition-all duration-500"
                                         :style="{ width: Math.min(100, ((currentStep + 1) / steps.length * 100)) + '%' }"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div v-if="results" class="space-y-6 animate-slide-in">
                    <div class="glass-card p-8">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Classification Results</h2>
                                <p class="text-gray-600">Successfully analyzed {% raw %}{{ results.length }}{% endraw %} document{% raw %}{{ results.length > 1 ? 's' : '' }}{% endraw %}</p>
                            </div>
                            <button @click="reset" class="btn-primary">
                                <i class="mdi mdi-refresh"></i>
                                Upload More
                            </button>
                        </div>

                        <!-- Enhanced Results Grid -->
                        <div class="grid gap-4">
                            <transition-group name="file-fade">
                                <div v-for="(result, index) in results" :key="result.fileName + index" class="result-item animate-slide-in" :style="{ animationDelay: index * 0.1 + 's' }">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center animate-float" :style="{ animationDelay: index * 0.2 + 's' }">
                                                <i :class="getFileIcon(result.fileName)" class="text-2xl text-purple-600"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">{% raw %}{{ result.documentType }}{% endraw %}</h3>
                                                <p class="text-sm text-gray-600">{% raw %}{{ result.fileName }}{% endraw %}</p>
                                                <p v-if="result.pageRange" class="text-xs text-purple-600 font-medium">{% raw %}{{ result.pageRange }}{% endraw %}</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <button @click="viewDetails(index)" class="btn-primary text-sm px-4 py-2 group">
                                                <i class="mdi mdi-eye mr-1 group-hover:animate-pulse"></i>
                                                View Details
                                            </button>
                                            <button @click="toggleInsights(index)" class="btn-secondary text-sm px-4 py-2 group">
                                                <i :class="result.insightsExpanded ? 'mdi mdi-chevron-up' : 'mdi mdi-chart-line'" class="mr-1 group-hover:animate-bounce"></i>
                                                More Insights
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Confidence Progress Bar -->

                                    <!-- Enhanced Quick Stats -->
                                    <div class="grid grid-cols-3 gap-6 mt-4">
                                        <div class="stat-card group">
                                            <div class="metric-number text-2xl group-hover:scale-110 transition-transform">{% raw %}{{ result.fieldsExtracted }}{% endraw %}</div>
                                            <div class="text-xs text-gray-600 mt-1">Fields Extracted</div>
                                        </div>
                                        <div class="stat-card group">
                                            <div class="metric-number text-2xl text-green-600 group-hover:scale-110 transition-transform">{% raw %}{{ result.complianceScore }}{% endraw %}%</div>
                                            <div class="text-xs text-gray-600 mt-1">Compliance Score</div>
                                        </div>
                                        <div class="stat-card group">
                                            <div class="metric-number text-2xl text-blue-600 group-hover:scale-110 transition-transform">{% raw %}{{ result.processingTime }}{% endraw %}s</div>
                                            <div class="text-xs text-gray-600 mt-1">Processing Time</div>
                                        </div>
                                    </div>

                                    <!-- More Insights Expandable Section -->
                                    <transition name="insights">
                                        <div v-if="result.insightsExpanded" class="mt-6 pt-6 border-t border-gray-300 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 rounded-xl p-8 shadow-lg animate-slide-in">
                                            <h4 class="font-bold text-xl text-gray-800 mb-6 flex items-center">
                                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3 shadow-md animate-bounce-slow">
                                                    <i class="mdi mdi-chart-line text-white text-lg"></i>
                                                </div>
                                                Document Intelligence Dashboard
                                                <div class="ml-auto flex items-center space-x-2">
                                                    <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium">✓ Processed</span>
                                                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium">AI Enhanced</span>
                                                </div>
                                            </h4>
                                            
                                            <!-- Enhanced Image Quality Metrics - Full Width Premium Tile -->
                                            <div class="mb-8">
                                                <div class="glass-card p-8 bg-gradient-to-br from-white via-indigo-50 to-purple-50 border border-indigo-200 shadow-xl">
                                                    <div class="flex items-center justify-between mb-6">
                                                        <h5 class="font-bold text-xl text-gray-800 flex items-center">
                                                            <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center mr-3 shadow-lg animate-pulse">
                                                                <i class="mdi mdi-image-filter text-white text-lg"></i>
                                                            </div>
                                                            Advanced Image Quality Analysis
                                                        </h5>
                                                        <div class="flex items-center space-x-3">
                                                            <span class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-medium">AI Enhanced</span>
                                                            <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-medium">Real-time</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Advanced Chart Layout -->
                                                    <div class="grid grid-cols-12 gap-6">
                                                        <!-- Main Quality Chart - 8 columns -->
                                                        <div class="col-span-8">
                                                            <div class="relative h-80 bg-gradient-to-br from-white via-gray-50 to-indigo-50 rounded-xl p-6 shadow-inner border border-indigo-100">
                                                                <canvas :id="'advancedQualityChart-' + index" class="w-full h-full"></canvas>
                                                                
                                                                <!-- Advanced Chart Legend -->
                                                                <div class="absolute top-4 right-4 bg-white/95 backdrop-blur-sm rounded-lg p-3 shadow-lg border border-indigo-100">
                                                                    <div class="text-xs font-semibold text-gray-700 mb-2">Quality Metrics</div>
                                                                    <div class="space-y-1">
                                                                        <div class="flex items-center justify-between space-x-3">
                                                                            <div class="flex items-center space-x-2">
                                                                                <div class="w-3 h-3 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full shadow-sm"></div>
                                                                                <span class="text-xs text-gray-600">Brightness</span>
                                                                            </div>
                                                                            <span class="text-xs font-bold text-blue-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85 }}{% endraw %}%</span>
                                                                        </div>
                                                                        <div class="flex items-center justify-between space-x-3">
                                                                            <div class="flex items-center space-x-2">
                                                                                <div class="w-3 h-3 bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full shadow-sm"></div>
                                                                                <span class="text-xs text-gray-600">Contrast</span>
                                                                            </div>
                                                                            <span class="text-xs font-bold text-emerald-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.contrast_score?.percentage || 90 }}{% endraw %}%</span>
                                                                        </div>
                                                                        <div class="flex items-center justify-between space-x-3">
                                                                            <div class="flex items-center space-x-2">
                                                                                <div class="w-3 h-3 bg-gradient-to-r from-purple-400 to-purple-600 rounded-full shadow-sm"></div>
                                                                                <span class="text-xs text-gray-600">Sharpness</span>
                                                                            </div>
                                                                            <span class="text-xs font-bold text-purple-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.sharpness_score?.percentage || 95 }}{% endraw %}%</span>
                                                                        </div>
                                                                        <div class="flex items-center justify-between space-x-3">
                                                                            <div class="flex items-center space-x-2">
                                                                                <div class="w-3 h-3 bg-gradient-to-r from-orange-400 to-orange-600 rounded-full shadow-sm"></div>
                                                                                <span class="text-xs text-gray-600">Text Clarity</span>
                                                                            </div>
                                                                            <span class="text-xs font-bold text-orange-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.text_clarity?.percentage || 88 }}{% endraw %}%</span>
                                                                        </div>
                                                                        <div class="flex items-center justify-between space-x-3">
                                                                            <div class="flex items-center space-x-2">
                                                                                <div class="w-3 h-3 bg-gradient-to-r from-indigo-400 to-indigo-600 rounded-full shadow-sm"></div>
                                                                                <span class="text-xs text-gray-600">Overall Readability</span>
                                                                            </div>
                                                                            <span class="text-xs font-bold text-indigo-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.overall_readability?.percentage || 92 }}{% endraw %}%</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Quality Score Cards - 4 columns -->
                                                        <div class="col-span-4 space-y-4">
                                                            <!-- Overall Quality Score -->
                                                            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 p-4 rounded-xl border border-indigo-200 text-center">
                                                                <div class="text-2xl font-bold text-indigo-600 mb-1">
                                                                    {% raw %}{{ Math.round(((result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) + (result._rawResult?.quality_analysis?.average_metrics?.contrast_score?.percentage || 90) + (result._rawResult?.quality_analysis?.average_metrics?.sharpness_score?.percentage || 95) + (result._rawResult?.quality_analysis?.average_metrics?.text_clarity?.percentage || 88) + (result._rawResult?.quality_analysis?.average_metrics?.overall_readability?.percentage || 92)) / 5) }}{% endraw %}%
                                                                </div>
                                                                <div class="text-sm text-indigo-700 font-medium">Overall Quality</div>
                                                                <div class="text-xs text-gray-500 mt-1">AI Assessment</div>
                                                            </div>
                                                            
                                                            <!-- Individual Metric Cards -->
                                                            <div class="grid grid-cols-2 gap-3">
                                                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-200 text-center">
                                                                    <div class="text-lg font-bold text-blue-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85 }}{% endraw %}%</div>
                                                                    <div class="text-xs text-blue-700">Brightness</div>
                                                                </div>
                                                                <div class="bg-emerald-50 p-3 rounded-lg border border-emerald-200 text-center">
                                                                    <div class="text-lg font-bold text-emerald-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.contrast_score?.percentage || 90 }}{% endraw %}%</div>
                                                                    <div class="text-xs text-emerald-700">Contrast</div>
                                                                </div>
                                                                <div class="bg-purple-50 p-3 rounded-lg border border-purple-200 text-center">
                                                                    <div class="text-lg font-bold text-purple-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.sharpness_score?.percentage || 95 }}{% endraw %}%</div>
                                                                    <div class="text-xs text-purple-700">Sharpness</div>
                                                                </div>
                                                                <div class="bg-orange-50 p-3 rounded-lg border border-orange-200 text-center">
                                                                    <div class="text-lg font-bold text-orange-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.text_clarity?.percentage || 88 }}{% endraw %}%</div>
                                                                    <div class="text-xs text-orange-700">Text Clarity</div>
                                                                </div>
                                                                <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-200 text-center">
                                                                    <div class="text-lg font-bold text-indigo-600">{% raw %}{{ result._rawResult?.quality_analysis?.average_metrics?.overall_readability?.percentage || 92 }}{% endraw %}%</div>
                                                                    <div class="text-xs text-indigo-700">Overall Readability</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Reorganized 3-Column Layout -->
                                            <div class="grid grid-cols-3 gap-8">
                                                
                                                <!-- Left Column: Processing Performance -->
                                                <div class="space-y-6">
                                                    
                                                    <!-- Real-Time Processing Performance -->
                                                    <div class="glass-card p-6 bg-gradient-to-br from-white to-blue-50 border border-blue-100">
                                                        <h5 class="font-semibold text-gray-700 mb-4 flex items-center">
                                                            <i class="mdi mdi-speedometer mr-2 text-blue-500"></i>
                                                            Processing Performance
                                                        </h5>
                                                        
                                                        <!-- Real Performance Metrics with Dynamic Calculations -->
                                                        <div class="space-y-4">
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="relative w-12 h-12">
                                                                        <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                                                            <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                            <path class="text-emerald-500" stroke="currentColor" stroke-width="3" fill="none" v-bind:stroke-dasharray="`${parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        </svg>
                                                                        <div class="absolute inset-0 flex items-center justify-center">
                                                                            <i class="mdi mdi-file-check text-emerald-500 text-lg"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Quality Check</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.qualityTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-emerald-600">{% raw %}{{ parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3)) }}{% endraw %}%</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="relative w-12 h-12">
                                                                        <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                                                            <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                            <path class="text-orange-500" stroke="currentColor" stroke-width="3" fill="none" v-bind:stroke-dasharray="`${parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        </svg>
                                                                        <div class="absolute inset-0 flex items-center justify-center">
                                                                            <i class="mdi mdi-text-recognition text-orange-500 text-lg"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">OCR Processing</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.ocrTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-orange-600">{% raw %}{{ parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2)) }}{% endraw %}%</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="relative w-12 h-12">
                                                                        <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                                                            <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                            <path class="text-blue-500" stroke="currentColor" stroke-width="3" fill="none" v-bind:stroke-dasharray="`${parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        </svg>
                                                                        <div class="absolute inset-0 flex items-center justify-center">
                                                                            <i class="mdi mdi-robot text-blue-500 text-lg"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">AI Classification</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.classificationTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-blue-600">{% raw %}{{ parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5)) }}{% endraw %}%</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="relative w-12 h-12">
                                                                        <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                                                            <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                            <path class="text-purple-500" stroke="currentColor" stroke-width="3" fill="none" v-bind:stroke-dasharray="`${parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        </svg>
                                                                        <div class="absolute inset-0 flex items-center justify-center">
                                                                            <i class="mdi mdi-text-box-search text-purple-500 text-lg"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Entity Extraction</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.llmTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-purple-600">{% raw %}{{ parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2)) }}{% endraw %}%</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="relative w-12 h-12">
                                                                        <svg class="w-12 h-12 transform -rotate-90" viewBox="0 0 36 36">
                                                                            <path class="text-gray-200" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                            <path class="text-red-500" stroke="currentColor" stroke-width="3" fill="none" v-bind:stroke-dasharray="`${result.complianceTime && parseFloat(result.complianceTime) > 0 ? Math.round(Math.max(0, 100 - (parseFloat(result.complianceTime) * 4))) : 0}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        </svg>
                                                                        <div class="absolute inset-0 flex items-center justify-center">
                                                                            <i class="mdi mdi-shield-check text-red-500 text-lg"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Compliance Check</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.complianceTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-red-600">{% raw %}{{ result.complianceTime && parseFloat(result.complianceTime) > 0 ? Math.round(Math.max(0, 100 - (parseFloat(result.complianceTime) * 4))) : 0 }}{% endraw %}%</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Processing Timeline - Moved from Center to Left Column -->
                                                    <div class="glass-card p-6 bg-gradient-to-br from-white to-orange-50 border border-orange-100 mt-6">
                                                        <h5 class="font-semibold text-gray-700 mb-4 flex items-center">
                                                            <i class="mdi mdi-timeline-clock mr-2 text-orange-500"></i>
                                                            Processing Timeline
                                                        </h5>
                                                        
                                                        <div class="relative">
                                                            <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-400 to-green-400"></div>
                                                            
                                                            <div class="space-y-3">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                                                        <i class="mdi mdi-upload text-white text-xs"></i>
                                                                    </div>
                                                                    <div class="flex-1">
                                                                        <p class="text-sm font-medium text-gray-700">Upload & Quality Check</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.qualityTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center z-10">
                                                                        <i class="mdi mdi-eye text-white text-xs"></i>
                                                                    </div>
                                                                    <div class="flex-1">
                                                                        <p class="text-sm font-medium text-gray-700">OCR Processing</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.ocrTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center z-10">
                                                                        <i class="mdi mdi-brain text-white text-xs"></i>
                                                                    </div>
                                                                    <div class="flex-1">
                                                                        <p class="text-sm font-medium text-gray-700">AI Classification</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.classificationTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center z-10">
                                                                        <i class="mdi mdi-check text-white text-xs"></i>
                                                                    </div>
                                                                    <div class="flex-1">
                                                                        <p class="text-sm font-medium text-gray-700">Field Extraction</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.llmTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center z-10">
                                                                        <i class="mdi mdi-shield-check text-white text-xs"></i>
                                                                    </div>
                                                                    <div class="flex-1">
                                                                        <p class="text-sm font-medium text-gray-700">Compliance Check</p>
                                                                        <p class="text-xs text-gray-500">{% raw %}{{ result.complianceTime || '0.0' }}{% endraw %}s</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Center: Document Intelligence -->
                                                <div class="space-y-6">
                                                    <div class="glass-card p-6 bg-gradient-to-br from-white to-purple-50 border border-purple-100">
                                                        <h5 class="font-semibold text-gray-700 mb-4 flex items-center">
                                                            <i class="mdi mdi-file-document-outline mr-2 text-purple-500"></i>
                                                            Document Profile
                                                        </h5>
                                                        
                                                        <div class="space-y-4">
                                                            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                                        <i class="mdi mdi-file-outline text-white text-sm"></i>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Document Type</p>
                                                                        <p class="text-xs text-gray-500">Classified with AI</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-blue-600">{% raw %}{{ result.documentType }}{% endraw %}</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-green-100 rounded-lg">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                                        <i class="mdi mdi-check-bold text-white text-sm"></i>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Confidence</p>
                                                                        <p class="text-xs text-gray-500">AI Certainty Level</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-green-600">{% raw %}{{ result.confidence }}{% endraw %}%</span>
                                                            </div>
                                                            
                                                            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg">
                                                                <div class="flex items-center space-x-3">
                                                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                                                        <i class="mdi mdi-text-box-multiple-outline text-white text-sm"></i>
                                                                    </div>
                                                                    <div>
                                                                        <p class="text-sm font-medium text-gray-700">Fields Extracted</p>
                                                                        <p class="text-xs text-gray-500">Data Points Found</p>
                                                                    </div>
                                                                </div>
                                                                <span class="text-sm font-bold text-purple-600">{% raw %}{{ result.fieldsExtracted }}{% endraw %}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Overall Score Card - Centered for Perfect Alignment -->
                                                    <div class="glass-card p-6 bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100">
                                                        <div class="text-center">
                                                            <div class="text-3xl font-bold mb-2" :class="Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'text-green-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'text-blue-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'text-yellow-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'text-orange-600' : 'text-red-600'">{% raw %}{{ Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) }}{% endraw %}%</div>
                                                            <div class="text-sm text-gray-600 mb-3">Overall Performance Score</div>
                                                            <div class="flex justify-center space-x-1">
                                                                <i v-for="star in 5" :key="star" :class="star <= Math.ceil(Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) / 20) ? (Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'text-green-500' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'text-blue-500' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'text-yellow-500' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'text-orange-500' : 'text-red-500') : 'text-gray-300'" class="mdi mdi-star text-lg"></i>
                                                            </div>
                                                            <div class="mt-2 text-xs font-medium" :class="Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'text-green-700' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'text-blue-700' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'text-yellow-700' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'text-orange-700' : 'text-red-700'">
                                                                {% raw %}{{ Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'Excellent' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'Very Good' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'Good' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'Fair' : 'Needs Improvement' }}{% endraw %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Right: Advanced Analytics -->
                                                <div class="space-y-6">
                                                    <div class="glass-card p-6 bg-gradient-to-br from-white to-indigo-50 border border-indigo-100">
                                                        <h5 class="font-semibold text-gray-700 mb-4 flex items-center">
                                                            <i class="mdi mdi-chart-box-outline mr-2 text-indigo-500"></i>
                                                            Performance Analytics
                                                        </h5>
                                                        
                                                        <div class="space-y-4">
                                                            <!-- Processing Speed Gauge -->
                                                            <div class="text-center">
                                                                <div class="relative w-24 h-24 mx-auto mb-3">
                                                                    <svg class="w-24 h-24 transform -rotate-90" viewBox="0 0 36 36">
                                                                        <path class="text-gray-200" stroke="currentColor" stroke-width="2" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        <path class="text-gradient-to-r from-blue-500 to-green-500" stroke="url(#gradient)" stroke-width="2" fill="none" v-bind:stroke-dasharray="`${Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5)}, 100`" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                                                        <defs>
                                                                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                                                <stop offset="0%" style="stop-color:#3B82F6"/>
                                                                                <stop offset="100%" style="stop-color:#10B981"/>
                                                                            </linearGradient>
                                                                        </defs>
                                                                    </svg>
                                                                    <div class="absolute inset-0 flex items-center justify-center">
                                                                        <div class="text-center">
                                                                            <div class="text-lg font-bold text-gray-700">{% raw %}{{ Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) }}{% endraw %}%</div>
                                                                            <div class="text-xs text-gray-500">Score</div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <p class="text-sm font-medium text-gray-600">Processing Efficiency</p>
                                                            </div>
                                                            
                                                            <!-- Key Metrics -->
                                                            <div class="space-y-3">
                                                                <div class="flex justify-between items-center">
                                                                    <span class="text-sm text-gray-600">Total Time</span>
                                                                    <span class="text-sm font-bold text-blue-600">{% raw %}{{ result.processingTime }}{% endraw %}s</span>
                                                                </div>
                                                                <div class="flex justify-between items-center">
                                                                    <span class="text-sm text-gray-600">Fastest Stage</span>
                                                                    <span class="text-sm font-bold text-green-600">{% raw %}{{ [
                                                                        {name: 'Quality', time: parseFloat(result.qualityTime || 0)}, 
                                                                        {name: 'OCR', time: parseFloat(result.ocrTime || 0)}, 
                                                                        {name: 'Classification', time: parseFloat(result.classificationTime || 0)}, 
                                                                        {name: 'Entity Extract', time: parseFloat(result.llmTime || 0)}, 
                                                                        {name: 'Compliance', time: parseFloat(result.complianceTime || 0)}
                                                                    ].filter(s => s.time > 0).sort((a, b) => a.time - b.time)[0]?.name || 'N/A' }}{% endraw %}</span>
                                                                </div>
                                                                <div class="flex justify-between items-center">
                                                                    <span class="text-sm text-gray-600">Data Quality</span>
                                                                    <span class="text-sm font-bold" :class="result.confidence >= 95 ? 'text-green-600' : result.confidence >= 85 ? 'text-blue-600' : result.confidence >= 75 ? 'text-yellow-600' : result.confidence >= 60 ? 'text-orange-600' : 'text-red-600'">{% raw %}{{ result.confidence >= 95 ? 'Excellent' : result.confidence >= 85 ? 'Very Good' : result.confidence >= 75 ? 'Good' : result.confidence >= 60 ? 'Fair' : 'Poor' }}{% endraw %}</span>
                                                                </div>
                                                                <div class="flex justify-between items-center">
                                                                    <span class="text-sm text-gray-600">Overall Performance</span>
                                                                    <span class="text-sm font-bold" :class="Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'text-green-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'text-blue-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'text-yellow-600' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'text-orange-600' : 'text-red-600'">
                                                                        {% raw %}{{ Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 90 ? 'Excellent' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 80 ? 'Very Good' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 70 ? 'Good' : Math.round(((parseFloat(result.qualityTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.qualityTime || 0) * 3))) + (parseFloat(result.ocrTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.ocrTime || 0) * 2))) + (parseFloat(result.classificationTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.classificationTime || 0) * 2.5))) + (parseFloat(result.llmTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.llmTime || 0) * 2))) + (parseFloat(result.complianceTime || 0) === 0 ? 0 : Math.max(0, 100 - (parseFloat(result.complianceTime || 0) * 4)))) / 5) >= 60 ? 'Fair' : 'Poor' }}{% endraw %}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- AI Recommendations -->
                                                    <div class="glass-card p-4 bg-gradient-to-br from-white via-yellow-50 to-amber-50 border border-yellow-100 shadow-lg">
                                                        <h5 class="font-semibold text-gray-800 mb-3 flex items-center">
                                                            <i class="mdi mdi-lightbulb-outline mr-2 text-yellow-500"></i>
                                                            AI Recommendations
                                                        </h5>
                                                        
                                                        <div class="space-y-3">
                                                            <!-- Image Quality Recommendation -->
                                                            <div class="flex items-start space-x-3 p-3 rounded-lg" 
                                                                 :class="(result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 90 ? 
                                                                         'bg-green-50 border-l-4 border-green-400' : 
                                                                         (result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 80 ? 
                                                                         'bg-blue-50 border-l-4 border-blue-400' : 
                                                                         'bg-orange-50 border-l-4 border-orange-400'">
                                                                <i :class="(result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 90 ? 
                                                                           'mdi mdi-check-circle text-green-600' : 
                                                                           (result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 80 ? 
                                                                           'mdi mdi-information text-blue-600' : 
                                                                           'mdi mdi-alert text-orange-600'" class="text-lg mt-0.5"></i>
                                                                <p class="text-sm text-gray-700 leading-relaxed">
                                                                    {% raw %}{{ (result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 90 ? 
                                                                        'Document scan quality is excellent. Continue using current scanning settings for optimal results.' : 
                                                                        (result._rawResult?.quality_analysis?.average_metrics?.brightness_score?.percentage || 85) >= 80 ? 
                                                                        'Good image quality detected. Consider adjusting brightness or contrast for enhanced accuracy.' : 
                                                                        'Image quality could be improved. Try rescanning with better lighting or higher resolution.' }}{% endraw %}
                                                                </p>
                                                            </div>
                                                            
                                                            <!-- Processing Performance Recommendation -->
                                                            <div class="flex items-start space-x-3 p-3 rounded-lg"
                                                                 :class="parseFloat(result.processingTime || 0) <= 3 ? 
                                                                         'bg-green-50 border-l-4 border-green-400' : 
                                                                         parseFloat(result.processingTime || 0) <= 8 ? 
                                                                         'bg-yellow-50 border-l-4 border-yellow-400' : 
                                                                         'bg-red-50 border-l-4 border-red-400'">
                                                                <i :class="parseFloat(result.processingTime || 0) <= 3 ? 
                                                                           'mdi mdi-rocket text-green-600' : 
                                                                           parseFloat(result.processingTime || 0) <= 8 ? 
                                                                           'mdi mdi-clock text-yellow-600' : 
                                                                           'mdi mdi-timer-alert text-red-600'" class="text-lg mt-0.5"></i>
                                                                <p class="text-sm text-gray-700 leading-relaxed">
                                                                    {% raw %}{{ parseFloat(result.processingTime || 0) <= 3 ? 
                                                                        'Excellent processing speed achieved. Your system is well-optimized for document analysis.' : 
                                                                        parseFloat(result.processingTime || 0) <= 8 ? 
                                                                        'Processing time is acceptable. Consider compressing images or upgrading hardware for faster results.' : 
                                                                        'Processing is slower than expected. Check image size, system resources, or network connectivity.' }}{% endraw %}
                                                                </p>
                                                            </div>
                                                            
                                                            <!-- Classification Accuracy Recommendation -->
                                                            <div class="flex items-start space-x-3 p-3 rounded-lg"
                                                                 :class="result.confidence >= 95 ? 
                                                                         'bg-purple-50 border-l-4 border-purple-400' : 
                                                                         result.confidence >= 85 ? 
                                                                         'bg-blue-50 border-l-4 border-blue-400' : 
                                                                         result.confidence >= 75 ? 
                                                                         'bg-yellow-50 border-l-4 border-yellow-400' : 
                                                                         'bg-red-50 border-l-4 border-red-400'">
                                                                <i :class="result.confidence >= 95 ? 
                                                                           'mdi mdi-star text-purple-600' : 
                                                                           result.confidence >= 85 ? 
                                                                           'mdi mdi-thumb-up text-blue-600' : 
                                                                           result.confidence >= 75 ? 
                                                                           'mdi mdi-help-circle text-yellow-600' : 
                                                                           'mdi mdi-alert-circle text-red-600'" class="text-lg mt-0.5"></i>
                                                                <p class="text-sm text-gray-700 leading-relaxed">
                                                                    {% raw %}{{ result.confidence >= 95 ? 
                                                                        'Outstanding classification accuracy! The AI has identified the document type with high confidence.' : 
                                                                        result.confidence >= 85 ? 
                                                                        'Good classification results. The document structure and content are clearly recognized.' : 
                                                                        result.confidence >= 75 ? 
                                                                        'Moderate classification confidence. Consider manual review to verify document type accuracy.' : 
                                                                        'Low classification confidence detected. Manual verification is strongly recommended before processing.' }}{% endraw %}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Analytics Dashboard - At End of Document Intelligence Section -->
                                            <div class="mb-8 mt-8">
                                                <div class="glass-card p-8 bg-gradient-to-br from-white via-blue-50 to-indigo-50 border border-blue-100 shadow-xl">
                                                    <div class="flex items-center justify-between mb-6">
                                                        <h5 class="font-bold text-xl text-gray-800 flex items-center">
                                                            <div class="w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center mr-3 shadow-lg animate-spin-slow">
                                                                <i class="mdi mdi-chart-areaspline text-white text-lg"></i>
                                                            </div>
                                                            Analytics Dashboard
                                                        </h5>
                                                        <div class="flex items-center space-x-3">
                                                            <!-- Removed old fake metric indicators -->
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Chart Container with Premium Styling -->
                                                    <div class="relative h-80 bg-gradient-to-br from-white to-gray-50 rounded-xl p-6 shadow-inner border border-gray-100">
                                                        <canvas :id="'qualityChart-' + index" class="w-full h-full"></canvas>
                                                        
                                                        <!-- Removed old fake performance indicators -->
                                                    </div>
                                                    
                                                    <!-- Removed old fake metrics tiles -->
                                                </div>
                                            </div>
                                        </div>
                                    </transition>
                                </div>
                            </transition-group>
                        </div>
                    </div>

                    <!-- Enhanced Processing Metrics Section -->
                    <div class="mt-8 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="mdi mdi-chart-timeline-variant mr-2 text-purple-600"></i>
                            Processing Performance Metrics
                        </h3>
                        <div class="grid grid-cols-5 gap-6">
                            <div class="glass-card p-6 bg-gradient-to-br from-emerald-50 to-emerald-100">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <h4 class="font-semibold text-gray-700">Quality</h4>
                                        <p class="text-xs text-gray-500">Document Quality Analysis</p>
                                    </div>
                                    <i class="mdi mdi-file-check text-3xl text-emerald-500"></i>
                                </div>
                                <div class="metric-number text-3xl text-emerald-600">{% raw %}{{ avgQualityTime }}{% endraw %}s</div>
                                <p class="text-xs text-gray-600 mt-2">Average Time</p>
                            </div>
                            <div class="glass-card p-6 bg-gradient-to-br from-purple-50 to-purple-100">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <h4 class="font-semibold text-gray-700">OCR Processing</h4>
                                        <p class="text-xs text-gray-500">Azure Cognitive Services</p>
                                    </div>
                                    <i class="mdi mdi-eye-check text-3xl text-purple-500"></i>
                                </div>
                                <div class="metric-number text-3xl text-purple-600">{% raw %}{{ avgOcrTime }}{% endraw %}s</div>
                                <p class="text-xs text-gray-600 mt-2">Average Time</p>
                            </div>
                            <div class="glass-card p-6 bg-gradient-to-br from-blue-50 to-blue-100">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <h4 class="font-semibold text-gray-700">Classification</h4>
                                        <p class="text-xs text-gray-500">Document Type Detection</p>
                                    </div>
                                    <i class="mdi mdi-file-find text-3xl text-blue-500"></i>
                                </div>
                                <div class="metric-number text-3xl text-blue-600">{% raw %}{{ avgClassificationTime }}{% endraw %}s</div>
                                <p class="text-xs text-gray-600 mt-2">Average Time</p>
                            </div>
                            <div class="glass-card p-6 bg-gradient-to-br from-indigo-50 to-indigo-100">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <h4 class="font-semibold text-gray-700">Entity Extraction</h4>
                                        <p class="text-xs text-gray-500">AI Field Extraction</p>
                                    </div>
                                    <i class="mdi mdi-text-box-search text-3xl text-indigo-500"></i>
                                </div>
                                <div class="metric-number text-3xl text-indigo-600">{% raw %}{{ avgEntityExtractionTime }}{% endraw %}s</div>
                                <p class="text-xs text-gray-600 mt-2">Average Time</p>
                            </div>
                            <div class="glass-card p-6 bg-gradient-to-br from-green-50 to-green-100">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <h4 class="font-semibold text-gray-700">LLM Analysis</h4>
                                        <p class="text-xs text-gray-500">UCP600 & SWIFT Validation</p>
                                    </div>
                                    <i class="mdi mdi-brain text-3xl text-green-500"></i>
                                </div>
                                <div class="metric-number text-3xl text-green-600">{% raw %}{{ avgComplianceTime || '0.0' }}{% endraw %}s</div>
                                <p class="text-xs text-gray-600 mt-2">Average Time</p>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Stats -->
                    <div class="grid grid-cols-4 gap-8 mt-8">
                        <div class="glass-card p-6 text-center">
                            <i class="mdi mdi-file-multiple text-3xl text-purple-600 mb-2"></i>
                            <div class="metric-number">{% raw %}{{ results.length }}{% endraw %}</div>
                            <p class="text-gray-600 text-sm">Documents</p>
                        </div>
                        <div class="glass-card p-6 text-center">
                            <i class="mdi mdi-check-circle text-3xl text-green-600 mb-2"></i>
                            <div class="metric-number">{% raw %}{{ avgConfidence }}{% endraw %}%</div>
                            <p class="text-gray-600 text-sm">Accuracy</p>
                        </div>
                        <div class="glass-card p-6 text-center">
                            <i class="mdi mdi-text-box-search text-3xl text-blue-600 mb-2"></i>
                            <div class="metric-number">{% raw %}{{ totalFields }}{% endraw %}</div>
                            <p class="text-gray-600 text-sm">Fields</p>
                        </div>
                        <div class="glass-card p-6 text-center">
                            <i class="mdi mdi-timer text-3xl text-orange-600 mb-2"></i>
                            <div class="metric-number">{% raw %}{{ totalTime }}{% endraw %}s</div>
                            <p class="text-gray-600 text-sm">Total Time</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Document Details Modal -->
        <div v-if="showDetailsModal" class="details-modal">
            <div class="modal-container">
                <!-- Enhanced Modal Header -->
                <div class="modal-header">
                    <div class="flex items-start justify-between">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center">
                                    <i :class="getFileIcon(selectedResult?.fileName)" class="text-2xl text-purple-600"></i>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-800">{% raw %}{{ selectedResult?.documentType }}{% endraw %}</h2>
                                    <p class="text-gray-600">{% raw %}{{ selectedResult?.fileName }}{% endraw %}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-6 mt-3">
                                <!-- Page Navigation -->
                                <div v-if="selectedResult?.previewImages && selectedResult.previewImages.length > 0" class="flex items-center gap-2">
                                    <button @click="prevPage" :disabled="currentPage === 0"
                                            class="px-2 py-1 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 transition-colors">
                                        <i class="mdi mdi-chevron-left"></i>
                                    </button>
                                    <span class="px-3 py-1 bg-gray-100 rounded text-sm font-medium">
                                        Page {% raw %}{{ getAbsolutePageNumber(currentPage) }}{% endraw %} of {% raw %}{{ getTotalPages() }}{% endraw %}
                                    </span>
                                    <button @click="nextPage" :disabled="currentPage === selectedResult.previewImages.length - 1"
                                            class="px-2 py-1 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 transition-colors">
                                        <i class="mdi mdi-chevron-right"></i>
                                    </button>
                                </div>

                                <!-- Zoom Controls -->
                                <div class="flex items-center gap-2">
                                    <button @click="zoomOut" :disabled="zoomLevel <= 0.5"
                                            class="px-2 py-1 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 transition-colors">
                                        <i class="mdi mdi-magnify-minus"></i>
                                    </button>
                                    <span class="px-3 py-1 bg-gray-100 rounded text-sm font-medium min-w-[60px] text-center">
                                        {% raw %}{{ Math.round(zoomLevel * 100) }}{% endraw %}%
                                    </span>
                                    <button @click="zoomIn" :disabled="zoomLevel >= 3"
                                            class="px-2 py-1 bg-gray-100 rounded hover:bg-gray-200 disabled:opacity-50 transition-colors">
                                        <i class="mdi mdi-magnify-plus"></i>
                                    </button>
                                    <button @click="resetZoom"
                                            class="px-2 py-1 bg-gray-100 rounded hover:bg-gray-200 transition-colors">
                                        <i class="mdi mdi-fit-to-page-outline"></i>
                                    </button>
                                </div>

                                <!-- Export Button -->
                                <button @click="exportJSON" class="px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors flex items-center gap-2">
                                    <i class="mdi mdi-code-json"></i>
                                    <span class="text-sm font-medium">Export JSON</span>
                                </button>

                                <!-- Submit Button -->
                                <button @click="populateFormFields" class="px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors flex items-center gap-2">
                                    <i class="mdi mdi-check-circle"></i>
                                    <span class="text-sm font-medium">Submit</span>
                                </button>
                            </div>
                        </div>
                        <button @click="closeDetailsModal" class="text-gray-400 hover:text-gray-600 transition-all hover:rotate-90 hover:scale-110">
                            <i class="mdi mdi-close text-2xl"></i>
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 flex overflow-hidden">
                    <!-- Left Side - Enhanced Document Preview -->
                    <div class="w-1/2 relative bg-gray-900 overflow-hidden" style="height: calc(90vh - 140px);">

                        <!-- Drawing Tools -->
                        <div class="drawing-tools">
                            <button @click="currentTool = 'select'"
                                    :class="{ active: currentTool === 'select' }"
                                    class="tool-btn" title="Select">
                                <i class="mdi mdi-cursor-default"></i>
                            </button>
                            <button @click="currentTool = 'draw'"
                                    :class="{ active: currentTool === 'draw' }"
                                    class="tool-btn" title="Draw - Click and drag to draw">
                                <i class="mdi mdi-pencil"></i>
                            </button>
                            <button @click="currentTool = 'rectangle'"
                                    :class="{ active: currentTool === 'rectangle' }"
                                    class="tool-btn" title="Rectangle - Click and drag to draw rectangle">
                                <i class="mdi mdi-square-outline"></i>
                            </button>
                            <button @click="currentTool = 'textSelect'"
                                    :class="{ active: currentTool === 'textSelect' }"
                                    class="tool-btn" title="Text Selection - Select text to extract">
                                <i class="mdi mdi-format-text-variant-outline"></i>
                            </button>
                            <button @click="clearDrawings" class="tool-btn" title="Clear all drawings">
                                <i class="mdi mdi-eraser"></i>
                            </button>

                            <!-- Color Palette -->
                            <div class="color-palette">
                                <button v-for="color in drawColors" :key="color"
                                        @click="currentColor = color"
                                        :class="{ active: currentColor === color }"
                                        :style="{ backgroundColor: color }"
                                        class="color-btn"
                                        :title="'Select ' + color + ' color'"></button>
                            </div>
                        </div>

                        <!-- Drawing Help -->
                        <div v-if="currentTool !== 'select'" class="absolute top-20 left-6 bg-black/75 text-white px-3 py-2 rounded-lg text-sm">
                            <i class="mdi mdi-information-outline mr-1"></i>
                            <span v-if="currentTool === 'textSelect' && targetField">
                                Selecting text for: <strong>{% raw %}{{ formatFieldName(targetField) }}{% endraw %}</strong>
                            </span>
                            <span v-else>
                                {% raw %}{{ currentTool === 'draw' ? 'Click and drag to draw freely' : currentTool === 'rectangle' ? 'Click and drag to draw rectangle' : 'Click and drag to select text' }}{% endraw %}
                            </span>
                        </div>

                        <!-- Target Field Indicator -->
                        <div v-if="targetField" class="absolute top-20 right-6 bg-purple-600 text-white px-4 py-2 rounded-lg text-sm shadow-lg flex items-center gap-2">
                            <i class="mdi mdi-target"></i>
                            <span>Selecting for: <strong>{% raw %}{{ formatFieldName(targetField) }}{% endraw %}</strong></span>
                            <button @click="targetField = null; currentTool = 'select'" class="ml-2 hover:bg-purple-700 rounded p-1">
                                <i class="mdi mdi-close"></i>
                            </button>
                        </div>

                        <!-- Enhanced Image Viewer -->
                        <div class="image-viewer h-full overflow-auto"
                             :class="{ 'panning': isPanning, 'tool-active': currentTool !== 'select' }"
                             @wheel.prevent="handleWheel"
                             @mousedown="startPan"
                             @mousemove="pan"
                             @mouseup="endPan"
                             @mouseleave="endPan"
                             style="display: flex; align-items: center; justify-content: center; padding: 0;">
                            <div class="image-container"
                                 :style="{ transform: `translate(${panX}px, ${panY}px) scale(${zoomLevel})`, transformOrigin: 'center', position: 'relative', display: 'inline-block' }"
                                 v-if="selectedResult?.previewImages && selectedResult.previewImages[currentPage]">
                                <img ref="documentImage"
                                     :src="'data:image/png;base64,' + selectedResult.previewImages[currentPage]"
                                     :alt="'Page ' + (currentPage + 1)"
                                     @load="onImageLoad"
                                     class="document-image">

                                <!-- Canvas for drawing -->
                                <canvas ref="drawingCanvas"
                                        class="canvas-overlay"
                                        :class="{ drawing: currentTool !== 'select' }"
                                        @mousedown="startDrawing"
                                        @mousemove="draw"
                                        @mouseup="endDrawing"
                                        @mouseleave="endDrawing"></canvas>

                                <!-- Bounding boxes -->
                                <div v-for="(field, idx) in getFieldsWithBoundingBox()"
                                     :key="'bbox-' + idx"
                                     v-show="field && field.bounding_box && (field.bounding_page === currentPage || field.page === currentPage)"
                                     class="bounding-box"
                                     :class="{ active: activeFieldIndex === field.index }"
                                     :style="getBoundingBoxStyle(field)"
                                     @click="highlightField(field.index, field)"
                                     :title="field.fieldKey || field.name">
                                    <span class="bounding-box-label">{% raw %}{{ field.name }}{% endraw %}</span>
                                </div>
                            </div>

                            <div v-else class="text-center">
                                <i class="mdi mdi-file-document-outline text-6xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">No preview available</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side - Details -->
                    <div class="w-1/2 p-6 overflow-y-auto" style="max-height: calc(90vh - 140px);">
                        <!-- Document Classification Display -->
                        <div class="mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-purple-900">Document Classification</h3>
                                    <div class="mt-2">
                                        <p class="text-purple-700 font-medium">Type: {% raw %}{{ formatDocumentType(selectedResult?.documentType) }}{% endraw %}</p>
                                        <p v-if="selectedResult?.analysisResult?.document_subtype || getMainSubtype()" class="text-purple-600 text-sm mt-1">
                                            Subtype: {% raw %}{{ selectedResult?.analysisResult?.document_subtype || getMainSubtype() }}{% endraw %}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Per-Page Classification if available -->
                            <div v-if="selectedResult?.analysisResult?.per_page && selectedResult.analysisResult.per_page[currentPage]"
                                 class="mt-3 pt-3 border-t border-purple-200">
                                <p class="text-sm text-purple-600 mb-1">Current Page ({% raw %}{{ currentPage + 1 }}{% endraw %}):</p>
                                <div>
                                    <p class="text-purple-700 font-medium">
                                        {% raw %}{{ getPageDocumentType() }}{% endraw %}
                                    </p>
                                    <p v-if="getPageSubtype()" class="text-sm text-purple-600 mt-1">
                                        Subtype: {% raw %}{{ getPageSubtype() }}{% endraw %}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs -->
                        <div class="flex gap-4 mb-6 border-b border-gray-200">
                            <button @click="activeTab = 'fields'"
                                    class="pb-3 px-1 font-medium transition-colors"
                                    :class="activeTab === 'fields' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-gray-600 hover:text-gray-800'">
                                Extracted Fields
                            </button>
                            <button @click="selectedResult?.compliance?.ucp600 ? activeTab = 'ucp600' : null"
                                    class="pb-3 px-1 font-medium transition-colors"
                                    :class="[
                                        activeTab === 'ucp600' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-gray-600',
                                        selectedResult?.compliance?.ucp600 ? 'hover:text-gray-800 cursor-pointer' : 'opacity-50 cursor-not-allowed'
                                    ]">
                                UCP600
                            </button>
                            <button @click="selectedResult?.compliance?.swift ? activeTab = 'swift' : null"
                                    class="pb-3 px-1 font-medium transition-colors"
                                    :class="[
                                        activeTab === 'swift' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-gray-600',
                                        selectedResult?.compliance?.swift ? 'hover:text-gray-800 cursor-pointer' : 'opacity-50 cursor-not-allowed'
                                    ]">
                                SWIFT
                            </button>
                             <!-- Add Compliance Tab Button -->
                            <button @click="activeTab = 'compliance'"
                                    class="pb-3 px-1 font-medium transition-colors"
                                    :class="activeTab === 'compliance' ? 'text-purple-600 border-b-2 border-purple-600' : 'text-gray-600 hover:text-gray-800'">
                                Compliance
                            </button>
                        </div>

                        <!-- Enhanced Fields Tab -->
                        <div v-if="activeTab === 'fields'" class="space-y-3">
                            <div v-if="selectedResult?.extractedFields && Object.keys(selectedResult.extractedFields).length > 0">
                                <div v-for="(fieldData, fieldKey, index) in getExtractedFieldsWithDetails()"
                                     :key="fieldKey"
                                     class="field-item-enhanced"
                                     :class="{ active: activeFieldIndex === index, 'border-purple-500 bg-purple-50': targetField === fieldKey }"
                                     @click="highlightField(index, fieldData)">

                                    <!-- Field Header -->
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <h4 class="text-base font-semibold text-gray-900">
                                                {% raw %}{{ formatFieldName(fieldKey) }}{% endraw %}
                                            </h4>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button @click.stop="searchFieldCoordinates(fieldKey, fieldData?.value)"
                                                    :disabled="!fieldData?.value || searchingField === fieldKey"
                                                    class="px-2 py-1 rounded-md text-xs font-medium transition-all hover:bg-purple-600 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"
                                                    :class="{ 
                                                        'bg-purple-600 text-white': searchingField === fieldKey,
                                                        'bg-purple-100 text-purple-700': searchingField !== fieldKey 
                                                    }"
                                                    :title="searchingField === fieldKey ? 'Searching...' : 'Search coordinates for this field'"
                                                    style="background: rgba(103, 126, 234, 0.1); color: #667eea;">
                                                <i class="mdi text-sm" 
                                                   :class="searchingField === fieldKey ? 'mdi-loading mdi-spin' : 'mdi-crosshairs-gps'"></i>
                                                <span v-if="searchingField === fieldKey">Searching</span>
                                                <span v-else>Find</span>
                                            </button>
                                            <div class="field-confidence"
                                                 :class="getConfidenceClass(fieldData?.confidence || 0)">
                                                <i class="mdi mdi-chart-donut text-xs"></i>
                                                <span>{% raw %}{{ Math.round(fieldData?.confidence || 0) }}{% endraw %}%</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Field Value (Editable) -->
                                    <div class="bg-gray-50 rounded-lg p-3 font-mono text-sm">
                                        <input v-if="editingField === fieldKey"
                                               v-model="editedFields[fieldKey]"
                                               @blur="saveFieldEdit(fieldKey)"
                                               @keyup.enter="saveFieldEdit(fieldKey)"
                                               @keyup.esc="cancelFieldEdit()"
                                               class="w-full bg-white border border-purple-300 rounded px-2 py-1 text-gray-900 focus:outline-none focus:border-purple-500"
                                               :ref="'fieldInput_' + fieldKey">
                                        <p v-else
                                           @click="startFieldEdit(fieldKey, fieldData?.value)"
                                           class="text-gray-900 break-words cursor-text hover:bg-gray-100 px-2 py-1 rounded transition-colors"
                                           title="Click to edit">
                                            {% raw %}{{ fieldData?.value || 'N/A' }}{% endraw %}
                                        </p>
                                    </div>

                                    <!-- Field Metadata -->
                                    <div class="mt-2 flex items-center gap-4 text-xs text-gray-500">
                                        <span v-if="fieldData?.bounding_page !== undefined">
                                            <i class="mdi mdi-file-document-outline mr-1"></i>
                                            Page {% raw %}{{ fieldData?.bounding_page + 1 }}{% endraw %}
                                        </span>
                                        <span v-if="fieldData?.bounding_box">
                                            <i class="mdi mdi-vector-square mr-1"></i>
                                            Has location
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div v-else class="text-center py-12 text-gray-500">
                                <i class="mdi mdi-text-search text-5xl mb-3"></i>
                                <p>No fields extracted from this document</p>
                            </div>
                        </div>

                        <!-- Compliance Tab -->
                        <div v-if="activeTab === 'compliance'" class="space-y-4">
                            <div v-if="selectedResult?.compliance">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center"
                                         :class="selectedResult.compliance.status === 'compliant' ? 'bg-green-100' : 'bg-red-100'">
                                        <i class="text-2xl"
                                           :class="selectedResult.compliance.status === 'compliant' ? 'mdi mdi-check-circle text-green-600' : 'mdi mdi-alert-circle text-red-600'"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-lg">
                                            {% raw %}{{ selectedResult.compliance.status === 'compliant' ? 'Compliant' : 'Non-Compliant' }}{% endraw %}
                                        </h4>
                                        <p class="text-gray-600">Compliance Score: {% raw %}{{ selectedResult.complianceScore }}{% endraw %}%</p>
                                    </div>
                                </div>

                                <div v-if="selectedResult.compliance.violations && selectedResult.compliance.violations.length > 0" class="mb-6">
                                    <h5 class="font-medium text-red-700 mb-3">Violations</h5>
                                    <div v-for="(violation, idx) in selectedResult.compliance.violations" :key="'v-' + idx"
                                         class="bg-red-50 border border-red-200 rounded-lg p-3 mb-2">
                                        <p class="text-red-800">{% raw %}{{ violation.description || violation }}{% endraw %}</p>
                                    </div>
                                </div>

                                <div v-if="selectedResult.compliance.warnings && selectedResult.compliance.warnings.length > 0">
                                    <h5 class="font-medium text-yellow-700 mb-3">Warnings</h5>
                                    <div v-for="(warning, idx) in selectedResult.compliance.warnings" :key="'w-' + idx"
                                         class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-2">
                                        <p class="text-yellow-800">{% raw %}{{ warning.description || warning }}{% endraw %}</p>
                                    </div>
                                </div>
                            </div>
                            <div v-else class="text-center py-8 text-gray-600">
                                No compliance data available
                            </div>
                        </div>

                        <!-- UCP600 Tab -->
                        <div v-if="activeTab === 'ucp600' && selectedResult?.compliance?.ucp600" class="space-y-4">
                            <!-- Display compliance data regardless of structure -->
                            <div v-if="typeof selectedResult.compliance.ucp600 === 'object'" class="space-y-4">
                                <!-- Header with icon -->
                                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200">
                                    <div class="flex items-center gap-4">
                                        <div class="w-16 h-16 bg-white rounded-xl shadow-md flex items-center justify-center">
                                            <i class="mdi mdi-file-certificate text-3xl text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-xl font-bold text-gray-800">UCP600 Compliance Analysis</h4>
                                            <p class="text-gray-600 text-sm mt-1">Uniform Customs and Practice for Documentary Credits (UCP 600)</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- If it has status property -->
                                <div v-if="selectedResult.compliance.ucp600.status" class="bg-white rounded-xl shadow-sm border p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <div class="w-14 h-14 rounded-full flex items-center justify-center"
                                                 :class="selectedResult.compliance.ucp600.status === 'compliant' ? 'bg-green-100' : 'bg-red-100'">
                                                <i class="text-2xl"
                                                   :class="selectedResult.compliance.ucp600.status === 'compliant' ? 'mdi mdi-check-circle text-green-600' : 'mdi mdi-alert-circle text-red-600'"></i>
                                            </div>
                                            <div>
                                                <h5 class="font-semibold text-lg"
                                                    :class="selectedResult.compliance.ucp600.status === 'compliant' ? 'text-green-700' : 'text-red-700'">
                                                    {% raw %}{{ selectedResult.compliance.ucp600.status === 'compliant' ? 'Compliant' : 'Non-Compliant' }}{% endraw %}
                                                </h5>
                                                <p class="text-gray-600 text-sm">Overall compliance status</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                                  :class="selectedResult.compliance.ucp600.status === 'compliant' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                                <i class="mdi mdi-shield-check mr-1"></i>
                                                Verified
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Display all properties as vertical cards -->
                                <div class="space-y-3">
                                    <div v-for="(value, key) in getUCP600TableData()" :key="'ucp-card-' + key"
                                         class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <!-- Field Name -->
                                                <div class="flex items-center mb-3">
                                                    <i class="mdi mdi-tag text-purple-500 mr-2"></i>
                                                    <h6 class="text-base font-semibold text-gray-900">{% raw %}{{ formatFieldName(key) }}{% endraw %}</h6>
                                                </div>
                                                
                                                <!-- Value Information -->
                                                <div v-if="typeof value === 'object' && value.value !== undefined" class="mb-3">
                                                    <!-- Actual Value -->
                                                    <div class="bg-blue-50 rounded-md p-3">
                                                        <label class="block text-xs font-medium text-blue-700 mb-1">Field Value</label>
                                                        <p class="text-sm text-blue-900 font-mono break-words">
                                                            {% raw %}{{ value.value || 'Not provided' }}{% endraw %}
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <!-- Compliance Status -->
                                                <div class="mb-3">
                                                    <span v-if="typeof value === 'object' && value.compliance !== undefined"
                                                          class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                                          :class="value.compliance ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                                        <i :class="value.compliance ? 'mdi mdi-check-circle mr-2' : 'mdi mdi-alert-circle mr-2'"></i>
                                                        {% raw %}{{ value.compliance ? 'Compliant' : 'Non-Compliant' }}{% endraw %}
                                                    </span>
                                                    <span v-else class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700">
                                                        <i class="mdi mdi-information mr-2"></i>
                                                        {% raw %}{{ typeof value === 'string' ? value : JSON.stringify(value) }}{% endraw %}
                                                    </span>
                                                </div>

                                                <!-- Reason/Description -->
                                                <div v-if="typeof value === 'object' && value.reason" class="mt-2">
                                                    <label class="block text-xs font-medium text-gray-500 mb-1">Compliance Reason</label>
                                                    <p class="text-sm text-gray-700 bg-gray-50 rounded-md p-3">
                                                        <i class="mdi mdi-text-box-outline mr-2"></i>
                                                        {% raw %}{{ value.reason }}{% endraw %}
                                                    </p>
                                                </div>

                                                <!-- Additional metadata if available -->
                                                <div v-if="typeof value === 'object' && value.severity" class="mt-3">
                                                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                                                          :class="{
                                                              'bg-red-100 text-red-700': value.severity === 'high',
                                                              'bg-yellow-100 text-yellow-700': value.severity === 'medium',
                                                              'bg-blue-100 text-blue-700': value.severity === 'low'
                                                          }">
                                                        <i class="mdi mdi-alert mr-1"></i>
                                                        Severity: {% raw %}{{ value.severity }}{% endraw %}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <!-- Status Icon -->
                                            <div class="ml-4">
                                                <div class="w-8 h-8 rounded-full flex items-center justify-center"
                                                     :class="typeof value === 'object' && value.compliance !== undefined ? 
                                                             (value.compliance ? 'bg-green-100' : 'bg-red-100') : 'bg-gray-100'">
                                                    <i class="text-lg"
                                                       :class="typeof value === 'object' && value.compliance !== undefined ? 
                                                               (value.compliance ? 'mdi mdi-check text-green-600' : 'mdi mdi-close text-red-600') : 'mdi mdi-help text-gray-500'"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="selectedResult.compliance.ucp600.violations && selectedResult.compliance.ucp600.violations.length > 0" class="mb-6">
                                <h5 class="font-medium text-red-700 mb-3">Violations</h5>
                                <div v-for="(violation, idx) in selectedResult.compliance.ucp600.violations" :key="'ucp-v-' + idx"
                                     class="bg-red-50 border border-red-200 rounded-lg p-3 mb-2">
                                    <p class="text-red-800"><strong>{% raw %}{{ violation.field }}{% endraw %}:</strong> {% raw %}{{ violation.description }}{% endraw %}</p>
                                    <p v-if="violation.article" class="text-red-700 text-sm mt-1">Article: {% raw %}{{ violation.article }}{% endraw %}</p>
                                </div>
                            </div>

                            <div v-if="selectedResult.compliance.ucp600.warnings && selectedResult.compliance.ucp600.warnings.length > 0">
                                <h5 class="font-medium text-yellow-700 mb-3">Warnings</h5>
                                <div v-for="(warning, idx) in selectedResult.compliance.ucp600.warnings" :key="'ucp-w-' + idx"
                                     class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-2">
                                    <p class="text-yellow-800"><strong>{% raw %}{{ warning.field }}{% endraw %}:</strong> {% raw %}{{ warning.description }}{% endraw %}</p>
                                    <p v-if="warning.article" class="text-yellow-700 text-sm mt-1">Article: {% raw %}{{ warning.article }}{% endraw %}</p>
                                </div>
                            </div>
                        </div>

                        <!-- SWIFT Tab -->
                        <div v-if="activeTab === 'swift' && selectedResult?.compliance?.swift" class="space-y-4">
                            <!-- Display compliance data regardless of structure -->
                            <div v-if="typeof selectedResult.compliance.swift === 'object'" class="space-y-4">
                                <!-- Header with icon -->
                                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
                                    <div class="flex items-center gap-4">
                                        <div class="w-16 h-16 bg-white rounded-xl shadow-md flex items-center justify-center">
                                            <i class="mdi mdi-bank-transfer text-3xl text-blue-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-xl font-bold text-gray-800">SWIFT Compliance Analysis</h4>
                                            <p class="text-gray-600 text-sm mt-1">Society for Worldwide Interbank Financial Telecommunication Standards</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- If it has status property -->
                                <div v-if="selectedResult.compliance.swift.status" class="bg-white rounded-xl shadow-sm border p-6">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <div class="w-14 h-14 rounded-full flex items-center justify-center"
                                                 :class="selectedResult.compliance.swift.status === 'compliant' ? 'bg-green-100' : 'bg-red-100'">
                                                <i class="text-2xl"
                                                   :class="selectedResult.compliance.swift.status === 'compliant' ? 'mdi mdi-check-circle text-green-600' : 'mdi mdi-alert-circle text-red-600'"></i>
                                            </div>
                                            <div>
                                                <h5 class="font-semibold text-lg"
                                                    :class="selectedResult.compliance.swift.status === 'compliant' ? 'text-green-700' : 'text-red-700'">
                                                    {% raw %}{{ selectedResult.compliance.swift.status === 'compliant' ? 'Compliant' : 'Non-Compliant' }}{% endraw %}
                                                </h5>
                                                <p class="text-gray-600 text-sm">Overall compliance status</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                                  :class="selectedResult.compliance.swift.status === 'compliant' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                                <i class="mdi mdi-shield-check mr-1"></i>
                                                Verified
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Display all properties as vertical cards -->
                                <div class="space-y-3">
                                    <div v-for="(value, key) in getSWIFTTableData()" :key="'swift-card-' + key"
                                         class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <!-- Field Name -->
                                                <div class="flex items-center mb-3">
                                                    <i class="mdi mdi-tag text-blue-500 mr-2"></i>
                                                    <h6 class="text-base font-semibold text-gray-900">{% raw %}{{ formatFieldName(key) }}{% endraw %}</h6>
                                                </div>
                                                
                                                <!-- Value Information -->
                                                <div v-if="typeof value === 'object' && value.value !== undefined" class="mb-3">
                                                    <!-- Actual Value -->
                                                    <div class="bg-blue-50 rounded-md p-3">
                                                        <label class="block text-xs font-medium text-blue-700 mb-1">Field Value</label>
                                                        <p class="text-sm text-blue-900 font-mono break-words">
                                                            {% raw %}{{ value.value || 'Not provided' }}{% endraw %}
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <!-- Compliance Status -->
                                                <div class="mb-3">
                                                    <span v-if="typeof value === 'object' && value.compliance !== undefined"
                                                          class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                                          :class="value.compliance ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                                        <i :class="value.compliance ? 'mdi mdi-check-circle mr-2' : 'mdi mdi-alert-circle mr-2'"></i>
                                                        {% raw %}{{ value.compliance ? 'Compliant' : 'Non-Compliant' }}{% endraw %}
                                                    </span>
                                                    <span v-else class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700">
                                                        <i class="mdi mdi-information mr-2"></i>
                                                        {% raw %}{{ typeof value === 'string' ? value : JSON.stringify(value) }}{% endraw %}
                                                    </span>
                                                </div>

                                                <!-- Reason/Description -->
                                                <div v-if="typeof value === 'object' && value.reason" class="mt-2">
                                                    <label class="block text-xs font-medium text-gray-500 mb-1">Compliance Reason</label>
                                                    <p class="text-sm text-gray-700 bg-gray-50 rounded-md p-3">
                                                        <i class="mdi mdi-text-box-outline mr-2"></i>
                                                        {% raw %}{{ value.reason }}{% endraw %}
                                                    </p>
                                                </div>

                                                <!-- Additional metadata if available -->
                                                <div class="flex flex-wrap gap-2 mt-3">
                                                    <span v-if="typeof value === 'object' && value.severity"
                                                          class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                                                          :class="{
                                                              'bg-red-100 text-red-700': value.severity === 'high',
                                                              'bg-yellow-100 text-yellow-700': value.severity === 'medium',
                                                              'bg-blue-100 text-blue-700': value.severity === 'low'
                                                          }">
                                                        <i class="mdi mdi-alert mr-1"></i>
                                                        Severity: {% raw %}{{ value.severity }}{% endraw %}
                                                    </span>

                                                    <!-- SWIFT Standard if available -->
                                                    <span v-if="typeof value === 'object' && value.standard"
                                                          class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-indigo-50 text-indigo-700">
                                                        <i class="mdi mdi-book-open-variant mr-1"></i>
                                                        Standard: {% raw %}{{ value.standard }}{% endraw %}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <!-- Status Icon -->
                                            <div class="ml-4">
                                                <div class="w-8 h-8 rounded-full flex items-center justify-center"
                                                     :class="typeof value === 'object' && value.compliance !== undefined ? 
                                                             (value.compliance ? 'bg-green-100' : 'bg-red-100') : 'bg-gray-100'">
                                                    <i class="text-lg"
                                                       :class="typeof value === 'object' && value.compliance !== undefined ? 
                                                               (value.compliance ? 'mdi mdi-check text-green-600' : 'mdi mdi-close text-red-600') : 'mdi mdi-help text-gray-500'"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="selectedResult.compliance.swift.violations && selectedResult.compliance.swift.violations.length > 0" class="mb-6">
                                <h5 class="font-medium text-red-700 mb-3">Violations</h5>
                                <div v-for="(violation, idx) in selectedResult.compliance.swift.violations" :key="'swift-v-' + idx"
                                     class="bg-red-50 border border-red-200 rounded-lg p-3 mb-2">
                                    <p class="text-red-800"><strong>{% raw %}{{ violation.field }}{% endraw %}:</strong> {% raw %}{{ violation.description }}{% endraw %}</p>
                                    <p v-if="violation.standard" class="text-red-700 text-sm mt-1">Standard: {% raw %}{{ violation.standard }}{% endraw %}</p>
                                </div>
                            </div>

                            <div v-if="selectedResult.compliance.swift.warnings && selectedResult.compliance.swift.warnings.length > 0">
                                <h5 class="font-medium text-yellow-700 mb-3">Warnings</h5>
                                <div v-for="(warning, idx) in selectedResult.compliance.swift.warnings" :key="'swift-w-' + idx"
                                     class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-2">
                                    <p class="text-yellow-800"><strong>{% raw %}{{ warning.field }}{% endraw %}:</strong> {% raw %}{{ warning.description }}{% endraw %}</p>
                                    <p v-if="warning.standard" class="text-yellow-700 text-sm mt-1">Standard: {% raw %}{{ warning.standard }}{% endraw %}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <!-- Text Selection Field Assignment Popup -->
        <div v-if="showFieldAssignment" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Assign Selected Text to Field</h3>
                    <button @click="showFieldAssignment = false" class="text-gray-500 hover:text-gray-700">
                        <i class="mdi mdi-close text-xl"></i>
                    </button>
                </div>

                <!-- Extracted Text Preview -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <p class="text-sm text-gray-600 mb-1">Selected Text:</p>
                    <div v-if="isExtractingText" class="flex items-center gap-2">
                        <div class="animate-spin h-4 w-4 border-2 border-purple-600 border-t-transparent rounded-full"></div>
                        <p class="font-mono text-sm text-gray-600">Extracting text...</p>
                    </div>
                    <p v-else class="font-mono text-sm text-gray-800">{% raw %}{{ extractedText }}{% endraw %}</p>
                </div>

                <!-- Field List -->
                <div class="space-y-2 max-h-64 overflow-y-auto">
                    <p class="text-sm text-gray-600 mb-2">Choose a field to update:</p>
                    <button v-for="(field, key) in getExtractedFieldsWithDetails()"
                            :key="key"
                            @click="assignTextToField(key)"
                            class="w-full text-left p-3 rounded-lg border border-gray-200 hover:border-purple-400 hover:bg-purple-50 transition-colors">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium text-gray-800">{% raw %}{{ formatFieldName(key) }}{% endraw %}</p>
                                <p class="text-xs text-gray-500 truncate">Current: {% raw %}{{ field.value || 'Empty' }}{% endraw %}</p>
                            </div>
                            <i class="mdi mdi-chevron-right text-gray-400"></i>
                        </div>
                    </button>
                </div>

                <div class="mt-4 pt-4 border-t flex justify-end gap-2">
                    <button @click="showFieldAssignment = false"
                            class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isDragging: false,
                    selectedFiles: [],
                    processing: false,
                    processingStatus: '',
                    currentStep: 0,
                    steps: [
                        'Uploading Documents',
                        'Analyzing Quality',
                        'Extracting Content',
                        'AI Classification',
                        'Reading Entities',
                        'Compliance Check'
                    ],
                    results: null,
                    showDetailsModal: false,
                    selectedResult: null,
                    activeTab: 'fields',
                    // Tab navigation for grouped pages
                    activePageTab: 0,  // Index of currently active page tab within a grouped result
                    // Enhanced modal properties
                    currentPage: 0,
                    zoomLevel: 1,
                    activeFieldIndex: null,
                    currentTool: 'select',
                    currentColor: '#667eea',
                    drawColors: ['#667eea', '#ef4444', '#10b981', '#f59e0b', '#3b82f6', '#8b5cf6'],
                    isDrawing: false,
                    drawings: [],
                    hasDrawings: false,
                    drawingContext: null,
                    editingField: null,
                    editedFields: {},
                    rectangleStart: null,
                    pendingHighlight: null,
                    // Pan/drag properties
                    isPanning: false,
                    panStartX: 0,
                    panStartY: 0,
                    panX: 0,
                    panY: 0,
                    // Text selection properties
                    textSelectionBox: null,
                    selectedTextRegion: null,
                    showFieldAssignment: false,
                    extractedText: '',
                    targetField: null,
                    isExtractingText: false,
                    // Coordinate search properties
                    searchingField: null,
                    coordinateSearchResults: {},
                    // Document management features
                    currentUser: null,
                    isAllowed: false,
                    showAdminPanel: false,
                    documentTypes: [],
                    selectedDocType: null,
                    editingDocType: false,
                    newDocTypeName: '',
                    newFieldName: '',
                    newFieldType: 'text',
                    showNewDocTypeDialog: false,
                    adminLoading: false,
                    // Trade document elements
                    selectedTradeDocumentType: '',
                    processingMode: 'page_by_page', // Default to page-by-page for multi-document detection
                    tradeDocuments: [],
                    tradeDocumentFields: null,
                    tradeFinanceDocuments: [],
                    transportDocuments: [],
                    customsDocuments: [],
                    otherDocuments: []
                }
            },
            computed: {
                avgConfidence() {
                    if (!this.results) return 0;
                    const sum = this.results.reduce((acc, r) => acc + r.confidence, 0);
                    return Math.round(sum / this.results.length);
                },
                totalFields() {
                    if (!this.results) return 0;
                    return this.results.reduce((acc, r) => acc + r.fieldsExtracted, 0);
                },
                avgQualityTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    // Use backend-provided quality analysis time
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.qualityTime || 0), 0);
                    return (sum / this.results.length).toFixed(1);
                },
                avgClassificationTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    // Use backend-provided classification time directly
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.classificationTime || 0), 0);
                    return (sum / this.results.length).toFixed(1);
                },
                avgOcrTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    // Use backend-provided OCR time directly
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.ocrTime || 0), 0);
                    return (sum / this.results.length).toFixed(1);
                },
                avgComplianceTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    // Use backend-provided compliance analysis time
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.complianceTime || 0), 0);
                    return (sum / this.results.length).toFixed(1);
                },
                avgEntityExtractionTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    // Use backend-provided extraction time directly - this is the actual AI field extraction
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.llmTime || 0), 0);
                    return (sum / this.results.length).toFixed(1);
                },
                totalTime() {
                    if (!this.results || this.results.length === 0) return '0.0';
                    const sum = this.results.reduce((acc, r) => acc + parseFloat(r.processingTime || 0), 0);
                    return sum.toFixed(1);
                }
            },
            methods: {
                // Helper methods for absolute page numbering
                getAbsolutePageNumber(relativePageIndex) {
                    // Convert relative page index (0-based) to absolute page number
                    if (!this.selectedResult?.pages || this.selectedResult.pages.length === 0) {
                        return relativePageIndex + 1; // Fallback to simple 1-based indexing
                    }
                    
                    // Use the actual page numbers from the document
                    if (relativePageIndex >= 0 && relativePageIndex < this.selectedResult.pages.length) {
                        return this.selectedResult.pages[relativePageIndex];
                    }
                    
                    return relativePageIndex + 1; // Fallback
                },
                getTotalPages() {
                    // Get the highest page number in the document
                    if (!this.selectedResult?.pages || this.selectedResult.pages.length === 0) {
                        return this.selectedResult?.previewImages?.length || 1; // Fallback
                    }
                    
                    // Return the maximum page number from the pages array
                    return Math.max(...this.selectedResult.pages);
                },
                getRelativePageIndex(absolutePageNumber) {
                    // Convert absolute page number to relative index within the group
                    if (!this.selectedResult?.pages || this.selectedResult.pages.length === 0) {
                        return absolutePageNumber - 1; // Fallback to simple conversion
                    }
                    
                    // Find the index of the absolute page number in the pages array
                    const index = this.selectedResult.pages.indexOf(absolutePageNumber);
                    return index >= 0 ? index : 0; // Return 0 if not found
                },
                handleFileSelect(event) {
                    const files = Array.from(event.target.files);
                    this.selectedFiles = [...this.selectedFiles, ...files];
                },
                handleDrop(event) {
                    this.isDragging = false;
                    const files = Array.from(event.dataTransfer.files);
                    this.selectedFiles = [...this.selectedFiles, ...files];
                },
                removeFile(index) {
                    this.selectedFiles.splice(index, 1);
                },

                clearFiles() {
                    this.selectedFiles = [];
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = '';
                    }
                },
                
                toggleInsights(index) {
                    // Debug logging
                    console.log('toggleInsights called with index:', index);
                    console.log('Current result:', this.results[index]);
                    console.log('Current insightsExpanded:', this.results[index].insightsExpanded);
                    
                    try {
                        // Ensure the property exists and toggle it
                        const currentState = this.results[index].insightsExpanded || false;
                        console.log('Current state determined as:', currentState);
                        
                        // Method 1: Try Vue.set
                        if (typeof Vue !== 'undefined' && Vue.set) {
                            Vue.set(this.results[index], 'insightsExpanded', !currentState);
                            console.log('Used Vue.set method');
                        } else if (this.$set) {
                            // Method 2: Try $set
                            this.$set(this.results[index], 'insightsExpanded', !currentState);
                            console.log('Used this.$set method');
                        } else {
                            // Method 3: Direct assignment
                            this.results[index].insightsExpanded = !currentState;
                            console.log('Used direct assignment');
                        }
                        
                        console.log('New insightsExpanded:', this.results[index].insightsExpanded);
                        console.log('Toggle operation completed successfully');
                        
                        // Force Vue to update the DOM
                        this.$forceUpdate();
                        console.log('Forced Vue update');
                        
                        // If expanding, initialize the chart after DOM update
                        if (!currentState) { // If we're expanding (was false, now true)
                            console.log('Expanding insights, will initialize charts...');
                            this.$nextTick(() => {
                                // Try multiple times with increasing delays
                                const tryInitChart = (attempt = 1, maxAttempts = 5) => {
                                    const canvasId = `qualityChart-${index}`;
                                    const qualityMetricsCanvasId = `qualityMetricsChart-${index}`;
                                    const advancedQualityCanvasId = `advancedQualityChart-${index}`;
                                    console.log(`Attempt ${attempt}: Looking for canvas:`, canvasId);
                                    const canvas = document.getElementById(canvasId);
                                    const qualityCanvas = document.getElementById(qualityMetricsCanvasId);
                                    const advancedCanvas = document.getElementById(advancedQualityCanvasId);
                                    
                                    if (canvas) {
                                        console.log('Main canvas found, initializing chart...');
                                        if (window.createQualityMetricsChart) {
                                            window.createQualityMetricsChart(canvasId, this.results[index]);
                                        } else {
                                            console.error('createQualityMetricsChart function not found');
                                        }
                                    }
                                    
                                    if (qualityCanvas) {
                                        console.log('Quality metrics canvas found, initializing chart...');
                                        if (window.createQualityMetricsBarChart) {
                                            window.createQualityMetricsBarChart(qualityMetricsCanvasId, this.results[index]);
                                        } else {
                                            console.error('createQualityMetricsBarChart function not found');
                                        }
                                    }
                                    
                                if (advancedCanvas) {
                                    console.log('Advanced quality canvas found, initializing advanced chart...');
                                    
                                    // Ensure Chart.js is loaded before creating chart
                                    const ensureChartJs = () => {
                                        if (typeof Chart !== 'undefined' && window.createAdvancedQualityChart) {
                                            window.createAdvancedQualityChart(advancedQualityCanvasId, this.results[index]);
                                        } else if (typeof Chart === 'undefined') {
                                            console.log('Waiting for Chart.js to load...');
                                            setTimeout(ensureChartJs, 100);
                                        } else {
                                            console.error('createAdvancedQualityChart function not found');
                                        }
                                    };
                                    ensureChartJs();
                                }                                    if (!canvas && !qualityCanvas && !advancedCanvas && attempt < maxAttempts) {
                                        console.log(`Canvas not found, retrying in ${attempt * 200}ms... (attempt ${attempt}/${maxAttempts})`);
                                        setTimeout(() => tryInitChart(attempt + 1, maxAttempts), attempt * 200);
                                    } else if (!canvas && !qualityCanvas) {
                                        console.error('Canvas not found after all attempts:', canvasId);
                                        
                                        // Debug: Show all available canvas elements
                                        const allCanvases = Array.from(document.querySelectorAll('canvas'));
                                        console.log('Available canvas elements:');
                                        allCanvases.forEach((canvas, idx) => {
                                            console.log(`  Canvas ${idx}: id="${canvas.id}", class="${canvas.className}"`);
                                        });
                                        
                                        // Try to find canvas by pattern match
                                        const matchingCanvas = allCanvases.find(c => 
                                            c.id.includes('qualityChart') || 
                                            c.closest('[class*="chart"]') ||
                                            c.closest('[id*="insights"]')
                                        );
                                        
                                        if (matchingCanvas) {
                                            console.log('Found potential canvas:', matchingCanvas.id || 'no-id');
                                            if (window.createQualityMetricsChart) {
                                                console.log('Attempting to create chart with found canvas...');
                                                window.createQualityMetricsChart(matchingCanvas.id || `found-canvas-${Date.now()}`, this.results[index]);
                                            }
                                        }
                                    }
                                };
                                
                                // Start the retry process
                                setTimeout(() => tryInitChart(), 100);
                            });
                        }
                        
                    } catch (error) {
                        console.error('Error in toggleInsights:', error);
                        console.log('Attempting fallback...');
                        
                        // Fallback: try direct assignment
                        const wasExpanded = this.results[index].insightsExpanded || false;
                        this.results[index].insightsExpanded = !wasExpanded;
                        console.log('Fallback assignment completed. New value:', this.results[index].insightsExpanded);
                        this.$forceUpdate();
                        
                        // If expanding, initialize the chart after DOM update
                        if (!wasExpanded) {
                            console.log('Fallback: Expanding insights, will initialize chart...');
                            this.$nextTick(() => {
                                // Try multiple times with increasing delays
                                const tryInitChart = (attempt = 1, maxAttempts = 5) => {
                                    const canvasId = `qualityChart-${index}`;
                                    console.log(`Fallback attempt ${attempt}: Looking for canvas:`, canvasId);
                                    const canvas = document.getElementById(canvasId);
                                    
                                    if (canvas) {
                                        console.log('Fallback: Canvas found, initializing chart...');
                                        if (window.createQualityMetricsChart) {
                                            window.createQualityMetricsChart(canvasId, this.results[index]);
                                        } else {
                                            console.error('Fallback: createQualityMetricsChart function not found');
                                        }
                                    } else if (attempt < maxAttempts) {
                                        console.log(`Fallback: Canvas not found, retrying in ${attempt * 200}ms... (attempt ${attempt}/${maxAttempts})`);
                                        setTimeout(() => tryInitChart(attempt + 1, maxAttempts), attempt * 200);
                                    } else {
                                        console.error('Fallback: Canvas not found after all attempts:', canvasId);
                                        console.log('Fallback: Available canvas elements:', 
                                            Array.from(document.querySelectorAll('canvas')).map(c => c.id || c.className));
                                    }
                                };
                                
                                // Start the retry process
                                setTimeout(() => tryInitChart(), 100);
                            });
                        }
                    }
                },
                updateStepFromProgress(stage, message) {
                    // Map backend progress stages to Vue.js modal steps
                    const stageToStepMap = {
                        'uploading': 0,           // Uploading Documents
                        'quality_analysis': 1,    // Analyzing Quality  
                        'ocr_extraction': 2,      // Extracting Content
                        'document_classification': 3, // AI Classification
                        'field_extraction': 4,    // Reading Entities
                        'compliance_check': 5,    // Compliance Check
                        'finalizing': 5,          // Still compliance phase
                        'completed': 6            // Done (beyond steps array)
                    };
                    
                    console.log(`🔄 Overlay Vue modal mapping stage '${stage}' to step`, stageToStepMap[stage]);
                    
                    if (stageToStepMap.hasOwnProperty(stage)) {
                        const stepIndex = stageToStepMap[stage];
                        this.currentStep = stepIndex;
                        this.processingStatus = message || this.steps[stepIndex] || 'Processing...';
                        
                        console.log(`✅ Overlay Vue modal updated: currentStep=${this.currentStep}, status="${this.processingStatus}"`);
                    } else {
                        console.warn(`⚠️  Unknown stage: ${stage}`);
                    }
                },
                async processFiles() {
                    if (this.selectedFiles.length === 0) return;

                    this.processing = true;
                    this.currentStep = 0;
                    const startTime = Date.now();

                    // Show WebSocket-based progress loader
                    if (window.progressLoader) {
                        window.progressLoader.show();
                        console.log('🔄 WebSocket progress loader shown');
                    }

                    // Get WebSocket client ID for progress tracking
                    const clientId = window.aiWebSocket ? window.aiWebSocket.getClientId() : null;
                    console.log('🔌 WebSocket Client ID:', clientId);

                    // Connect to WebSocket for real progress updates
                    if (window.aiWebSocket && window.aiWebSocket.isConnected()) {
                        // Listen for progress updates
                        window.aiWebSocket.on('progress_update', (data) => {
                            console.log('Overlay Vue modal received progress update:', data);
                            this.updateStepFromProgress(data.stage, data.message);
                        });
                    }

                    // Prepare form data
                    const formData = new FormData();
                    this.selectedFiles.forEach(file => {
                        formData.append('files', file);
                    });
                    formData.append('checkCompliance', 'true');

                    // Add client ID for WebSocket progress updates
                    if (clientId) {
                        formData.append('client_id', clientId);
                    }

                    // Get context from URL parameters (passed by parent form)
                    const urlParams = new URLSearchParams(window.location.search);
                    const functionName = urlParams.get('functionName');
                    const productName = urlParams.get('productName');

                    // Add context parameters for enhanced classification
                    if (functionName) {
                        formData.append('functionName', functionName);
                        console.log('📋 Sending functionName:', functionName);
                    }
                    if (productName) {
                        formData.append('productName', productName);
                        console.log('📋 Sending productName:', productName);
                    }

                    // Add document type if selected
                    if (this.selectedTradeDocumentType) {
                        formData.append('documentType', this.selectedTradeDocumentType);
                        console.log('📋 Sending documentType:', this.selectedTradeDocumentType);
                    }

                    // Add processing mode
                    const isPageByPage = this.processingMode === 'page_by_page';
                    formData.append('page_by_page', isPageByPage ? 'true' : 'false');
                    console.log('📄 Processing mode:', isPageByPage ? 'Page-by-Page' : 'Single Document');

                    try {
                        // Use enhanced API with config-based prompts and field mappings
                        const response = await fetch('/api/document/classify-enhanced', {
                            method: 'POST',
                            body: formData
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                // Process results with support for both new YAML format and legacy format
                                this.results = data.results.map((result, idx) => {
                                    console.log(`=== Processing result ${idx} ===`);
                                    console.log('Raw result:', result);

                                    // Detect if this is the new YAML-compliant format
                                    const isNewFormat = result.classification && result.extraction && result.compliance;
                                    console.log('Using format:', isNewFormat ? 'New YAML-compliant' : 'Legacy');

                                    let processedResult;

                                    if (isNewFormat) {
                                        // New YAML-compliant format
                                        const classification = result.classification || {};
                                        const extraction = result.extraction || {};
                                        const compliance = result.compliance || {};

                                        // Combine all extracted fields from different categories
                                        const extractedFields = {
                                            ...extraction.mandatory || {},
                                            ...extraction.optional || {},
                                            ...extraction.conditional || {}
                                        };

                                        // Use compliance score from backend (already calculated correctly)
                                        const complianceScore = result.complianceScore || 85;

                                        processedResult = {
                                            fileName: result.file_name,
                                            documentType: classification.document_type,
                                            confidence: classification.confidence,
                                            fieldsExtracted: Object.keys(extractedFields).length,
                                            complianceScore: complianceScore,
                                            processingTime: result.processing_time?.actual_total || result.processing_time?.total || '0.0',
                                            qualityTime: result.processing_time?.quality_analysis || '0.0', // Quality analysis time
                                            classificationTime: result.processing_time?.classification || '0.0', // Document classification time
                                            ocrTime: result.processing_time?.ocr || '0.0', // OCR text extraction time
                                            llmTime: result.processing_time?.extraction || '0.0',
                                            complianceTime: result.complianceTime || '0.0', // Add compliance time from backend
                                            extractedFields: extractedFields,
                                            previewImages: result.preview_images || [],
                                            // New format compliance data
                                            compliance: {
                                                compliant: compliance.compliant,
                                                missing_mandatory: compliance.missing_mandatory || [],
                                                warnings: compliance.warnings || [],
                                                recommendations: compliance.recommendations || [],
                                                severity: compliance.severity || 'info',
                                                completeness: compliance.completeness || '0%'
                                            },
                                            // New format metadata
                                            extraction: extraction,
                                            classification: classification,
                                            pages: result.ocr_data?.pages || [],
                                            pageRange: result.ocr_data?.page_range || '',
                                            individualPages: result.ocr_data?.individual_pages || [],  // Add individual page data for tabs
                                            enhanced_mode: result.enhanced_mode || false,
                                            page_by_page_mode: result.page_by_page_mode || false,
                                            insightsExpanded: false, // Initialize insights expanded state
                                            // Keep raw data for debugging
                                            _rawResult: result
                                        };
                                    } else {
                                        // Legacy format processing (existing logic)
                                        let swiftData = null;
                                        let ucp600Data = null;

                                        // Try to find SWIFT data (legacy)
                                        if (result.swift_result) {
                                            swiftData = result.swift_result;
                                        } else if (result.analysis_result?.swift_result) {
                                            swiftData = result.analysis_result.swift_result;
                                        } else if (result.compliance?.swift) {
                                            swiftData = result.compliance.swift;
                                        }

                                        // Try to find UCP600 data (legacy)
                                        if (result.ucp600_result) {
                                            ucp600Data = result.ucp600_result;
                                        } else if (result.analysis_result?.ucp600_result) {
                                            ucp600Data = result.analysis_result.ucp600_result;
                                        } else if (result.compliance?.ucp600) {
                                            ucp600Data = result.compliance.ucp600;
                                        }

                                        const legacyCompliance = {
                                            swift: swiftData,
                                            ucp600: ucp600Data
                                        };

                                        // Extract fields (legacy)
                                        let extractedFields = {};
                                        if (result.extracted_fields && Object.keys(result.extracted_fields).length > 0) {
                                            extractedFields = result.extracted_fields;
                                        } else if (result.analysis_result?.combined_fields) {
                                            extractedFields = result.analysis_result.combined_fields;
                                        } else if (result.fields) {
                                            extractedFields = result.fields;
                                        }

                                        processedResult = {
                                            fileName: result.file_name,
                                            documentType: result.document_type,
                                            confidence: result.confidence,
                                            fieldsExtracted: Object.keys(extractedFields).length,
                                            complianceScore: result.complianceScore || 85,
                                            processingTime: result.processing_time?.total || '0.0',
                                            classificationTime: result.processing_time?.classification || '0.0',
                                            ocrTime: result.processing_time?.ocr || '0.0',
                                            llmTime: result.processing_time?.llm_analysis || '0.0',
                                            complianceTime: result.complianceTime || '0.0', // Add compliance time from backend
                                            extractedFields: extractedFields,
                                            previewImages: result.preview_images || [],
                                            compliance: legacyCompliance,
                                            analysisResult: result.analysis_result || {},
                                            enhanced_mode: false,
                                            page_by_page_mode: false,
                                            insightsExpanded: false, // Initialize insights expanded state
                                            // Keep raw data for debugging
                                            _rawResult: result
                                        };
                                    }

                                    console.log('Processed result:', processedResult);
                                    return processedResult;
                                });
                            } else {
                                console.error('Classification failed:', data.error);
                                this.showError(data.error || 'Classification failed');

                                // Hide progress loader on error
                                if (window.progressLoader) {
                                    window.progressLoader.hide();
                                }
                            }
                        } else {
                            console.error('API request failed');
                            this.showError('Failed to process documents');

                            // Hide progress loader on error
                            if (window.progressLoader) {
                                window.progressLoader.hide();
                            }
                        }
                    } catch (error) {
                        console.error('Error processing files:', error);
                        this.showError('An error occurred while processing documents');

                        // Hide progress loader on error
                        if (window.progressLoader) {
                            window.progressLoader.hide();
                        }
                    }

                    // Note: Backend now provides actual timing data via computed property totalTime()
                    this.processing = false;

                    // Note: Progress loader will auto-hide on success via WebSocket 'completed' event
                },
                getDocumentType() {
                    const types = ['Letter of Credit', 'Bank Guarantee', 'Invoice', 'Bill of Lading'];
                    return types[Math.floor(Math.random() * types.length)];
                },
                getFileIcon(fileName) {
                    const ext = fileName.toLowerCase().split('.').pop();
                    const icons = {
                        'pdf': 'mdi mdi-file-pdf-box',
                        'doc': 'mdi mdi-file-word',
                        'docx': 'mdi mdi-file-word',
                        'xls': 'mdi mdi-file-excel',
                        'xlsx': 'mdi mdi-file-excel',
                        'jpg': 'mdi mdi-file-image',
                        'jpeg': 'mdi mdi-file-image',
                        'png': 'mdi mdi-file-image',
                        'gif': 'mdi mdi-file-image',
                        'bmp': 'mdi mdi-file-image',
                        'tiff': 'mdi mdi-file-image',
                        'txt': 'mdi mdi-file-document',
                        'csv': 'mdi mdi-file-delimited',
                        'zip': 'mdi mdi-folder-zip'
                    };
                    return icons[ext] || 'mdi mdi-file';
                },

                getFileIconClass(fileName) {
                    const ext = fileName.toLowerCase().split('.').pop();
                    if (['pdf'].includes(ext)) return 'file-icon-wrapper pdf';
                    if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff'].includes(ext)) return 'file-icon-wrapper image';
                    if (['doc', 'docx', 'txt'].includes(ext)) return 'file-icon-wrapper document';
                    if (['xls', 'xlsx', 'csv'].includes(ext)) return 'file-icon-wrapper excel';
                    return 'file-icon-wrapper default';
                },

                getFileType(fileName) {
                    const ext = fileName.toLowerCase().split('.').pop();
                    const typeMap = {
                        'pdf': 'PDF Document',
                        'doc': 'Word Document',
                        'docx': 'Word Document',
                        'xls': 'Excel Spreadsheet',
                        'xlsx': 'Excel Spreadsheet',
                        'jpg': 'JPEG Image',
                        'jpeg': 'JPEG Image',
                        'png': 'PNG Image',
                        'gif': 'GIF Image',
                        'bmp': 'Bitmap Image',
                        'tiff': 'TIFF Image',
                        'txt': 'Text Document',
                        'csv': 'CSV File',
                        'zip': 'ZIP Archive'
                    };
                    return typeMap[ext] || 'File';
                },
                formatFileSize(bytes) {
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    if (bytes === 0) return '0 B';
                    const i = Math.floor(Math.log(bytes) / Math.log(1024));
                    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
                },
                calculateComplianceScore(compliance) {
                    if (!compliance) return 0;
                    if (compliance.status === 'compliant') return 100;

                    // Calculate score based on violations and warnings
                    const violations = compliance.violations || [];
                    const warnings = compliance.warnings || [];
                    const totalIssues = violations.length + (warnings.length * 0.5);

                    // Deduct points for each issue
                    const score = Math.max(0, 100 - (violations.length * 20) - (warnings.length * 10));
                    return Math.round(score);
                },
                showError(message) {
                    // Create error notification
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'fixed bottom-6 right-6 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg z-50';
                    errorDiv.innerHTML = `
                        <div class="flex items-center gap-3">
                            <i class="mdi mdi-alert-circle text-xl"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    document.body.appendChild(errorDiv);

                    // Remove after 5 seconds
                    setTimeout(() => {
                        errorDiv.remove();
                    }, 5000);
                },
                // This duplicate method is removed - see the proper one below
                reset() {
                    this.selectedFiles = [];
                    this.results = null;
                    // Note: totalTime is now a computed property, no need to reset data property
                    this.$refs.fileInput.value = '';
                },
                goHome() {
                    window.location.href = '/';
                },
                formatFieldName(fieldName) {
                    // Convert snake_case to Title Case
                    return fieldName
                        .split('_')
                        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                        .join(' ');
                },
                extractExpectedValue(reasonText) {
                    if (!reasonText) return null;
                    
                    // Try to extract expected values from common patterns in compliance reasons
                    const patterns = [
                        // Pattern: "Expected: X, found: Y" or "Expected X, got Y"
                        /expected[:\s]+([^,.\n]+)/i,
                        // Pattern: "Should be: X" or "Must be: X"
                        /(?:should|must)\s+be[:\s]+([^,.\n]+)/i,
                        // Pattern: "Required format: X" or "Valid format: X"
                        /(?:required|valid|allowed)\s+(?:format|values?)[:\s]+([^,.\n]+)/i,
                        // Pattern: "Allowed: [X, Y, Z]" or "Allowed: X"
                        /allowed[:\s]+\[?([^\]]+)\]?/i,
                        // Pattern: "Format should be: X"
                        /format\s+should\s+be[:\s]+([^,.\n]+)/i,
                        // Pattern: "Standard requires: X"
                        /standard\s+requires[:\s]+([^,.\n]+)/i
                    ];
                    
                    for (const pattern of patterns) {
                        const match = reasonText.match(pattern);
                        if (match && match[1]) {
                            // Clean up the extracted value
                            let expectedValue = match[1].trim();
                            // Remove quotes if present
                            expectedValue = expectedValue.replace(/^["']|["']$/g, '');
                            // Remove trailing punctuation
                            expectedValue = expectedValue.replace(/[,.;!?]+$/, '');
                            if (expectedValue.length > 0) {
                                return expectedValue;
                            }
                        }
                    }
                    
                    return null;
                },
                downloadReport() {
                    if (!this.selectedResult) return;

                    const report = {
                        fileName: this.selectedResult.fileName,
                        documentType: this.selectedResult.documentType,
                        confidence: this.selectedResult.confidence,
                        extractedFields: this.selectedResult.extractedFields,
                        compliance: this.selectedResult.compliance,
                        processingTime: this.selectedResult.processingTime,
                        timestamp: new Date().toISOString()
                    };

                    const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.selectedResult.fileName.replace(/\.[^/.]+$/, '')}_report.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },
                // Enhanced modal methods
                viewDetails(index) {
                    this.selectedResult = this.results[index];
                    this.showDetailsModal = true;
                    this.currentPage = 0;
                    this.zoomLevel = 1;
                    this.activeFieldIndex = null;
                    this.drawings = [];
                    this.hasDrawings = false;
                    this.pendingHighlight = null;

                    // Debug logging to help identify issues
                    console.log('=== DEBUG: View Details ===');
                    console.log('Selected result:', this.selectedResult);
                    console.log('Raw result data:', this.selectedResult?._rawResult);
                    console.log('Compliance data:', this.selectedResult?.compliance);
                    console.log('UCP600 exists:', !!this.selectedResult?.compliance?.ucp600);
                    console.log('SWIFT exists:', !!this.selectedResult?.compliance?.swift);
                    console.log('Extracted fields:', this.selectedResult?.extractedFields);
                    console.log('Preview images length:', this.selectedResult?.previewImages?.length);
                    console.log('Current page:', this.currentPage);

                    // Additional data transformation if needed
                    if (this.selectedResult && !this.selectedResult.compliance.swift && this.selectedResult._rawResult) {
                        // Try to extract compliance data from raw result
                        const raw = this.selectedResult._rawResult;
                        if (raw.swift_result || raw.ucp600_result) {
                            this.selectedResult.compliance = {
                                swift: raw.swift_result || null,
                                ucp600: raw.ucp600_result || null
                            };
                            console.log('Updated compliance from raw data:', this.selectedResult.compliance);
                        }
                    }

                    // Ensure extracted fields have proper format
                    if (this.selectedResult?.extractedFields && Object.keys(this.selectedResult.extractedFields).length === 0) {
                        // Try to get fields from analysis_result
                        if (this.selectedResult._rawResult?.analysis_result?.combined_fields) {
                            this.selectedResult.extractedFields = this.selectedResult._rawResult.analysis_result.combined_fields;
                            console.log('Updated extracted fields from analysis_result');
                        }
                    }

                    // Set default tab based on available data
                    if (this.selectedResult?.compliance?.swift || this.selectedResult?.compliance?.ucp600) {
                        this.activeTab = 'fields'; // Start with fields tab
                    }
                },
                closeDetailsModal() {
                    this.showDetailsModal = false;
                    this.selectedResult = null;
                    this.activeTab = 'fields';
                    this.activePageTab = 0;  // Reset page tab
                    this.currentPage = 0;
                    this.zoomLevel = 1;
                    this.activeFieldIndex = null;
                    this.drawings = [];
                    this.pendingHighlight = null;
                },

                // Page tab navigation for grouped results
                switchPageTab(pageIndex) {
                    this.activePageTab = pageIndex;
                    console.log('Switched to page tab:', pageIndex);
                    
                    // If this is a grouped result with individual pages, we can show page-specific data
                    if (this.selectedResult?.individualPages && this.selectedResult.individualPages[pageIndex]) {
                        const pageData = this.selectedResult.individualPages[pageIndex];
                        console.log('Page-specific data:', pageData);
                        // Future: Could update currentPage for image preview to match the selected tab
                    }
                },

                // Get current page data for tabbed view
                getCurrentPageData() {
                    if (!this.selectedResult?.individualPages || this.selectedResult.individualPages.length <= 1) {
                        return null; // Single page or no individual page data
                    }
                    
                    return this.selectedResult.individualPages[this.activePageTab] || null;
                },

                // Check if result has multiple pages (for showing tabs)
                hasMultiplePages() {
                    return this.selectedResult?.individualPages && this.selectedResult.individualPages.length > 1;
                },

                // Populate form fields back to parent LC form
                populateFormFields() {
                    if (!this.selectedResult) {
                        alert('No document selected');
                        return;
                    }

                    console.log('Selected result:', this.selectedResult);
                    console.log('Raw data:', this.selectedResult.rawData);

                    // Map extracted fields to LC form fields (using exact field names from the data)
                    const fieldMapping = {
                        // Basic Information
                        'lc_number': 'lcNumber',
                        'issue_date': 'issueDate',
                        'expiry_date': 'expiryDate',

                        // Parties
                        'buyer': 'applicant',  // Buyer maps to Applicant
                        'seller': 'beneficiary',  // Seller maps to Beneficiary
                        'issuing_bank': 'issuingBank',
                        'advising_bank': 'advisingBank',

                        // Amount and Payment
                        'currency': 'currency',
                        'total_amount': 'amount',
                        'amount': 'amount',
                        'payment_terms': 'paymentTerms',

                        // Shipment Details
                        'port_of_loading': 'portOfLoading',
                        'port_of_discharge': 'portOfDischarge',
                        'final_destination': 'finalDestination',
                        'latest_shipment_date': 'latestShipmentDate',
                        'partial_shipment': 'partialShipment',
                        'transhipment': 'transhipment',
                        'incoterms': 'incoterms',

                        // Goods
                        'description_of_goods': 'goodsDescription',
                        'hs_code': 'hsCode',
                        'quantity': 'quantity',
                        'unit_price': 'unitPrice'
                    };

                    // Prepare data to send to parent window
                    const formData = {};

                    // Get extracted fields from the raw data (with underscore)
                    let extractedFields = null;
                    if (this.selectedResult.rawData && this.selectedResult.rawData.extracted_fields) {
                        extractedFields = this.selectedResult.rawData.extracted_fields;
                    } else if (this.selectedResult.extractedFields) {
                        extractedFields = this.selectedResult.extractedFields;
                    }

                    console.log('Extracted fields found:', extractedFields);

                    // Process the extracted fields
                    if (extractedFields && typeof extractedFields === 'object') {
                        for (const [key, fieldData] of Object.entries(extractedFields)) {
                            const formFieldName = fieldMapping[key.toLowerCase()];
                            if (formFieldName) {
                                // Handle different field data structures
                                let value = '';
                                if (typeof fieldData === 'object' && fieldData !== null) {
                                    value = fieldData.value || fieldData.text || fieldData.content || '';
                                } else {
                                    value = fieldData;
                                }

                                if (value) {
                                    formData[formFieldName] = value;
                                    console.log(`Mapping ${key} -> ${formFieldName}: ${value}`);
                                }
                            }
                        }
                    }

                    console.log('Final form data to populate:', formData);

                    // Send message to parent window (LC form)
                    if (window.parent !== window) {
                        window.parent.postMessage({
                            type: 'POPULATE_LC_FORM',
                            data: formData
                        }, '*');

                        // Show success message
                        this.showNotification('Fields submitted successfully!', 'success');

                        // Close modal after a delay
                        setTimeout(() => {
                            this.closeDetailsModal();
                        }, 1500);
                    } else {
                        // If not in iframe, just show the data
                        console.log('Form data to populate:', formData);
                        alert('Form fields ready to submit.');
                    }
                },

                showNotification(message, type = 'info') {
                    // Simple notification (you can enhance this)
                    const notification = document.createElement('div');
                    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                        type === 'success' ? 'bg-green-500 text-white' :
                        type === 'error' ? 'bg-red-500 text-white' :
                        'bg-blue-500 text-white'
                    }`;
                    notification.textContent = message;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                },
                // Pagination methods
                prevPage() {
                    if (this.currentPage > 0) {
                        this.currentPage--;
                        this.activeFieldIndex = null;
                        this.panX = 0;
                        this.panY = 0;
                    }
                },
                nextPage() {
                    if (this.selectedResult?.previewImages && this.currentPage < this.selectedResult.previewImages.length - 1) {
                        this.currentPage++;
                        this.activeFieldIndex = null;
                        this.panX = 0;
                        this.panY = 0;
                    }
                },
                // Zoom methods
                zoomIn() {
                    if (this.zoomLevel < 3) {
                        this.zoomLevel = Math.min(3, this.zoomLevel + 0.25);
                    }
                },
                zoomOut() {
                    if (this.zoomLevel > 0.5) {
                        this.zoomLevel = Math.max(0.5, this.zoomLevel - 0.25);
                    }
                },
                resetZoom() {
                    this.zoomLevel = 1;
                    this.panX = 0;
                    this.panY = 0;
                },
                handleWheel(event) {
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        if (event.deltaY < 0) {
                            this.zoomIn();
                        } else {
                            this.zoomOut();
                        }
                    }
                },
                // Pan/drag methods
                startPan(event) {
                    // Only pan if select tool is active
                    if (this.currentTool !== 'select') return;

                    this.isPanning = true;
                    this.panStartX = event.clientX - this.panX;
                    this.panStartY = event.clientY - this.panY;
                },
                pan(event) {
                    if (!this.isPanning || this.currentTool !== 'select') return;

                    event.preventDefault();
                    this.panX = event.clientX - this.panStartX;
                    this.panY = event.clientY - this.panStartY;
                },
                endPan() {
                    this.isPanning = false;
                },
                // Field methods
                getExtractedFieldsWithDetails() {
                    if (!this.selectedResult?.extractedFields) return {};

                    const fields = {};
                    for (const [key, value] of Object.entries(this.selectedResult.extractedFields)) {
                        if (typeof value === 'object' && value !== null) {
                            // Check if it has the expected structure
                            if (value.hasOwnProperty('value') || value.hasOwnProperty('text')) {
                                // Check if page numbers are 1-based or 0-based
                                let pageNum = value.bounding_page !== undefined ? value.bounding_page : (value.page || 0);
                                // If page number is greater than 0, assume it's 1-based and convert to 0-based
                                if (pageNum > 0) {
                                    pageNum = pageNum - 1;
                                }
                                fields[key] = {
                                    value: value.value || value.text || '',
                                    confidence: value.confidence || 85,
                                    bounding_page: pageNum,
                                    bounding_box: value.bounding_box || value.bbox || null
                                };
                            } else if (value.hasOwnProperty('content')) {
                                // Handle alternative structure
                                fields[key] = {
                                    value: value.content || '',
                                    confidence: value.confidence || 85,
                                    bounding_page: value.page_number !== undefined ? value.page_number - 1 : 0,
                                    bounding_box: value.coordinates || value.bounding_box || null
                                };
                            } else {
                                // Fallback for other structures
                                fields[key] = {
                                    value: JSON.stringify(value),
                                    confidence: 85,
                                    bounding_page: 0,
                                    bounding_box: null
                                };
                            }
                        } else {
                            // Field is just a simple value
                            fields[key] = {
                                value: value || '',
                                confidence: 85,
                                bounding_page: 0,
                                bounding_box: null
                            };
                        }
                    }

                    console.log('Extracted fields with details:', fields);
                    return fields;
                },
                getFieldsWithBoundingBox() {
                    const fields = [];
                    const extractedFields = this.getExtractedFieldsWithDetails();

                    Object.entries(extractedFields).forEach(([key, field], index) => {
                        if (field.bounding_box) {
                            fields.push({
                                ...field,
                                fieldKey: key,
                                name: this.formatFieldName(key),
                                index: index,
                                bounding_page: field.bounding_page !== undefined ? field.bounding_page : field.page || 0,
                                page: field.page || field.bounding_page || 0
                            });
                        }
                    });

                    return fields;
                },
                highlightField(index, fieldData) {
                    // Set active field index
                    this.activeFieldIndex = index;

                    // If field has page info, navigate to that page
                    if (fieldData.bounding_page !== undefined && fieldData.bounding_page !== this.currentPage) {
                        this.currentPage = fieldData.bounding_page;
                        // Store the field to highlight after page loads
                        this.pendingHighlight = fieldData;
                    } else {
                        // Same page, highlight immediately
                        this.$nextTick(() => {
                            this.ensureCanvasReady(() => {
                                this.drawHighlight(fieldData);
                            });
                        });
                    }
                },
               async searchFieldCoordinates(fieldKey, fieldValue) {
    console.log('🔍 === FRONTEND COORDINATE SEARCH STARTED ===');
    console.log(`📝 Search parameters:`, { fieldKey, fieldValue });

    if (!fieldValue || !fieldValue.trim()) {
        console.warn('❌ No value to search for this field');
        alert('No value to search for this field');
        return;
    }

    console.log(`🔎 Setting search state for field: ${fieldKey}`);
    this.searchingField = fieldKey;

    try {
        console.log(`🔍 Searching coordinates for field '${fieldKey}' with value '${fieldValue}'`);

        const requestData = {
            field_value: fieldValue.trim(),
            document_id: this.selectedResult?.fileName || 'current',
            search_mode: 'exact'  // Start with exact search, can make this configurable
        };

        console.log('📤 Sending API request:', requestData);

        const response = await fetch('/api/search_field_coordinates', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        });

        console.log('📥 API response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('📊 API response data:', data);

        if (data.success && data.total_matches > 0) {
            console.log(`✅ Found ${data.total_matches} coordinate matches:`, data.matches);

            // Store all matches for this field
            this.coordinateSearchResults[fieldKey] = data.matches;
            console.log('💾 Stored all search results for field:', fieldKey);

            // FIX: Find the best match (longest matched text) instead of using first match
            let bestMatch = data.matches[0];
            let longestMatchLength = bestMatch.matched_text ? bestMatch.matched_text.length : 0;

            // Find the match with the longest text (most complete match)
            data.matches.forEach(match => {
                if (match.matched_text && match.matched_text.length > longestMatchLength) {
                    bestMatch = match;
                    longestMatchLength = match.matched_text.length;
                }
            });

            console.log('🎯 Selected best match:', {
                matched_text: bestMatch.matched_text,
                length: longestMatchLength,
                bounding_page: bestMatch.bounding_page
            });

            // Convert absolute page number to relative page index
            const absolutePage = bestMatch.bounding_page;
            let targetPage;

            // Method 1: Use the pages array if available
            if (this.selectedResult?.pages && this.selectedResult.pages.length > 0) {
                targetPage = this.selectedResult.pages.indexOf(absolutePage);
                console.log(`📚 Using pages array: absolute page ${absolutePage} = relative index ${targetPage}`);
            } else {
                // Method 2: Direct conversion (assuming pages are 1-indexed in backend, 0-indexed in frontend)
                targetPage = absolutePage - 1;
                console.log(`📝 Using direct conversion: absolute page ${absolutePage} = relative index ${targetPage}`);
            }

            console.log(`📄 Navigation: Current page: ${this.currentPage}, Target page: ${targetPage}`);
            console.log(`📚 Available pages: ${this.selectedResult?.previewImages?.length || 0}`);
            console.log(`📋 Absolute page: ${absolutePage}, Relative index: ${targetPage}`);
            console.log(`🗂️ Group pages: ${JSON.stringify(this.selectedResult?.pages)}`);

            if (targetPage >= 0 && targetPage < (this.selectedResult?.previewImages?.length || 0)) {
                console.log(`🧭 Navigating to relative page ${targetPage} (absolute page ${absolutePage})`);
                this.currentPage = targetPage;

                // Wait for page to load then highlight ALL matches
                this.$nextTick(() => {
                    console.log('⏱️ Waiting for page to load before highlighting...');
                    setTimeout(() => {
                        console.log('🎨 Highlighting ALL search results');
                        this.highlightAllSearchResults(data.matches);
                    }, 300);
                });
            } else {
                console.warn(`⚠️ Target page ${targetPage} is out of range (0-${(this.selectedResult?.previewImages?.length || 1) - 1})`);

                // Fallback: Highlight matches on current page anyway
                this.$nextTick(() => {
                    console.log('🔄 Fallback: Highlighting matches on current page');
                    this.highlightAllSearchResults(data.matches);
                });
            }

            // Show success message with total count
            const message = `Found ${data.total_matches} coordinate matches for "${fieldValue}"`;
            console.log('📢 Showing success notification:', message);
            this.showNotification(message, 'success');

        } else {
            console.log('❌ No matches found in API response');
            const message = `No coordinates found for "${fieldValue}"`;
            console.log('📢 Showing warning notification:', message);
            this.showNotification(message, 'warning');
        }

    } catch (error) {
        console.error('❌ Error searching coordinates:', error);
        console.error('📍 Error details:', {
            message: error.message,
            stack: error.stack
        });
        this.showNotification('Error searching for coordinates', 'error');
    } finally {
        console.log(`🏁 Clearing search state for field: ${fieldKey}`);
        this.searchingField = null;
        console.log('🔍 === FRONTEND COORDINATE SEARCH COMPLETED ===');
    }
},
                highlightSearchResult(searchResult) {
                    console.log('🎨 === HIGHLIGHTING SEARCH RESULT ===');
                    console.log('📊 Search result data:', searchResult);
                    
                    if (!searchResult.bounding_box || !this.$refs.drawingCanvas) {
                        console.warn('❌ Cannot highlight: missing bounding box or canvas');
                        console.log('   Bounding box:', searchResult.bounding_box);
                        console.log('   Canvas ref exists:', !!this.$refs.drawingCanvas);
                        return;
                    }
                    
                    console.log('🖼️ Canvas and bounding box available');
                    console.log('   Canvas element:', this.$refs.drawingCanvas);
                    console.log('   Drawing context:', this.drawingContext);
                    
                    // Clear previous highlights
                    const ctx = this.drawingContext;
                    if (ctx) {
                        console.log('🧽 Clearing previous highlights');
                        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    } else {
                        console.warn('⚠️ No drawing context available');
                    }
                    
                    // Highlight the found text
                    const bbox = searchResult.bounding_box;
                    console.log('📐 Highlighting bounding box:', bbox);
                    console.log('📄 Target page:', searchResult.bounding_page);
                    
                    // Create a temporary field object for highlighting
                    const tempField = {
                        bounding_box: bbox,
                        bounding_page: searchResult.bounding_page - 1,  // Convert to 0-based
                        fieldKey: 'search_result',
                        name: `Found: ${searchResult.matched_text}`,
                        confidence: searchResult.match_confidence
                    };
                    
                    console.log('🎯 Created temp field for highlighting:', tempField);
                    console.log('🎨 Calling drawHighlight function...');
                    
                    try {
                        this.drawHighlight(tempField);
                        console.log('✅ Highlight drawing completed successfully');
                    } catch (error) {
                        console.error('❌ Error drawing highlight:', error);
                    }
                },
                
                highlightAllSearchResults(matches) {
                    console.log('🎨 === HIGHLIGHTING ALL SEARCH RESULTS ===');
                    console.log(`📦 Highlighting ${matches.length} matches`);
                    
                    // Clear previous highlights ONCE at the beginning
                    const ctx = this.drawingContext;
                    if (ctx) {
                        console.log('🧽 Clearing previous highlights');
                        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    } else {
                        console.warn('⚠️ No drawing context available');
                        return;
                    }
                    
                    // Highlight each match WITHOUT clearing between them
                    matches.forEach((match, index) => {
                        console.log(`🎯 Highlighting match ${index + 1}/${matches.length}:`, {
                            text: match.matched_text,
                            confidence: match.match_confidence,
                            page: match.bounding_page,
                            bbox: match.bounding_box
                        });
                        
                        // Only highlight matches on the current page
                        const matchPage = this.getRelativePageIndex(match.bounding_page);
                        console.log(`🔍 Match absolute page: ${match.bounding_page}, relative page: ${matchPage}, current page: ${this.currentPage}`);
                        
                        if (matchPage === this.currentPage) {
                            console.log(`✅ Match ${index + 1} is on current page ${this.currentPage}, highlighting...`);
                            
                            // Create a temporary field object for highlighting
                            const tempField = {
                                bounding_box: match.bounding_box,
                                bounding_page: matchPage,
                                fieldKey: `search_result_${index}`,
                                name: `Found: ${match.matched_text}`,
                                confidence: match.match_confidence
                            };
                            
                            try {
                                // Draw highlight WITHOUT clearing previous ones
                                this.drawHighlight(tempField, false);
                                console.log(`✅ Match ${index + 1} highlighted successfully`);
                            } catch (error) {
                                console.error(`❌ Error highlighting match ${index + 1}:`, error);
                            }
                        } else {
                            console.log(`⏭️ Match ${index + 1} is on page ${matchPage}, current page is ${this.currentPage}, skipping...`);
                        }
                    });
                    
                    console.log('🎨 === ALL HIGHLIGHTS COMPLETED ===');
                },
                
                showNotification(message, type = 'info') {
                    // Simple notification - you could enhance this with a proper notification system
                    const bgColor = {
                        'success': 'bg-green-500',
                        'warning': 'bg-yellow-500', 
                        'error': 'bg-red-500',
                        'info': 'bg-blue-500'
                    }[type] || 'bg-blue-500';
                    
                    // Create a temporary notification element
                    const notification = document.createElement('div');
                    notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300`;
                    notification.textContent = message;
                    document.body.appendChild(notification);
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        setTimeout(() => {
                            document.body.removeChild(notification);
                        }, 300);
                    }, 3000);
                },
                getPageDocumentType() {
                    if (!this.selectedResult?.analysisResult?.per_page || !this.selectedResult.analysisResult.per_page[this.currentPage]) {
                        return this.selectedResult?.documentType || 'Unknown';
                    }
                    const pageData = this.selectedResult.analysisResult.per_page[this.currentPage];
                    return pageData.classification?.document_type || this.selectedResult?.documentType || 'Unknown';
                },
                getPageSubtype() {
                    if (!this.selectedResult?.analysisResult?.per_page || !this.selectedResult.analysisResult.per_page[this.currentPage]) {
                        return this.selectedResult?.analysisResult?.document_subtype || null;
                    }
                    const pageData = this.selectedResult.analysisResult.per_page[this.currentPage];
                    return pageData.classification?.sub_type || this.selectedResult?.analysisResult?.document_subtype || null;
                },
                getMainSubtype() {
                    // Check if there's a subtype in the first page classification
                    if (this.selectedResult?.page_classifications && this.selectedResult.page_classifications.length > 0) {
                        return this.selectedResult.page_classifications[0].sub_type || null;
                    }
                    return null;
                },
                formatDocumentType(docType) {
                    if (!docType) return 'Unknown';
                    // Convert snake_case to Title Case
                    return docType.split('_').map(word =>
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                },
                getBoundingBoxStyle(field) {
                    if (!field?.bounding_box || !this.$refs.documentImage) return {};

                    try {
                        const box = field.bounding_box;
                        const img = this.$refs.documentImage;

                        if (!Array.isArray(box) || box.length !== 4) return {};

                        // Bounding box format is [x1, y1, x2, y2] in inches
                        // Convert from inches to pixels using the document DPI
                        // Most PDF documents are rendered at 150-300 DPI, but we need to scale to displayed image
                        const [x1_inches, y1_inches, x2_inches, y2_inches] = box;

                        // Calculate relative positions as percentages of the image
                        // Assume the bounding box coordinates are relative to the document's natural size
                        const imgWidth = img.clientWidth || img.width;
                        const imgHeight = img.clientHeight || img.height;

                        // Convert inches to percentage of the displayed image
                        // This assumes the document was processed at a specific DPI that maps to the image
                        const DPI_SCALE = 150; // Typical document processing DPI
                        const docWidthInches = img.naturalWidth / DPI_SCALE;
                        const docHeightInches = img.naturalHeight / DPI_SCALE;

                        // Check if coordinates are normalized (0-1) or in pixels
                        let left, top, width, height;

                        if (x2_inches <= 1 && y2_inches <= 1) {
                            // Normalized coordinates (0-1)
                            left = x1_inches * 100;
                            top = y1_inches * 100;
                            width = (x2_inches - x1_inches) * 100;
                            height = (y2_inches - y1_inches) * 100;
                        } else {
                            // Pixel coordinates - need to normalize
                            const imgNaturalWidth = img.naturalWidth || img.width;
                            const imgNaturalHeight = img.naturalHeight || img.height;

                            left = (x1_inches / imgNaturalWidth) * 100;
                            top = (y1_inches / imgNaturalHeight) * 100;
                            width = ((x2_inches - x1_inches) / imgNaturalWidth) * 100;
                            height = ((y2_inches - y1_inches) / imgNaturalHeight) * 100;
                        }

                        return {
                            left: `${left}%`,
                            top: `${top}%`,
                            width: `${width}%`,
                            height: `${height}%`,
                            position: 'absolute'
                        };
                    } catch (error) {
                        console.error('Error calculating bounding box style:', error);
                        return {};
                    }
                },
                getConfidenceClass(confidence) {
                    if (confidence >= 90) return 'confidence-high';
                    if (confidence >= 70) return 'confidence-medium';
                    return 'confidence-low';
                },
                // Drawing methods
                onImageLoad() {
                    this.$nextTick(() => {
                        this.setupCanvas();

                        // If there's a pending highlight, draw it after canvas is ready
                        if (this.pendingHighlight) {
                            setTimeout(() => {
                                this.drawHighlight(this.pendingHighlight);
                                this.pendingHighlight = null;
                            }, 100);
                        }
                    });
                },
                setupCanvas() {
                    if (!this.$refs.drawingCanvas || !this.$refs.documentImage) return;

                    const canvas = this.$refs.drawingCanvas;
                    const img = this.$refs.documentImage;

                    canvas.width = img.width;
                    canvas.height = img.height;

                    this.drawingContext = canvas.getContext('2d');
                    this.drawingContext.lineWidth = 2;
                    this.drawingContext.lineCap = 'round';

                    // Draw current page after canvas setup
                    this.drawCurrentPage();
                },
                ensureCanvasReady(callback) {
                    if (this.drawingContext && this.$refs.documentImage && this.$refs.drawingCanvas) {
                        callback();
                    } else {
                        // Retry after a short delay
                        setTimeout(() => {
                            this.setupCanvas();
                            if (callback) callback();
                        }, 50);
                    }
                },

                drawCurrentPage() {
                    // Placeholder for drawing the current page image
                    // This ensures the canvas is ready for annotations
                },

                drawHighlight(field, clearPrevious = false) {
                    if (!this.drawingContext || !field?.bounding_box || !this.$refs.documentImage) return;

                    const box = field.bounding_box;
                    if (!Array.isArray(box) || (box.length !== 4 && box.length !== 8)) return;

                    const img = this.$refs.documentImage;
                    const ctx = this.drawingContext;

                    // Only clear previous highlights if explicitly requested
                    if (clearPrevious) {
                        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    }

                    // Handle both 4-value [x1, y1, x2, y2] and 8-value [x1, y1, x2, y2, x3, y3, x4, y4] bounding boxes
                    let x1, y1, x2, y2;
                    if (box.length === 8) {
                        // For 8-value boxes, use first two points to create rectangle
                        x1 = Math.min(box[0], box[2], box[4], box[6]);
                        y1 = Math.min(box[1], box[3], box[5], box[7]);
                        x2 = Math.max(box[0], box[2], box[4], box[6]);
                        y2 = Math.max(box[1], box[3], box[5], box[7]);
                    } else {
                        // For 4-value boxes, use as-is
                        x1 = box[0];
                        y1 = box[1];
                        x2 = box[2];
                        y2 = box[3];
                    }

                    // Convert from inches to pixels
                    const DPI = 72;
                    x1 = x1 * DPI;
                    y1 = y1 * DPI;
                    x2 = x2 * DPI;
                    y2 = y2 * DPI;

                    // Calculate dimensions
                    const width = x2 - x1;
                    const height = y2 - y1;

                    // Scale to canvas dimensions
                    const scaleX = img.width / img.naturalWidth;
                    const scaleY = img.height / img.naturalHeight;

                    // Draw highlight only (no border box)
                    ctx.fillStyle = 'rgba(255, 235, 59, 0.4)';  // Rich yellow highlight

                    const scaledX = x1 * scaleX;
                    const scaledY = y1 * scaleY;
                    const scaledWidth = width * scaleX;
                    const scaledHeight = height * scaleY;

                    ctx.fillRect(scaledX, scaledY, scaledWidth, scaledHeight);

                    console.log(`🎨 Drew highlight at (${scaledX.toFixed(1)}, ${scaledY.toFixed(1)}) size ${scaledWidth.toFixed(1)}x${scaledHeight.toFixed(1)}`);
                },
                startDrawing(event) {
                    if (this.currentTool === 'select') return;

                    this.isDrawing = true;
                    const rect = event.target.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;

                    this.drawingContext.strokeStyle = this.currentColor;
                    this.drawingContext.lineWidth = 3;

                    if (this.currentTool === 'draw') {
                        this.drawingContext.beginPath();
                        this.drawingContext.moveTo(x, y);
                    } else if (this.currentTool === 'rectangle' || this.currentTool === 'textSelect') {
                        this.rectangleStart = { x, y };
                        if (this.currentTool === 'textSelect') {
                            this.textSelectionBox = null;
                            this.showFieldAssignment = false;
                        }
                    }

                    this.hasDrawings = true;
                },
                draw(event) {
                    if (!this.isDrawing || this.currentTool === 'select') return;

                    const rect = event.target.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;

                    if (this.currentTool === 'draw') {
                        this.drawingContext.lineTo(x, y);
                        this.drawingContext.stroke();
                    } else if ((this.currentTool === 'rectangle' || this.currentTool === 'textSelect') && this.rectangleStart) {
                        // Clear canvas for preview
                        const canvas = this.$refs.drawingCanvas;
                        this.drawingContext.clearRect(0, 0, canvas.width, canvas.height);

                        // Redraw existing drawings if not text selection
                        if (this.currentTool !== 'textSelect' && this.hasDrawings) {
                            // Would need to store and redraw previous drawings
                        }

                        // Draw selection rectangle
                        if (this.currentTool === 'textSelect') {
                            this.drawingContext.strokeStyle = '#667eea';
                            this.drawingContext.lineWidth = 2;
                            this.drawingContext.setLineDash([5, 5]);
                            this.drawingContext.fillStyle = 'rgba(102, 126, 234, 0.1)';

                            const width = x - this.rectangleStart.x;
                            const height = y - this.rectangleStart.y;

                            this.drawingContext.fillRect(this.rectangleStart.x, this.rectangleStart.y, width, height);
                            this.drawingContext.strokeRect(this.rectangleStart.x, this.rectangleStart.y, width, height);
                            this.drawingContext.setLineDash([]);
                        } else {
                            this.drawingContext.strokeStyle = this.currentColor;
                            this.drawingContext.strokeRect(
                                this.rectangleStart.x,
                                this.rectangleStart.y,
                                x - this.rectangleStart.x,
                                y - this.rectangleStart.y
                            );
                        }
                    }
                },
                endDrawing(event) {
                    if (!this.isDrawing || !this.rectangleStart) {
                        this.isDrawing = false;
                        return;
                    }

                    const rect = event.target.getBoundingClientRect();
                    const x = event.clientX - rect.left;
                    const y = event.clientY - rect.top;

                    if (this.currentTool === 'rectangle') {
                        this.drawingContext.strokeStyle = this.currentColor;
                        this.drawingContext.strokeRect(
                            this.rectangleStart.x,
                            this.rectangleStart.y,
                            x - this.rectangleStart.x,
                            y - this.rectangleStart.y
                        );
                    } else if (this.currentTool === 'textSelect') {
                        // Store the selection region
                        this.textSelectionBox = {
                            x: Math.min(this.rectangleStart.x, x),
                            y: Math.min(this.rectangleStart.y, y),
                            width: Math.abs(x - this.rectangleStart.x),
                            height: Math.abs(y - this.rectangleStart.y)
                        };

                        // Extract text from the selected region
                        this.extractTextFromRegion().then(() => {
                            // If we have a target field, directly assign the text
                            if (this.targetField) {
                                this.assignTextToField(this.targetField);
                                this.targetField = null;
                                this.currentTool = 'select'; // Switch back to select tool
                            } else {
                                // Show field assignment dialog for general text selection
                                this.showFieldAssignment = true;
                            }
                        });

                        // Clear the selection rectangle
                        this.drawingContext.clearRect(0, 0, rect.width, rect.height);
                    }

                    this.isDrawing = false;
                    this.rectangleStart = null;
                },
                clearDrawings() {
                    if (this.drawingContext && this.$refs.drawingCanvas) {
                        const canvas = this.$refs.drawingCanvas;
                        this.drawingContext.clearRect(0, 0, canvas.width, canvas.height);
                        this.hasDrawings = false;
                    }
                },
                // Export methods
                exportJSON() {
                    if (!this.selectedResult) return;

                    const exportData = {
                        fileName: this.selectedResult.fileName,
                        documentType: this.selectedResult.documentType,
                        confidence: this.selectedResult.confidence,
                        extractedFields: this.selectedResult.extractedFields,
                        compliance: this.selectedResult.compliance,
                        processingTime: this.selectedResult.processingTime,
                        analysisResult: this.selectedResult.analysisResult,
                        metadata: {
                            exportDate: new Date().toISOString(),
                            totalPages: this.selectedResult.previewImages?.length || 1,
                            hasAnnotations: this.hasDrawings
                        }
                    };

                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${this.selectedResult.fileName.replace(/\.[^/.]+$/, '')}_detailed_report.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },
                exportWithAnnotations() {
                    // Export current page with annotations as image
                    if (!this.$refs.drawingCanvas || !this.$refs.documentImage) return;

                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    const img = this.$refs.documentImage;
                    const drawCanvas = this.$refs.drawingCanvas;

                    tempCanvas.width = img.width;
                    tempCanvas.height = img.height;

                    // Draw the document image
                    tempCtx.drawImage(img, 0, 0);

                    // Draw the annotations
                    tempCtx.drawImage(drawCanvas, 0, 0);

                    // Convert to blob and download
                    tempCanvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${this.selectedResult.fileName.replace(/\.[^/.]+$/, '')}_page_${this.currentPage + 1}_annotated.png`;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                },
                // Field editing methods
                startFieldEdit(fieldKey, value) {
                    this.editingField = fieldKey;
                    this.editedFields[fieldKey] = value || '';

                    this.$nextTick(() => {
                        const input = this.$refs['fieldInput_' + fieldKey];
                        if (input && input[0]) {
                            input[0].focus();
                            input[0].select();
                        }
                    });
                },
                saveFieldEdit(fieldKey) {
                    if (this.editingField === fieldKey) {
                        // Update the field value
                        const fields = this.getExtractedFieldsWithDetails();
                        if (fields[fieldKey]) {
                            fields[fieldKey].value = this.editedFields[fieldKey];

                            // Update in the original result
                            if (this.selectedResult.extractedFields[fieldKey]) {
                                if (typeof this.selectedResult.extractedFields[fieldKey] === 'object') {
                                    this.selectedResult.extractedFields[fieldKey].value = this.editedFields[fieldKey];
                                } else {
                                    this.selectedResult.extractedFields[fieldKey] = this.editedFields[fieldKey];
                                }
                            }
                        }

                        this.editingField = null;
                    }
                },
                cancelFieldEdit() {
                    this.editingField = null;
                    this.editedFields = {};
                },
                // Text extraction methods
                async extractTextFromRegion() {
                    const img = this.$refs.documentImage;
                    if (!img || !this.textSelectionBox) return;

                    // Calculate the region coordinates relative to the original image
                    const scaleX = img.naturalWidth / img.clientWidth;
                    const scaleY = img.naturalHeight / img.clientHeight;

                    const region = {
                        x: this.textSelectionBox.x * scaleX / this.zoomLevel,
                        y: this.textSelectionBox.y * scaleY / this.zoomLevel,
                        width: this.textSelectionBox.width * scaleX / this.zoomLevel,
                        height: this.textSelectionBox.height * scaleY / this.zoomLevel,
                        page: this.currentPage
                    };

                    // Try to get text from existing fields or OCR
                    await this.performOCRExtraction(region);
                },
                simulateTextExtraction(region) {
                    // Check if the selection overlaps with any existing field bounding boxes
                    const fields = this.getFieldsWithBoundingBox();
                    for (const field of fields) {
                        if (field.bounding_page === this.currentPage && this.isRegionOverlapping(region, field)) {
                            return field.value || 'Extracted text from field';
                        }
                    }
                    return 'Selected text content';
                },
                isRegionOverlapping(region, field) {
                    if (!field.bounding_box) return false;

                    const [fx1, fy1, fx2, fy2] = field.bounding_box;
                    const img = this.$refs.documentImage;

                    // Convert field coordinates to pixels
                    let fieldX1, fieldY1, fieldX2, fieldY2;
                    if (fx2 <= 1 && fy2 <= 1) {
                        // Normalized coordinates
                        fieldX1 = fx1 * img.naturalWidth;
                        fieldY1 = fy1 * img.naturalHeight;
                        fieldX2 = fx2 * img.naturalWidth;
                        fieldY2 = fy2 * img.naturalHeight;
                    } else {
                        // Pixel coordinates
                        fieldX1 = fx1;
                        fieldY1 = fy1;
                        fieldX2 = fx2;
                        fieldY2 = fy2;
                    }

                    // Check for overlap
                    return !(region.x + region.width < fieldX1 ||
                            region.x > fieldX2 ||
                            region.y + region.height < fieldY1 ||
                            region.y > fieldY2);
                },
                async performOCRExtraction(region) {
                    // Show loading state
                    this.isExtractingText = true;
                    this.extractedText = 'Extracting text...';

                    try {
                        // Get the current image as base64
                        const img = this.$refs.documentImage;
                        if (!img) {
                            this.extractedText = 'Image not available';
                            return;
                        }

                        // Make API call to extract text
                        const response = await fetch('/api/document/extract-region', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                image: img.src,
                                region: {
                                    x: region.x,
                                    y: region.y,
                                    width: region.width,
                                    height: region.height,
                                    page: region.page
                                },
                                document_id: this.selectedResult?.id
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            this.extractedText = result.extracted_text || 'No text found';
                        } else {
                            // Fallback to simulation
                            this.extractedText = this.simulateTextExtraction(region);
                        }
                    } catch (error) {
                        console.error('OCR extraction error:', error);
                        // Fallback to simulation
                        this.extractedText = this.simulateTextExtraction(region);
                    } finally {
                        this.isExtractingText = false;
                    }
                },
                isBlockInRegion(block, region) {
                    // Check if OCR block overlaps with selected region
                    if (!block.bbox) return false;
                    const [bx1, by1, bx2, by2] = block.bbox;
                    return !(region.x + region.width < bx1 ||
                            region.x > bx2 ||
                            region.y + region.height < by1 ||
                            region.y > by2);
                },
                assignTextToField(fieldKey) {
                    if (!this.extractedText || this.extractedText === 'Extracting text...') {
                        console.warn('No extracted text to assign');
                        return;
                    }

                    console.log(`Assigning text "${this.extractedText}" to field "${fieldKey}"`);

                    // Update the field value and bounding box
                    const extractedValue = this.extractedText;

                    // Update bounding box if we have a selection
                    let boundingBox = null;
                    let boundingPage = this.currentPage;

                    if (this.textSelectionBox) {
                        const img = this.$refs.documentImage;
                        if (img) {
                            // Convert pixel coordinates to normalized coordinates
                            const x1 = (this.textSelectionBox.x / this.zoomLevel) / img.clientWidth;
                            const y1 = (this.textSelectionBox.y / this.zoomLevel) / img.clientHeight;
                            const x2 = x1 + (this.textSelectionBox.width / this.zoomLevel) / img.clientWidth;
                            const y2 = y1 + (this.textSelectionBox.height / this.zoomLevel) / img.clientHeight;

                            boundingBox = [x1, y1, x2, y2];
                        }
                    }

                    // Update in the original result
                    if (this.selectedResult && this.selectedResult.extractedFields) {
                        if (typeof this.selectedResult.extractedFields[fieldKey] === 'object' && this.selectedResult.extractedFields[fieldKey] !== null) {
                            // Update existing object
                            this.selectedResult.extractedFields[fieldKey].value = extractedValue;
                            if (boundingBox) {
                                this.selectedResult.extractedFields[fieldKey].bounding_box = boundingBox;
                                this.selectedResult.extractedFields[fieldKey].bounding_page = boundingPage;
                            }
                        } else {
                            // Convert to object format to store bounding box
                            this.selectedResult.extractedFields[fieldKey] = {
                                value: extractedValue,
                                bounding_box: boundingBox,
                                bounding_page: boundingPage,
                                confidence: 95
                            };
                        }

                        console.log('Updated field:', fieldKey, this.selectedResult.extractedFields[fieldKey]);
                    }

                    // Close the assignment dialog
                    this.showFieldAssignment = false;
                    this.extractedText = '';
                    this.textSelectionBox = null;

                    // Force re-render
                    this.$forceUpdate();
                },
                startFieldTextSelection(fieldKey) {
                    // Set the target field
                    this.targetField = fieldKey;

                    // Switch to text selection tool
                    this.currentTool = 'textSelect';

                    // Clear any existing selection
                    this.textSelectionBox = null;
                    this.showFieldAssignment = false;

                    // Get field data and highlight if it has bounding box
                    const fields = this.getExtractedFieldsWithDetails();
                    const fieldData = fields[fieldKey];

                    if (fieldData && fieldData.bounding_box) {
                        // Find the index for this field
                        const fieldIndex = Object.keys(fields).indexOf(fieldKey);

                        // Highlight the existing bounding box
                        this.highlightField(fieldIndex, {
                            ...fieldData,
                            fieldKey: fieldKey,
                            name: this.formatFieldName(fieldKey),
                            index: fieldIndex,
                            bounding_page: fieldData.bounding_page || 0
                        });
                    }

                    // Optional: Scroll to image viewer
                    const imageViewer = document.querySelector('.image-viewer');
                    if (imageViewer) {
                        imageViewer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                },
                // UCP600 data processing
                getUCP600TableData() {
                    if (!this.selectedResult?.compliance?.ucp600) return {};

                    const ucp600Data = this.selectedResult.compliance.ucp600;
                    const filteredData = {};

                    // Process each field and remove unwanted fields
                    for (const [key, value] of Object.entries(ucp600Data)) {
                        if (key === 'status' || key === 'violations' || key === 'warnings' || 
                            key === 'coordinate_mapping' || key === 'coordinate_mapping_stats' ||
                            key.includes('coordinate_mapping')) {
                            continue; // Skip these as they're handled separately or unwanted
                        }

                        if (typeof value === 'object' && value !== null) {
                            // Create a copy without unwanted properties
                            const cleanValue = { ...value };
                            delete cleanValue.severity;
                            delete cleanValue.coordinate_mapping;
                            delete cleanValue.coordinate_mapping_stats;
                            filteredData[key] = cleanValue;
                        } else {
                            filteredData[key] = value;
                        }
                    }

                    return filteredData;
                },
                // SWIFT data processing
                getSWIFTTableData() {
                    if (!this.selectedResult?.compliance?.swift) return {};

                    const swiftData = this.selectedResult.compliance.swift;
                    const filteredData = {};

                    // Process each field and remove unwanted fields
                    for (const [key, value] of Object.entries(swiftData)) {
                        if (key === 'status' || key === 'violations' || key === 'warnings' || 
                            key === 'coordinate_mapping' || key === 'coordinate_mapping_stats' ||
                            key.includes('coordinate_mapping')) {
                            continue; // Skip these as they're handled separately or unwanted
                        }

                        if (typeof value === 'object' && value !== null) {
                            // Create a copy without unwanted properties
                            const cleanValue = { ...value };
                            delete cleanValue.severity;
                            delete cleanValue.coordinate_mapping;
                            delete cleanValue.coordinate_mapping_stats;
                            filteredData[key] = cleanValue;
                        } else {
                            filteredData[key] = value;
                        }
                    }

                    return filteredData;
                },

                // Admin methods
                async fetchCurrentUser() {
                    try {
                        const response = await fetch('/auth/current-user', {
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.currentUser = data.user;
                                // Check if user is allowed (in the allowed emails list)
                                this.isAllowed = data.user.isAllowed === true;

                                if (this.isAllowed) {
                                    await this.loadDocumentTypes();
                                }
                            }
                        } else if (response.status === 401) {
                            // User not authenticated - this is OK for iframe/modal usage
                            console.log('User not authenticated - running in guest mode');
                            this.currentUser = null;
                            this.isAllowed = false;
                        }
                    } catch (error) {
                        console.error('Error fetching current user:', error);
                        // Continue without user info
                        this.currentUser = null;
                        this.isAllowed = false;
                    }
                },

                async loadDocumentTypes() {
                    this.adminLoading = true;
                    try {
                        const response = await fetch('/api/document-types', {
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.documentTypes = data.document_types;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading document types:', error);
                    } finally {
                        this.adminLoading = false;
                    }
                },

                selectDocType(docType) {
                    // Create a deep copy to avoid direct mutation
                    this.selectedDocType = JSON.parse(JSON.stringify(docType));
                    // Ensure fields array exists
                    if (!this.selectedDocType.fields) {
                        this.selectedDocType.fields = [];
                    }
                    this.editingDocType = false;
                    console.log('Selected document type:', this.selectedDocType);
                },

                addFieldToDocType() {
                    if (!this.newFieldName || !this.selectedDocType) return;

                    if (!this.selectedDocType.fields) {
                        this.selectedDocType.fields = [];
                    }

                    this.selectedDocType.fields.push({
                        name: this.newFieldName,
                        type: this.newFieldType,
                        required: false,
                        description: ''
                    });

                    this.newFieldName = '';
                    this.newFieldType = 'text';
                    this.editingDocType = true;
                },

                removeFieldFromDocType(index) {
                    if (!this.selectedDocType || !this.selectedDocType.fields) return;
                    this.selectedDocType.fields.splice(index, 1);
                    this.editingDocType = true;
                },

                toggleFieldRequired(field) {
                    field.required = !field.required;
                    this.editingDocType = true;
                },

                async saveDocType() {
                    if (!this.selectedDocType || !this.editingDocType) return;

                    this.adminLoading = true;
                    try {
                        // Use original_name if available, otherwise use name
                        const docTypeName = this.selectedDocType.original_name || this.selectedDocType.name;
                        console.log('Saving document type:', docTypeName, 'with fields:', this.selectedDocType.fields);

                        const response = await fetch(`/api/document-types/${encodeURIComponent(docTypeName)}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                fields: this.selectedDocType.fields || []
                            }),
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                console.log('Save result:', data);
                                await this.loadDocumentTypes();
                                // Re-select the updated doc type
                                const updatedDocType = this.documentTypes.find(dt => dt.name === this.selectedDocType.name);
                                if (updatedDocType) {
                                    this.selectDocType(updatedDocType);
                                }
                                this.editingDocType = false;
                                alert(`Document type updated successfully with ${data.field_count || 0} fields`);
                            }
                        } else {
                            const error = await response.json();
                            console.error('Error saving document type:', error);
                            alert('Error: ' + error.message);
                        }
                    } catch (error) {
                        console.error('Error saving document type:', error);
                        alert('Failed to save document type');
                    } finally {
                        this.adminLoading = false;
                    }
                },

                async createNewDocType() {
                    if (!this.newDocTypeName) return;

                    this.adminLoading = true;
                    try {
                        const response = await fetch('/api/document-types', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: this.newDocTypeName,
                                fields: []
                            }),
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.newDocTypeName = '';
                                this.showNewDocTypeDialog = false;
                                await this.loadDocumentTypes();
                                alert('Document type created successfully');
                            }
                        } else {
                            const error = await response.json();
                            alert('Error: ' + error.message);
                        }
                    } catch (error) {
                        console.error('Error creating document type:', error);
                        alert('Failed to create document type');
                    } finally {
                        this.adminLoading = false;
                    }
                },

                async deleteDocType(docType) {
                    if (!confirm(`Are you sure you want to delete the document type "${docType.name}"?`)) {
                        return;
                    }

                    this.adminLoading = true;
                    try {
                        const response = await fetch(`/api/document-types/${encodeURIComponent(docType.name)}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                if (this.selectedDocType === docType) {
                                    this.selectedDocType = null;
                                }
                                await this.loadDocumentTypes();
                                alert('Document type deleted successfully');
                            }
                        } else {
                            const error = await response.json();
                            alert('Error: ' + error.message);
                        }
                    } catch (error) {
                        console.error('Error deleting document type:', error);
                        alert('Failed to delete document type');
                    } finally {
                        this.adminLoading = false;
                    }
                },
                // Trade Document Methods
                async fetchTradeDocuments() {
                    try {
                        const response = await fetch('/api/trade-documents', {
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.tradeDocuments = data.documents;

                                // Categorize documents
                                const tradeFinanceCodes = ['PO', 'INV', 'LC', 'PC', 'BoE', 'PN'];
                                const transportCodes = ['BoL', 'SW', 'SDO', 'AW', 'SCM', 'ACM', 'CIM', 'CMR', 'SLI', 'PL'];
                                const customsCodes = ['CD', 'CoO', 'PCoO', 'ATA', 'TIR', 'TAD', 'ARA', 'EG', 'EMCS'];

                                this.tradeFinanceDocuments = this.tradeDocuments.filter(doc => tradeFinanceCodes.includes(doc.code));
                                this.transportDocuments = this.tradeDocuments.filter(doc => transportCodes.includes(doc.code));
                                this.customsDocuments = this.tradeDocuments.filter(doc => customsCodes.includes(doc.code));
                                this.otherDocuments = this.tradeDocuments.filter(doc =>
                                    !tradeFinanceCodes.includes(doc.code) &&
                                    !transportCodes.includes(doc.code) &&
                                    !customsCodes.includes(doc.code)
                                );

                                console.log(`✅ Loaded ${this.tradeDocuments.length} trade document types`);
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching trade documents:', error);
                    }
                },
                async onTradeDocumentTypeChange() {
                    if (!this.selectedTradeDocumentType) {
                        this.tradeDocumentFields = null;
                        return;
                    }

                    try {
                        const response = await fetch(`/api/trade-documents/${this.selectedTradeDocumentType}/fields`, {
                            credentials: 'include'
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.tradeDocumentFields = data;
                                console.log(`📋 Loaded fields for ${data.document.name}:`,
                                    `${data.statistics.mandatory}M, ${data.statistics.optional}O, ${data.statistics.conditional}C`);
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching document fields:', error);
                        this.tradeDocumentFields = null;
                    }
                }
            },
            mounted() {
                this.fetchCurrentUser();
                this.fetchTradeDocuments();
            }
        }).mount('#app');

        // Chart Functions - Define immediately after Vue app mount
        
        // COMPREHENSIVE Business Processing Pipeline - All Steps Visualization
        window.createQualityMetricsChart = function createQualityMetricsChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating comprehensive business pipeline for canvas:', canvasId);
            console.log('Raw result data:', resultData);
            
            const ctx = canvas.getContext('2d');
            
            // REAL processing data from all stages
            const qualityTime = parseFloat(resultData.qualityTime) || 0;
            const ocrTime = parseFloat(resultData.ocrTime) || parseFloat(resultData.qualityTime) * 0.3 || 0;
            const classificationTime = parseFloat(resultData.classificationTime) || 0;
            const entityTime = parseFloat(resultData.llmTime) || parseFloat(resultData.entityTime) || 0;
            const complianceTime = parseFloat(resultData.complianceTime) || 0.3;
            const totalTime = parseFloat(resultData.processingTime) || (qualityTime + ocrTime + classificationTime + entityTime + complianceTime);
            const confidence = resultData.confidence || 0;
            
            // Complete processing pipeline with all steps
            const processingSteps = [
                {
                    step: 'Quality Check',
                    duration: qualityTime,
                    description: 'Image quality analysis',
                    icon: '🔍',
                    color: '#3B82F6',
                    bgColor: 'rgba(59, 130, 246, 0.8)'
                },
                {
                    step: 'OCR Processing', 
                    duration: ocrTime,
                    description: 'Text extraction from image',
                    icon: '📖',
                    color: '#10B981',
                    bgColor: 'rgba(16, 185, 129, 0.8)'
                },
                {
                    step: 'AI Classification',
                    duration: classificationTime,
                    description: 'AI-powered document type identification',
                    icon: '🤖',
                    color: '#F59E0B',
                    bgColor: 'rgba(245, 158, 11, 0.8)'
                },
                {
                    step: 'Entity Extraction',
                    duration: entityTime,
                    description: 'Key data field extraction',
                    icon: '🏗️',
                    color: '#8B5CF6',
                    bgColor: 'rgba(139, 92, 246, 0.8)'
                },
                {
                    step: 'Compliance Check',
                    duration: complianceTime,
                    description: 'Regulatory compliance validation',
                    icon: '✅',
                    color: '#EF4444',
                    bgColor: 'rgba(239, 68, 68, 0.8)'
                }
            ];
            
            // Calculate percentages and cumulative times
            let cumulativeTime = 0;
            const enrichedSteps = processingSteps.map(step => {
                const percentage = totalTime > 0 ? Math.round((step.duration / totalTime) * 100) : 0;
                const startTime = cumulativeTime;
                cumulativeTime += step.duration;
                const endTime = cumulativeTime;
                
                return {
                    ...step,
                    percentage,
                    startTime,
                    endTime,
                    efficiency: step.duration < 0.5 ? 'Excellent' : step.duration < 1.5 ? 'Good' : step.duration < 3 ? 'Standard' : 'Needs Review'
                };
            });
            
            console.log('Complete processing pipeline:', enrichedSteps);
            
            try {
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: enrichedSteps.map(step => `${step.icon} ${step.step}`),
                        datasets: [
                            {
                                label: 'Processing Time (seconds)',
                                data: enrichedSteps.map(step => step.duration),
                                backgroundColor: enrichedSteps.map(step => step.bgColor),
                                borderColor: enrichedSteps.map(step => step.color),
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false,
                                barThickness: 60,
                                maxBarThickness: 80
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y', // Horizontal bars for timeline effect
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false // Clean look without legend
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#F9FAFB',
                                bodyColor: '#F3F4F6',
                                borderColor: 'rgba(59, 130, 246, 0.3)',
                                borderWidth: 2,
                                cornerRadius: 12,
                                padding: 16,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold',
                                    family: "'Inter', 'Segoe UI', sans-serif"
                                },
                                bodyFont: {
                                    size: 12,
                                    family: "'Inter', 'Segoe UI', sans-serif"
                                },
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    title: function(context) {
                                        const step = enrichedSteps[context[0].dataIndex];
                                        return `${step.icon} ${step.step}`;
                                    },
                                    label: function(context) {
                                        const step = enrichedSteps[context.dataIndex];
                                        return [
                                            `Duration: ${step.duration}s`,
                                            `Percentage: ${step.percentage}% of total`,
                                            `Timeline: ${step.startTime}s → ${step.endTime}s`,
                                            `Efficiency: ${step.efficiency}`
                                        ];
                                    },
                                    afterBody: function(context) {
                                        const step = enrichedSteps[context[0].dataIndex];
                                        return `\n📋 ${step.description}\n\n🏁 Total Pipeline: ${totalTime}s\n🎯 AI Confidence: ${confidence}%`;
                                    }
                                }
                            },
                            // Custom plugin for step annotations
                            beforeDraw: function(chart) {
                                const ctx = chart.ctx;
                                const chartArea = chart.chartArea;
                                
                                ctx.save();
                                ctx.font = 'bold 11px Inter, sans-serif';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                
                                // Add percentage labels on bars
                                chart.data.datasets[0].data.forEach((value, index) => {
                                    const meta = chart.getDatasetMeta(0);
                                    const bar = meta.data[index];
                                    const step = enrichedSteps[index];
                                    
                                    if (bar && step.duration > 0) {
                                        const x = bar.x + (bar.width / 2);
                                        const y = bar.y;
                                        
                                        ctx.fillStyle = '#FFFFFF';
                                        ctx.fillText(`${step.duration}s`, x, y - 8);
                                        ctx.fillText(`${step.percentage}%`, x, y + 8);
                                    }
                                });
                                
                                ctx.restore();
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '⏱️ Processing Time (seconds)',
                                    color: '#374151',
                                    font: {
                                        size: 14,
                                        weight: 'bold',
                                        family: "'Inter', 'Segoe UI', sans-serif"
                                    }
                                },
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: 11,
                                        weight: '500',
                                        family: "'Inter', 'Segoe UI', sans-serif"
                                    },
                                    callback: function(value) {
                                        return value + 's';
                                    }
                                },
                                beginAtZero: true
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '📊 Processing Pipeline Steps',
                                    color: '#374151',
                                    font: {
                                        size: 14,
                                        weight: 'bold',
                                        family: "'Inter', 'Segoe UI', sans-serif"
                                    }
                                },
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#374151',
                                    font: {
                                        size: 12,
                                        weight: '600',
                                        family: "'Inter', 'Segoe UI', sans-serif"
                                    },
                                    padding: 12
                                }
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart',
                            delay: function(context) {
                                return context.dataIndex * 200; // Staggered animation
                            }
                        },
                        layout: {
                            padding: {
                                top: 20,
                                right: 40,
                                bottom: 20,
                                left: 20
                            }
                        }
                    }
                });
                
                // Add single-line compact summary below chart
                setTimeout(() => {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.className = 'processing-summary';
                    summaryDiv.style.cssText = `
                        margin-top: 8px;
                        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                        border-radius: 6px;
                        padding: 8px 12px;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
                        font-family: 'Inter', 'Segoe UI', sans-serif;
                        font-size: 11px;
                        color: white;
                        font-weight: 600;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        height: 32px;
                        overflow: hidden;
                    `;
                    
                    const totalSteps = enrichedSteps.filter(s => s.duration > 0).length;
                    const avgTime = totalTime / totalSteps;
                    const efficiency = avgTime < 1 ? 'Excellent' : avgTime < 2 ? 'Good' : 'Standard';
                    const efficiencyIcon = avgTime < 1 ? '🏆' : avgTime < 2 ? '⚡' : '📊';
                    
                    summaryDiv.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 16px; white-space: nowrap;">
                            <span style="display: flex; align-items: center; gap: 4px;">
                                📈 <strong>${totalSteps}</strong> steps
                            </span>
                            <span style="color: rgba(255,255,255,0.3);">|</span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                ⏱️ <strong>${totalTime}s</strong> total
                            </span>
                            <span style="color: rgba(255,255,255,0.3);">|</span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                📊 <strong>${avgTime.toFixed(1)}s</strong> avg
                            </span>
                            <span style="color: rgba(255,255,255,0.3);">|</span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                ${efficiencyIcon} <strong>${efficiency}</strong>
                            </span>
                            <span style="color: rgba(255,255,255,0.3);">|</span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                🎯 <strong>${confidence}%</strong> confidence
                            </span>
                        </div>
                        <div style="
                            display: flex; 
                            align-items: center; 
                            gap: 4px;
                            font-size: 10px;
                            opacity: 0.8;
                        ">
                            <span style="
                                width: 4px; 
                                height: 4px; 
                                background: #10B981; 
                                border-radius: 50%;
                                animation: pulse 2s infinite;
                            "></span>
                            Active
                        </div>
                    `;
                    
                    canvas.parentNode.appendChild(summaryDiv);
                    
                    // Add pulse animation
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0%, 100% { opacity: 1; }
                            50% { opacity: 0.5; }
                        }
                    `;
                    document.head.appendChild(style);
                }, 100);
                
                console.log('Comprehensive business pipeline created successfully:', chart);
                return chart;
                
            } catch (error) {
                console.error('Error creating comprehensive pipeline:', error);
            }
        };

        // Premium Horizontal Bar Chart for Quality Metrics - Clean & Professional
        window.createQualityMetricsBarChart = function createQualityMetricsBarChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Quality metrics canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating premium horizontal bar chart for canvas:', canvasId);
            
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not loaded for quality metrics chart');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Basic quality metrics matching the legend
            const qualityMetrics = {
                'Brightness': resultData.quality?.brightness || 88,
                'Contrast': resultData.quality?.contrast || 94,
                'Skew': resultData.quality?.skew || 82,
                'Clarity': resultData.quality?.clarity || 91
            };
            
            const labels = Object.keys(qualityMetrics);
            const data = Object.values(qualityMetrics);
            
            // Colors matching the legend
            const gradients = labels.map((_, index) => {
                const gradient = ctx.createLinearGradient(0, 0, 400, 0);
                const colors = [
                    ['rgba(59, 130, 246, 0.9)', 'rgba(59, 130, 246, 0.6)'],   // Blue - Brightness
                    ['rgba(34, 197, 94, 0.9)', 'rgba(34, 197, 94, 0.6)'],     // Green - Contrast
                    ['rgba(168, 85, 247, 0.9)', 'rgba(168, 85, 247, 0.6)'],   // Purple - Skew
                    ['rgba(249, 115, 22, 0.9)', 'rgba(249, 115, 22, 0.6)']    // Orange - Clarity
                ];
                
                const colorPair = colors[index];
                gradient.addColorStop(0, colorPair[0]);
                gradient.addColorStop(1, colorPair[1]);
                return gradient;
            });
            
            // Border colors (solid versions matching legend)
            const borderColors = [
                'rgb(59, 130, 246)',   // Blue - Brightness
                'rgb(34, 197, 94)',    // Green - Contrast  
                'rgb(168, 85, 247)',   // Purple - Skew
                'rgb(249, 115, 22)'    // Orange - Clarity
            ];
            
            console.log('Quality metrics data:', qualityMetrics);
            
            try {
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Quality Score (%)',
                            data: data,
                            backgroundColor: gradients,
                            borderColor: borderColors,
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                            barThickness: 20,
                            maxBarThickness: 25,
                            hoverBackgroundColor: borderColors,
                            hoverBorderWidth: 3,
                            hoverBorderRadius: 10
                        }]
                    },
                    options: {
                        indexAxis: 'y', // Horizontal bars
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                left: 10,
                                right: 20,
                                top: 10,
                                bottom: 10
                            }
                        },
                        plugins: {
                            legend: {
                                display: false // Clean look without legend
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'rgba(99, 102, 241, 0.3)',
                                borderWidth: 2,
                                cornerRadius: 12,
                                padding: 16,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                bodyFont: {
                                    size: 13
                                },
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    title: function(context) {
                                        return context[0].label;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.x;
                                        let quality = '';
                                        if (value >= 95) quality = '🏆 Outstanding';
                                        else if (value >= 90) quality = '⭐ Excellent';
                                        else if (value >= 85) quality = '✅ Very Good';
                                        else if (value >= 80) quality = '👍 Good';
                                        else if (value >= 70) quality = '⚠️ Fair';
                                        else quality = '🔴 Needs Improvement';
                                        
                                        return `Score: ${value}% ${quality}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: 11,
                                        weight: 'medium'
                                    },
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Quality Score (%)',
                                    color: '#6B7280',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#374151',
                                    font: {
                                        size: 11,
                                        weight: 'bold'
                                    },
                                    padding: 10
                                }
                            }
                        },
                        animation: {
                            duration: 1800,
                            easing: 'easeInOutCubic',
                            delay: (context) => {
                                return context.dataIndex * 150; // Staggered animation
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'nearest'
                        },
                        elements: {
                            bar: {
                                borderJoinStyle: 'round'
                            }
                        }
                    },
                    plugins: [{
                        afterDatasetsDraw: function(chart) {
                            const ctx = chart.ctx;
                            
                            // Add percentage labels on bars
                            chart.data.datasets.forEach((dataset, datasetIndex) => {
                                const meta = chart.getDatasetMeta(datasetIndex);
                                
                                meta.data.forEach((bar, index) => {
                                    const value = dataset.data[index];
                                    
                                    ctx.save();
                                    ctx.fillStyle = '#374151';
                                    ctx.font = 'bold 11px system-ui, -apple-system, sans-serif';
                                    ctx.textAlign = 'left';
                                    ctx.textBaseline = 'middle';
                                    
                                    // Position text at the end of the bar
                                    const x = bar.x + 5;
                                    const y = bar.y;
                                    
                                    ctx.fillText(value + '%', x, y);
                                    ctx.restore();
                                });
                            });
                        }
                    }]
                });
                
                console.log('Premium horizontal bar chart created successfully:', chart);
                return chart;
                
            } catch (error) {
                console.error('Error creating horizontal bar chart:', error);
            }
        };

        console.log('Chart functions defined successfully!');
    </script>

    <!-- Global Components Script -->
    <script src="{{ url_for('static', filename='js/global-components.js') }}"></script>
    
    <!-- Professional Loader Controller -->
    <script>
        // Professional Loader Controller for Vue Integration
        class ProcessingLoader {
            constructor(container) {
                this.container = container;
                this.steps = container.querySelectorAll('.step-indicator');
                this.progressBar = container.querySelector('.h-full');
                this.currentStep = 0;
                this.totalSteps = this.steps.length;
            }
            
            updateStep(stepIndex) {
                if (stepIndex < 0 || stepIndex > this.totalSteps) return;
                
                this.currentStep = stepIndex;
                
                this.steps.forEach((step, index) => {
                    step.classList.remove('active', 'processing');
                    const stepNumber = step.querySelector('.step-number');
                    const statusIcon = step.querySelector('.step-status i');
                    
                    if (index < stepIndex) {
                        // Completed state
                        step.classList.add('active');
                        if (stepNumber && !stepNumber.querySelector('i.mdi-check')) {
                            stepNumber.innerHTML = '<i class="mdi mdi-check"></i>';
                        }
                        if (statusIcon) {
                            statusIcon.className = 'mdi mdi-check-circle text-green-500';
                        }
                    } else if (index === stepIndex) {
                        // Processing state
                        step.classList.add('processing');
                        if (stepNumber && !stepNumber.querySelector('i.mdi-loading')) {
                            stepNumber.innerHTML = '<i class="mdi mdi-loading"></i>';
                        }
                        if (statusIcon) {
                            statusIcon.className = 'mdi mdi-loading text-blue-500';
                        }
                    } else {
                        // Pending state
                        if (stepNumber && !stepNumber.querySelector('span')) {
                            stepNumber.innerHTML = `<span>${index + 1}</span>`;
                        }
                        if (statusIcon) {
                            statusIcon.className = 'mdi mdi-circle-outline text-gray-400';
                        }
                    }
                });
                
                // Update progress bar and data attribute
                const progress = Math.min(100, (stepIndex / this.totalSteps) * 100);
                if (this.progressBar) {
                    this.progressBar.style.width = `${progress}%`;
                }
                this.container.setAttribute('data-progress', `${Math.round(progress)}%`);
                
                // Update main icon animation
                const mainIcon = this.container.querySelector('.processing-brain-inner i');
                if (mainIcon && stepIndex === this.totalSteps) {
                    mainIcon.className = 'mdi mdi-check-decagram';
                }
            }
            
            complete() {
                this.steps.forEach((step) => {
                    step.classList.add('active');
                    step.classList.remove('processing');
                    const stepNumber = step.querySelector('.step-number');
                    const statusIcon = step.querySelector('.step-status i');
                    
                    if (stepNumber) {
                        stepNumber.innerHTML = '<i class="mdi mdi-check"></i>';
                    }
                    if (statusIcon) {
                        statusIcon.className = 'mdi mdi-check-circle text-green-500';
                    }
                });
                
                if (this.progressBar) {
                    this.progressBar.style.width = '100%';
                }
                this.container.setAttribute('data-progress', '100%');
                
                // Change main icon to success
                const mainIcon = this.container.querySelector('.processing-brain-inner i');
                if (mainIcon) {
                    mainIcon.className = 'mdi mdi-check-decagram';
                }
            }
            
            reset() {
                this.updateStep(0);
                const mainIcon = this.container.querySelector('.processing-brain-inner i');
                if (mainIcon) {
                    mainIcon.className = 'mdi mdi-file-document-check';
                }
            }
        }
        
        // Advanced Quality Metrics Chart - Sophisticated Radar/Multi-type Visualization
        window.createAdvancedQualityChart = function createAdvancedQualityChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Advanced chart canvas not found:', canvasId);
                return;
            }
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded for advanced quality chart');
                return;
            }
            
            console.log('Creating Advanced Quality Chart with real backend data:', resultData);
            
            const ctx = canvas.getContext('2d');
            
            // Extract real quality metrics from _rawResult.quality_analysis.average_metrics
            let brightness = 85, contrast = 90, sharpness = 95, textClarity = 88, overallReadability = 92;
            
            try {
                if (resultData._rawResult && resultData._rawResult.quality_analysis && resultData._rawResult.quality_analysis.average_metrics) {
                    const metrics = resultData._rawResult.quality_analysis.average_metrics;
                    
                    brightness = metrics.brightness_score ? metrics.brightness_score.percentage : 85;
                    contrast = metrics.contrast_score ? metrics.contrast_score.percentage : 90;
                    sharpness = metrics.sharpness_score ? metrics.sharpness_score.percentage : 95;
                    textClarity = metrics.text_clarity ? metrics.text_clarity.percentage : 88;
                    overallReadability = metrics.overall_readability ? metrics.overall_readability.percentage : 92;
                    
                    console.log('Extracted real quality metrics:', {
                        brightness, contrast, sharpness, textClarity, overallReadability
                    });
                } else {
                    console.log('Using fallback quality values - no real backend data found');
                }
            } catch (error) {
                console.error('Error extracting quality metrics:', error);
                console.log('Using fallback quality values due to extraction error');
            }
            
            try {
                // Create sophisticated mixed chart (Radar + Bar combination) with real data
                const chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Brightness', 'Contrast', 'Sharpness', 'Text Clarity', 'Overall Readability'],
                    datasets: [{
                        label: 'Quality Metrics',
                        data: [brightness, contrast, sharpness, textClarity, overallReadability],
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderColor: 'rgba(99, 102, 241, 0.8)',
                        pointBackgroundColor: [
                            'rgba(59, 130, 246, 0.8)',   // Blue for Brightness
                            'rgba(16, 185, 129, 0.8)',   // Emerald for Contrast  
                            'rgba(139, 92, 246, 0.8)',   // Purple for Sharpness
                            'rgba(245, 158, 11, 0.8)',   // Orange for Text Clarity
                            'rgba(99, 102, 241, 0.8)'    // Indigo for Overall Readability
                        ],
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        borderWidth: 3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false  // We have custom legend in the layout
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#374151',
                            bodyColor: '#6B7280',
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    return context[0].label;
                                },
                                label: function(context) {
                                    return `Score: ${context.parsed.r}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 20,
                                color: '#9CA3AF',
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(156, 163, 175, 0.2)',
                                lineWidth: 1
                            },
                            angleLines: {
                                color: 'rgba(156, 163, 175, 0.2)',
                                lineWidth: 1
                            },
                            pointLabels: {
                                font: {
                                    size: 11,
                                    weight: '500'
                                },
                                color: '#4B5563',
                                padding: 15
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutBounce'
                    },
                    interaction: {
                        intersect: false,
                        mode: 'point'
                    }
                }
            });
            
            return chart;
            
            } catch (error) {
                console.error('Error creating advanced quality chart:', error);
            }
        };
        
        // Initialize loader when processing starts
        document.addEventListener('DOMContentLoaded', function() {
            // Watch for loader element to be added to DOM by Vue
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.classList && node.classList.contains('processing-card')) {
                            // Initialize professional loader
                            window.documentLoader = new ProcessingLoader(node);
                            console.log('Professional loader initialized');
                        }
                    });
                });
            });
            
            // Start observing
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
    </script>

    <!-- Chart.js Library for Premium Quality Metrics Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <script>
        // Ensure Chart.js loaded event
        console.log('Chart.js library loaded, Chart available:', typeof Chart !== 'undefined');
        
        // Verify function availability after Chart.js loads
        window.addEventListener('load', function() {
            console.log('Advanced Quality Chart function available:', typeof window.createAdvancedQualityChart);
        });
    </script>
    
    <!-- Premium Quality Metrics Chart Implementation -->
    <script>
        // Global chart configurations for enterprise quality
        Chart.defaults.font.family = "'Inter', 'Segoe UI', system-ui, sans-serif";
        Chart.defaults.color = '#6B7280';
        Chart.defaults.borderColor = '#E5E7EB';
        Chart.defaults.backgroundColor = 'rgba(99, 102, 241, 0.1)';
        
        // Enhanced chart creation function (make it globally accessible)
        window.createQualityMetricsChart = function createQualityMetricsChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating chart for canvas:', canvasId);
            
            const ctx = canvas.getContext('2d');
            
            // Calculate dynamic metrics based on actual processing data
            const qualityScore = Math.round(resultData.complianceScore * 0.85) || 85;
            const processingSpeed = Math.round(100 / (resultData.processingTime || 1) * 5) || 75;
            const accuracyRate = resultData.confidence || 92;
            const efficiency = Math.round(resultData.complianceScore * 0.92) || 88;
            
            // Create gradient backgrounds
            const qualityGradient = ctx.createLinearGradient(0, 0, 0, 400);
            qualityGradient.addColorStop(0, 'rgba(16, 185, 129, 0.8)');
            qualityGradient.addColorStop(1, 'rgba(16, 185, 129, 0.1)');
            
            const speedGradient = ctx.createLinearGradient(0, 0, 0, 400);
            speedGradient.addColorStop(0, 'rgba(59, 130, 246, 0.8)');
            speedGradient.addColorStop(1, 'rgba(59, 130, 246, 0.1)');
            
            const accuracyGradient = ctx.createLinearGradient(0, 0, 0, 400);
            accuracyGradient.addColorStop(0, 'rgba(147, 51, 234, 0.8)');
            accuracyGradient.addColorStop(1, 'rgba(147, 51, 234, 0.1)');
            
            const efficiencyGradient = ctx.createLinearGradient(0, 0, 0, 400);
            efficiencyGradient.addColorStop(0, 'rgba(249, 115, 22, 0.8)');
            efficiencyGradient.addColorStop(1, 'rgba(249, 115, 22, 0.1)');
            
            // Simulate time-series data for real-time feel
            const timeLabels = [];
            const qualityData = [];
            const speedData = [];
            const accuracyData = [];
            const efficiencyData = [];
            
            // Generate 12 data points with smooth variations
            for (let i = 0; i < 12; i++) {
                timeLabels.push(`${String(9 + Math.floor(i / 2)).padStart(2, '0')}:${i % 2 === 0 ? '00' : '30'}`);
                
                // Create realistic fluctuations around base values
                const variance = 5;
                qualityData.push(Math.max(60, Math.min(100, qualityScore + (Math.random() - 0.5) * variance)));
                speedData.push(Math.max(50, Math.min(100, processingSpeed + (Math.random() - 0.5) * variance)));
                accuracyData.push(Math.max(70, Math.min(100, accuracyRate + (Math.random() - 0.5) * variance)));
                efficiencyData.push(Math.max(60, Math.min(100, efficiency + (Math.random() - 0.5) * variance)));
            }
            
            // Create the premium chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [
                        {
                            label: 'Quality Score',
                            data: qualityData,
                            borderColor: 'rgb(16, 185, 129)',
                            backgroundColor: qualityGradient,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgb(16, 185, 129)',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointHoverBackgroundColor: 'rgb(16, 185, 129)',
                            pointHoverBorderColor: 'white',
                            pointHoverBorderWidth: 3
                        },
                        {
                            label: 'Processing Speed',
                            data: speedData,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: speedGradient,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgb(59, 130, 246)',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointHoverBackgroundColor: 'rgb(59, 130, 246)',
                            pointHoverBorderColor: 'white',
                            pointHoverBorderWidth: 3
                        },
                        {
                            label: 'Accuracy Rate',
                            data: accuracyData,
                            borderColor: 'rgb(147, 51, 234)',
                            backgroundColor: accuracyGradient,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgb(147, 51, 234)',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointHoverBackgroundColor: 'rgb(147, 51, 234)',
                            pointHoverBorderColor: 'white',
                            pointHoverBorderWidth: 3
                        },
                        {
                            label: 'AI Efficiency',
                            data: efficiencyData,
                            borderColor: 'rgb(249, 115, 22)',
                            backgroundColor: efficiencyGradient,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgb(249, 115, 22)',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointHoverBackgroundColor: 'rgb(249, 115, 22)',
                            pointHoverBorderColor: 'white',
                            pointHoverBorderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // We have custom legend
                        },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.95)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(75, 85, 99, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 12,
                            padding: 16,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            displayColors: true,
                            usePointStyle: true,
                            callbacks: {
                                title: function(context) {
                                    return `Time: ${context[0].label}`;
                                },
                                label: function(context) {
                                    return `${context.dataset.label}: ${Math.round(context.parsed.y)}%`;
                                },
                                afterLabel: function(context) {
                                    const value = Math.round(context.parsed.y);
                                    if (value >= 90) return '🏆 Excellence';
                                    if (value >= 80) return '✅ Great';
                                    if (value >= 70) return '👍 Good';
                                    return '⚠️ Needs Attention';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(156, 163, 175, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6B7280',
                                font: {
                                    size: 11,
                                    weight: 'medium'
                                },
                                padding: 10
                            }
                        },
                        y: {
                            beginAtZero: false,
                            min: 50,
                            max: 100,
                            grid: {
                                color: 'rgba(156, 163, 175, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6B7280',
                                font: {
                                    size: 11,
                                    weight: 'medium'
                                },
                                padding: 15,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart',
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default') {
                                delay = context.dataIndex * 100;
                            }
                            return delay;
                        }
                    },
                    elements: {
                        point: {
                            hoverBackgroundColor: 'white',
                            hoverBorderWidth: 3
                        }
                    }
                }
            });
        }
        
        // Initialize charts when insights are expanded
        function initializeQualityCharts() {
            // Find all canvas elements for quality charts
            document.querySelectorAll('[id^="qualityChart-"]').forEach(canvas => {
                const index = canvas.id.split('-')[1];
                
                // Get result data from the global results array
                let resultData = {};
                
                // Try to get data from Vue app
                if (window.app && window.app.results && window.app.results[index]) {
                    resultData = window.app.results[index];
                } else if (window.results && window.results[index]) {
                    resultData = window.results[index];
                } else {
                    // Use default test data for demonstration
                    resultData = {
                        complianceScore: 85,
                        confidence: 92,
                        processingTime: 2.5,
                        documentType: 'Purchase Order'
                    };
                }
                
                console.log('Initializing chart for canvas:', canvas.id, 'with data:', resultData);
                createQualityMetricsChart(canvas.id, resultData);
            });
        }
        
        // Enhanced chart initialization with better error handling
        function createQualityMetricsChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating chart for canvas:', canvasId);
            
            const ctx = canvas.getContext('2d');
            
            // Ensure canvas has proper dimensions
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            
            // Calculate dynamic metrics based on actual processing data
            const qualityScore = Math.round((resultData.complianceScore || 85) * 0.85);
            const processingSpeed = Math.round(100 / (resultData.processingTime || 1) * 5);
            const accuracyRate = resultData.confidence || 92;
            const efficiency = Math.round((resultData.complianceScore || 85) * 0.92);
            
            console.log('Chart metrics:', { qualityScore, processingSpeed, accuracyRate, efficiency });
            
            // Create premium gradient backgrounds with rich colors
            const qualityGradient = ctx.createLinearGradient(0, 0, 0, 400);
            qualityGradient.addColorStop(0, 'rgba(6, 182, 212, 0.9)'); // Rich Cyan
            qualityGradient.addColorStop(1, 'rgba(6, 182, 212, 0.1)');
            
            const speedGradient = ctx.createLinearGradient(0, 0, 0, 400);
            speedGradient.addColorStop(0, 'rgba(139, 69, 19, 0.9)'); // Rich Brown/Bronze
            speedGradient.addColorStop(1, 'rgba(139, 69, 19, 0.1)');
            
            const accuracyGradient = ctx.createLinearGradient(0, 0, 0, 400);
            accuracyGradient.addColorStop(0, 'rgba(220, 38, 127, 0.9)'); // Rich Pink/Magenta
            accuracyGradient.addColorStop(1, 'rgba(220, 38, 127, 0.1)');
            
            const efficiencyGradient = ctx.createLinearGradient(0, 0, 0, 400);
            efficiencyGradient.addColorStop(0, 'rgba(101, 163, 13, 0.9)'); // Rich Lime Green
            efficiencyGradient.addColorStop(1, 'rgba(101, 163, 13, 0.1)');
            
            // Simulate time-series data for real-time feel
            const timeLabels = [];
            const qualityData = [];
            const speedData = [];
            const accuracyData = [];
            const efficiencyData = [];
            
            // Generate 12 data points with smooth variations
            for (let i = 0; i < 12; i++) {
                timeLabels.push(`${String(9 + Math.floor(i / 2)).padStart(2, '0')}:${i % 2 === 0 ? '00' : '30'}`);
                
                // Create realistic fluctuations around base values
                const variance = 5;
                qualityData.push(Math.max(60, Math.min(100, qualityScore + (Math.random() - 0.5) * variance)));
                speedData.push(Math.max(50, Math.min(100, processingSpeed + (Math.random() - 0.5) * variance)));
                accuracyData.push(Math.max(70, Math.min(100, accuracyRate + (Math.random() - 0.5) * variance)));
                efficiencyData.push(Math.max(60, Math.min(100, efficiency + (Math.random() - 0.5) * variance)));
            }
            
            // Check if Chart.js is available BEFORE trying to create chart
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not loaded yet, attempting to load...');
                
                // Clear canvas and show loading message
                ctx.clearRect(0, 0, canvas.width || 400, canvas.height || 300);
                ctx.fillStyle = '#f8fafc';
                ctx.fillRect(0, 0, canvas.width || 400, canvas.height || 300);
                ctx.fillStyle = '#1e293b';
                ctx.font = 'bold 18px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Loading Chart Library...', (canvas.width || 400)/2, (canvas.height || 300)/2 - 10);
                ctx.font = '14px Inter, sans-serif';
                ctx.fillStyle = '#64748b';
                ctx.fillText('Please wait...', (canvas.width || 400)/2, (canvas.height || 300)/2 + 15);
                
                // Try to load Chart.js dynamically with multiple CDNs
                const loadChartJS = () => {
                    return new Promise((resolve, reject) => {
                        if (typeof Chart !== 'undefined') {
                            resolve();
                            return;
                        }
                        
                        const cdnUrls = [
                            'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js',
                            'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js',
                            'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js',
                            'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js'
                        ];
                        
                        let currentCdn = 0;
                        
                        const tryLoadScript = () => {
                            if (currentCdn >= cdnUrls.length) {
                                reject(new Error('All CDNs failed'));
                                return;
                            }
                            
                            const script = document.createElement('script');
                            script.src = cdnUrls[currentCdn];
                            console.log(`Trying to load Chart.js from: ${cdnUrls[currentCdn]}`);
                            
                            script.onload = () => {
                                console.log(`Chart.js loaded successfully from: ${cdnUrls[currentCdn]}`);
                                // Wait a bit for Chart to be available globally
                                setTimeout(() => {
                                    if (typeof Chart !== 'undefined') {
                                        resolve();
                                    } else {
                                        console.log('Chart object not available after script load, trying next CDN...');
                                        currentCdn++;
                                        tryLoadScript();
                                    }
                                }, 200);
                            };
                            
                            script.onerror = () => {
                                console.log(`Failed to load from: ${cdnUrls[currentCdn]}, trying next...`);
                                currentCdn++;
                                tryLoadScript();
                            };
                            
                            document.head.appendChild(script);
                        };
                        
                        tryLoadScript();
                    });
                };
                
                // Load Chart.js and then create the chart
                loadChartJS().then(() => {
                    console.log('Chart.js now available, creating chart...');
                    setTimeout(() => {
                        // Clear the loading message first
                        ctx.clearRect(0, 0, canvas.width || 400, canvas.height || 300);
                        createQualityMetricsChart(canvasId, resultData);
                    }, 100);
                }).catch(error => {
                    console.error('Chart.js failed to load:', error);
                    
                    // Clear canvas and show error message
                    ctx.clearRect(0, 0, canvas.width || 400, canvas.height || 300);
                    ctx.fillStyle = '#fef2f2';
                    ctx.fillRect(0, 0, canvas.width || 400, canvas.height || 300);
                    ctx.fillStyle = '#dc2626';
                    ctx.font = 'bold 16px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('Chart Library Unavailable', (canvas.width || 400)/2, (canvas.height || 300)/2 - 10);
                    ctx.font = '12px Inter, sans-serif';
                    ctx.fillStyle = '#991b1b';
                    ctx.fillText('Please check your internet connection', (canvas.width || 400)/2, (canvas.height || 300)/2 + 15);
                });
                
                return;
            }
            
            // Create the premium chart
            try {
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeLabels,
                        datasets: [
                            {
                                label: 'Quality Score',
                                data: qualityData,
                                borderColor: 'rgb(6, 182, 212)', // Rich Cyan
                                backgroundColor: qualityGradient,
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgb(6, 182, 212)',
                                pointBorderColor: 'white',
                                pointBorderWidth: 3,
                                pointRadius: 7,
                                pointHoverRadius: 9,
                                pointHoverBackgroundColor: 'rgb(6, 182, 212)',
                                pointHoverBorderColor: 'white',
                                pointHoverBorderWidth: 4,
                                shadowColor: 'rgba(6, 182, 212, 0.3)',
                                shadowBlur: 10
                            },
                            {
                                label: 'Processing Speed',
                                data: speedData,
                                borderColor: 'rgb(139, 69, 19)', // Rich Brown/Bronze
                                backgroundColor: speedGradient,
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgb(139, 69, 19)',
                                pointBorderColor: 'white',
                                pointBorderWidth: 3,
                                pointRadius: 7,
                                pointHoverRadius: 9,
                                pointHoverBackgroundColor: 'rgb(139, 69, 19)',
                                pointHoverBorderColor: 'white',
                                pointHoverBorderWidth: 4,
                                shadowColor: 'rgba(139, 69, 19, 0.3)',
                                shadowBlur: 10
                            },
                            {
                                label: 'Accuracy Rate',
                                data: accuracyData,
                                borderColor: 'rgb(220, 38, 127)', // Rich Pink/Magenta
                                backgroundColor: accuracyGradient,
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgb(220, 38, 127)',
                                pointBorderColor: 'white',
                                pointBorderWidth: 3,
                                pointRadius: 7,
                                pointHoverRadius: 9,
                                pointHoverBackgroundColor: 'rgb(220, 38, 127)',
                                pointHoverBorderColor: 'white',
                                pointHoverBorderWidth: 4,
                                shadowColor: 'rgba(220, 38, 127, 0.3)',
                                shadowBlur: 10
                            },
                            {
                                label: 'AI Efficiency',
                                data: efficiencyData,
                                borderColor: 'rgb(101, 163, 13)', // Rich Lime Green
                                backgroundColor: efficiencyGradient,
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgb(101, 163, 13)',
                                pointBorderColor: 'white',
                                pointBorderWidth: 3,
                                pointRadius: 7,
                                pointHoverRadius: 9,
                                pointHoverBackgroundColor: 'rgb(101, 163, 13)',
                                pointHoverBorderColor: 'white',
                                pointHoverBorderWidth: 4,
                                shadowColor: 'rgba(101, 163, 13, 0.3)',
                                shadowBlur: 10
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false // We have custom legend
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: 'rgba(75, 85, 99, 0.3)',
                                borderWidth: 1,
                                cornerRadius: 12,
                                padding: 16,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                bodyFont: {
                                    size: 13
                                },
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    title: function(context) {
                                        return `Time: ${context[0].label}`;
                                    },
                                    label: function(context) {
                                        return `${context.dataset.label}: ${Math.round(context.parsed.y)}%`;
                                    },
                                    afterLabel: function(context) {
                                        const value = Math.round(context.parsed.y);
                                        if (value >= 90) return '🏆 Excellence';
                                        if (value >= 80) return '✅ Great';
                                        if (value >= 70) return '👍 Good';
                                        return '⚠️ Needs Attention';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.1)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: 11,
                                        weight: 'medium'
                                    },
                                    padding: 10
                                }
                            },
                            y: {
                                beginAtZero: false,
                                min: 50,
                                max: 100,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.1)',
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: {
                                        size: 11,
                                        weight: 'medium'
                                    },
                                    padding: 15,
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart',
                            delay: (context) => {
                                let delay = 0;
                                if (context.type === 'data' && context.mode === 'default') {
                                    delay = context.dataIndex * 100;
                                }
                                return delay;
                            }
                        },
                        elements: {
                            point: {
                                hoverBackgroundColor: 'white',
                                hoverBorderWidth: 3
                            }
                        }
                    }
                });
                
                console.log('Chart created successfully:', chart);
                return chart;
                
            } catch (error) {
                console.error('Error creating chart:', error);
            }
        }
        
        // Quality Metrics Radar Chart Creation Function - Premium & Elegant
        window.createQualityMetricsBarChart = function createQualityMetricsBarChart(canvasId, resultData) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Quality metrics canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating premium quality metrics radar chart for canvas:', canvasId);
            
            // Check if Chart.js is available
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not loaded for quality metrics chart');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Comprehensive quality metrics data (from quality analysis response or sophisticated defaults)
            const qualityMetrics = {
                brightness: resultData.quality?.brightness || 88,
                contrast: resultData.quality?.contrast || 94,
                skew: resultData.quality?.skew || 82,
                clarity: resultData.quality?.clarity || 91,
                sharpness: resultData.quality?.sharpness || 87,
                noise: resultData.quality?.noise || 89,
                resolution: resultData.quality?.resolution || 95,
                textLegibility: resultData.quality?.textLegibility || 93,
                colorBalance: resultData.quality?.colorBalance || 86,
                documentOrientation: resultData.quality?.documentOrientation || 98
            };
            
            console.log('Premium quality metrics data:', qualityMetrics);
            
            // Create premium gradient for the radar chart
            const gradient = ctx.createRadialGradient(150, 150, 0, 150, 150, 150);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
            gradient.addColorStop(0.5, 'rgba(139, 92, 246, 0.3)');
            gradient.addColorStop(1, 'rgba(168, 85, 247, 0.1)');
            
            // Create the premium radar chart
            try {
                const chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [
                            'Brightness', 'Contrast', 'Skew Correction', 'Clarity',
                            'Sharpness', 'Noise Reduction', 'Resolution', 'Text Legibility',
                            'Color Balance', 'Orientation'
                        ],
                        datasets: [
                            {
                                label: 'Quality Assessment',
                                data: [
                                    qualityMetrics.brightness,
                                    qualityMetrics.contrast,
                                    qualityMetrics.skew,
                                    qualityMetrics.clarity,
                                    qualityMetrics.sharpness,
                                    qualityMetrics.noise,
                                    qualityMetrics.resolution,
                                    qualityMetrics.textLegibility,
                                    qualityMetrics.colorBalance,
                                    qualityMetrics.documentOrientation
                                ],
                                backgroundColor: gradient,
                                borderColor: 'rgba(99, 102, 241, 0.8)',
                                borderWidth: 3,
                                pointBackgroundColor: [
                                    '#3B82F6', '#10B981', '#8B5CF6', '#F59E0B',
                                    '#EF4444', '#06B6D4', '#84CC16', '#F97316',
                                    '#EC4899', '#6366F1'
                                ],
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointHoverBackgroundColor: '#ffffff',
                                pointHoverBorderWidth: 4,
                                fill: true,
                                tension: 0.1
                            },
                            {
                                label: 'Industry Standard',
                                data: [85, 85, 85, 85, 85, 85, 85, 85, 85, 85],
                                backgroundColor: 'rgba(156, 163, 175, 0.1)',
                                borderColor: 'rgba(156, 163, 175, 0.5)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                align: 'center',
                                labels: {
                                    color: '#374151',
                                    font: {
                                        size: 11,
                                        weight: 'bold'
                                    },
                                    padding: 15,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'rgba(99, 102, 241, 0.3)',
                                borderWidth: 2,
                                cornerRadius: 12,
                                padding: 16,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                bodyFont: {
                                    size: 13
                                },
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    title: function(context) {
                                        return `${context[0].label}`;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.r;
                                        let quality = '';
                                        if (value >= 95) quality = '🏆 Outstanding';
                                        else if (value >= 90) quality = '⭐ Excellent';
                                        else if (value >= 85) quality = '✅ Very Good';
                                        else if (value >= 80) quality = '👍 Good';
                                        else if (value >= 70) quality = '⚠️ Fair';
                                        else quality = '🔴 Needs Improvement';
                                        
                                        return `Score: ${value}% ${quality}`;
                                    },
                                    afterBody: function(context) {
                                        const value = context[0].parsed.r;
                                        if (value >= 90) {
                                            return '\n✨ Premium quality detected';
                                        } else if (value >= 80) {
                                            return '\n📊 Above industry standard';
                                        } else {
                                            return '\n� Room for optimization';
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    color: '#9CA3AF',
                                    font: {
                                        size: 10,
                                        weight: 'medium'
                                    },
                                    backdropColor: 'transparent',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    lineWidth: 1
                                },
                                pointLabels: {
                                    color: '#374151',
                                    font: {
                                        size: 10,
                                        weight: 'bold'
                                    },
                                    padding: 8
                                },
                                angleLines: {
                                    color: 'rgba(156, 163, 175, 0.3)',
                                    lineWidth: 1
                                }
                            }
                        },
                        animation: {
                            duration: 2500,
                            easing: 'easeInOutCubic',
                            animateRotate: true,
                            animateScale: true
                        },
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        },
                        elements: {
                            point: {
                                hoverBackgroundColor: '#ffffff',
                                hoverBorderWidth: 4
                            }
                        }
                    }
                });
                
                console.log('Premium quality metrics radar chart created successfully:', chart);
                return chart;
                
            } catch (error) {
                console.error('Error creating premium quality metrics chart:', error);
            }
        }
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Quality metrics canvas not found:', canvasId);
                return;
            }
            
            console.log('Creating premium quality metrics radar chart for canvas:', canvasId);
            
            // Check if Chart.js is available
            if (typeof Chart === 'undefined') {
                console.log('Chart.js not loaded for quality metrics chart');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Comprehensive quality metrics data (from quality analysis response or sophisticated defaults)
            const qualityMetrics = {
                brightness: resultData.quality?.brightness || 88,
                contrast: resultData.quality?.contrast || 94,
                skew: resultData.quality?.skew || 82,
                clarity: resultData.quality?.clarity || 91,
                sharpness: resultData.quality?.sharpness || 87,
                noise: resultData.quality?.noise || 89,
                resolution: resultData.quality?.resolution || 95,
                textLegibility: resultData.quality?.textLegibility || 93,
                colorBalance: resultData.quality?.colorBalance || 86,
                documentOrientation: resultData.quality?.documentOrientation || 98
            };
            
            console.log('Premium quality metrics data:', qualityMetrics);
            
            // Create premium gradient for the radar chart
            const gradient = ctx.createRadialGradient(150, 150, 0, 150, 150, 150);
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
            gradient.addColorStop(0.5, 'rgba(139, 92, 246, 0.3)');
            gradient.addColorStop(1, 'rgba(168, 85, 247, 0.1)');
            
            // Create the premium radar chart
            try {
                const chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [
                            'Brightness', 'Contrast', 'Skew Correction', 'Clarity',
                            'Sharpness', 'Noise Reduction', 'Resolution', 'Text Legibility',
                            'Color Balance', 'Orientation'
                        ],
                        datasets: [
                            {
                                label: 'Quality Assessment',
                                data: [
                                    qualityMetrics.brightness,
                                    qualityMetrics.contrast,
                                    qualityMetrics.skew,
                                    qualityMetrics.clarity,
                                    qualityMetrics.sharpness,
                                    qualityMetrics.noise,
                                    qualityMetrics.resolution,
                                    qualityMetrics.textLegibility,
                                    qualityMetrics.colorBalance,
                                    qualityMetrics.documentOrientation
                                ],
                                backgroundColor: gradient,
                                borderColor: 'rgba(99, 102, 241, 0.8)',
                                borderWidth: 3,
                                pointBackgroundColor: [
                                    '#3B82F6', '#10B981', '#8B5CF6', '#F59E0B',
                                    '#EF4444', '#06B6D4', '#84CC16', '#F97316',
                                    '#EC4899', '#6366F1'
                                ],
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointHoverBackgroundColor: '#ffffff',
                                pointHoverBorderWidth: 4,
                                fill: true,
                                tension: 0.1
                            },
                            {
                                label: 'Industry Standard',
                                data: [85, 85, 85, 85, 85, 85, 85, 85, 85, 85],
                                backgroundColor: 'rgba(156, 163, 175, 0.1)',
                                borderColor: 'rgba(156, 163, 175, 0.5)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                align: 'center',
                                labels: {
                                    color: '#374151',
                                    font: {
                                        size: 11,
                                        weight: 'bold'
                                    },
                                    padding: 15,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: 'rgba(99, 102, 241, 0.3)',
                                borderWidth: 2,
                                cornerRadius: 12,
                                padding: 16,
                                titleFont: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                bodyFont: {
                                    size: 13
                                },
                                displayColors: true,
                                usePointStyle: true,
                                callbacks: {
                                    title: function(context) {
                                        return `${context[0].label}`;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.r;
                                        let quality = '';
                                        if (value >= 95) quality = '🏆 Outstanding';
                                        else if (value >= 90) quality = '⭐ Excellent';
                                        else if (value >= 85) quality = '✅ Very Good';
                                        else if (value >= 80) quality = '👍 Good';
                                        else if (value >= 70) quality = '⚠️ Fair';
                                        else quality = '🔴 Needs Improvement';
                                        
                                        return `Score: ${value}% ${quality}`;
                                    },
                                    afterBody: function(context) {
                                        const value = context[0].parsed.r;
                                        if (value >= 90) {
                                            return '\n✨ Premium quality detected';
                                        } else if (value >= 80) {
                                            return '\n📊 Above industry standard';
                                        } else {
                                            return '\n💡 Room for optimization';
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 20,
                                    color: '#9CA3AF',
                                    font: {
                                        size: 10,
                                        weight: 'medium'
                                    },
                                    backdropColor: 'transparent',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    lineWidth: 1
                                },
                                pointLabels: {
                                    color: '#374151',
                                    font: {
                                        size: 10,
                                        weight: 'bold'
                                    },
                                    padding: 8
                                },
                                angleLines: {
                                    color: 'rgba(156, 163, 175, 0.3)',
                                    lineWidth: 1
                                }
                            }
                        },
                        animation: {
                            duration: 2500,
                            easing: 'easeInOutCubic',
                            animateRotate: true,
                            animateScale: true
                        },
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        },
                        elements: {
                            point: {
                                hoverBackgroundColor: '#ffffff',
                                hoverBorderWidth: 4
                            }
                        }
                    }
                });
                
                console.log('Premium quality metrics radar chart created successfully:', chart);
                return chart;
                
            } catch (error) {
                console.error('Error creating premium quality metrics chart:', error);
            }
        };
        
        // Auto-initialize charts when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up chart initialization...');
            
            // Wait for Vue to render then initialize charts
            setTimeout(() => {
                console.log('Attempting to initialize charts...');
                initializeQualityCharts();
            }, 2000);
            

            
            // Watch for new chart containers
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.tagName === 'CANVAS' && (node.id.startsWith('qualityChart-') || node.id.startsWith('advancedQualityChart-'))) {
                            console.log('New chart canvas detected:', node.id);
                            const index = node.id.split('-')[1];
                            
                            // Get data from various possible sources
                            let resultData = {
                                complianceScore: 85,
                                confidence: 92,
                                processingTime: 2.5,
                                documentType: 'Purchase Order'
                            };
                            
                            setTimeout(() => {
                                if (node.id.startsWith('advancedQualityChart-')) {
                                    if (window.createAdvancedQualityChart) {
                                        window.createAdvancedQualityChart(node.id, resultData);
                                    }
                                } else if (node.id.startsWith('qualityChart-')) {
                                    if (window.createQualityMetricsChart) {
                                        window.createQualityMetricsChart(node.id, resultData);
                                    }
                                }
                            }, 500);
                        }
                    });
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
    </script>

    <!-- WebSocket Progress Loader Container -->
    <div id="progress-loader-container"></div>

</body>
</html>