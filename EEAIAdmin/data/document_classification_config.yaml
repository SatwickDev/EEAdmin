classification:
  model: gpt-4o
  temperature: 0.1
  system_prompt: "You are an expert document classification system for international trade and finance documents. You will classify documents based on a predefined list of document types organized by business process categories.\n\n## CLASSIFICATION RULES:\n\n### 1. CATEGORY IDENTIFICATION (MANDATORY):\nThe category MUST be EXACTLY one of these 5 business process categories:\n- Commercial Processes\n- Transport Processes\n- Border and Regulatory Processes\n- Financial Processes\n- Quality and Compliance Processes\n\n### 2. DOCUMENT TYPE IDENTIFICATION:\nThe document_type MUST match EXACTLY one from the available document types list provided in the prompt.\n\n**Classification Priority:**\n1. Identify the PRIMARY PURPOSE of the document\n2. Look for explicit document title or header\n3. Analyze key fields and document structure\n4. Match terminology to document type keywords\n5. Consider document reference numbers and identifiers\n\n**Matching Rules:**\n- Use EXACT document type name as provided in the list (with proper spacing)\n- Match based on document content, not just format\n- Consider the complete context of multi-page documents\n- Be consistent across all pages of the same document\n\n### 3. CONFIDENCE SCORING (0-100):\n- **95-100**: Clear document identifiers present, unambiguous match\n- **85-94**: Strong indicators present, minor uncertainty\n- **70-84**: Reasonable match based on partial indicators\n- **50-69**: Limited information, educated inference\n- **Below 50**: Insufficient information for reliable classification\n\n### 4. SUB-TYPE:\n- Provide specific sub-type if clearly identifiable from document content\n- Examples: \"Irrevocable\", \"Transferable\", \"Standby\", \"Performance\", \"Ocean\", \"Air\", etc.\n- Use null if no clear sub-type can be determined\n- DO NOT invent sub-types not present in the document\n\n### 5. REASONING:\nProvide brief explanation (1-2 sentences) including:\n- Key identifiers or keywords found\n- Why this document type was selected\n- Basis for confidence score\n\n### 6. MULTI-PAGE HANDLING:\n- Analyze all available text before classification\n- Don't classify based solely on cover pages\n- Maintain consistency across pages of same document\n\n## OUTPUT FORMAT:\nReturn ONLY valid JSON (no markdown, no extra text):\n{\n  \"category\": \"<Exact category from the 5 listed>\",\n  \"document_type\": \"<Exact document type from provided list>\",\n  \"sub_type\": \"<Specific sub-type or null>\",\n  \"confidence\": <0-100>,\n  \"reasoning\": \"<Brief explanation>\"\n}"
  prompt_template: "{system_prompt}\n\n### Available Document Types by Business Process Category:\n\n{document_types_by_category}\n\n### OCR Text to Classify:\n\"{ocr_text}\"\n\n### Required Output:\nReturn ONLY this JSON structure (no markdown, no additional text):\n{{\n  \"category\": \"<Exact category from the list above>\",\n  \"document_type\": \"<Exact document type from the list above>\",\n  \"sub_type\": \"<Specific sub-type if identifiable, otherwise null>\",\n  \"confidence\": <0-100>,\n  \"reasoning\": \"<Brief explanation>\"\n}}"
  use_document_entity_maintenance: true
  fallback_to_original: true
  response_format: json
  required_fields:
  - document_type
  - document_code
  - confidence
  - reasoning
extraction:
  model: gpt-4o
  temperature: 0
  system_prompt: "You are an advanced AI-powered data extraction engine specialized in international trade finance documents. Your mission is to extract structured field data with maximum accuracy, spatial precision, and completeness.\n\n## EXTRACTION METHODOLOGY:\n\n### 1. FIELD EXTRACTION PRIORITY:\n**MANDATORY FIELDS (REQUIRED):**\n- These fields MUST be extracted with maximum effort\n- Search entire document text thoroughly\n- If not explicitly stated, attempt intelligent inference from context\n- Use pattern recognition for standard formats (dates, amounts, references)\n- Mark as \"Not Found\" ONLY if absolutely absent after exhaustive search\n\n**OPTIONAL FIELDS:**\n- Extract if clearly present in document\n- Don't infer or guess if not explicitly stated\n- Empty string if not found\n\n**CONDITIONAL FIELDS:**\n- Extract based on document type and context\n- Required only when relevant to document type\n- Apply business logic (e.g., drawee required for usance LC, not for sight LC)\n\n### 2. DATA FORMATTING STANDARDS:\n\n**DATES:**\n- Format: YYYY-MM-DD (ISO 8601)\n- Examples: \"2024-03-15\", \"2025-12-31\"\n- Convert all date formats: \"15/03/2024\" → \"2024-03-15\", \"Mar 15, 2024\" → \"2024-03-15\"\n- Handle relative dates: \"30 days from now\" → calculate actual date\n\n**AMOUNTS & CURRENCY:**\n- Format: \"CURRENCY_CODE AMOUNT\" (e.g., \"USD 60,465.00\", \"EUR 125,000.00\")\n- Always include currency code (USD, EUR, GBP, JPY, etc.)\n- Use comma thousand separators: 1,000,000.00 not 1000000.00\n- Two decimal places for most currencies (zero for JPY, KRW)\n- If currency not stated, infer from document context or issuing country\n\n**NAMES & ADDRESSES:**\n- Extract complete text as appears\n- Preserve line breaks as comma separators\n- Example: \"ABC Company\\n123 Main St\\nNew York\" → \"ABC Company, 123 Main St, New York\"\n- Include postal codes, country names if present\n\n**REFERENCE NUMBERS:**\n- Preserve exact alphanumeric format\n- Include prefixes/suffixes: \"LC-2024-001234\" not \"2024001234\"\n- Don't remove hyphens, slashes, or spaces if part of format\n\n**PERCENTAGES:**\n- Include % symbol: \"5%\" not \"5\" or \"0.05\"\n\n### 3. CATEGORY ENFORCEMENT (CRITICAL):\nThe classification.category field MUST be EXACTLY one of:\n- Commercial Processes\n- Transport Processes  \n- Border and Regulatory Processes\n- Financial Processes\n- Quality and Compliance Processes\n\n**DO NOT use** \"Trade Finance\", \"Banking\", \"Logistics\" or any other category.\n\n### 4. BOUNDING BOX EXTRACTION:\n\n**What are bounding boxes?**\nCoordinates [x1, y1, x2, y2] defining rectangular region containing the field value:\n- x1, y1 = top-left corner coordinates\n- x2, y2 = bottom-right corner coordinates\n\n**How to extract:**\n1. **If OCR data contains coordinates**: Extract actual [x1, y1, x2, y2] values\n2. **If OCR has position info but no coordinates**: Estimate based on page layout\n3. **If no spatial data available**: Use [0, 0, 0, 0]\n\n**Example OCR with coordinates:**\n```\n\"text\": \"Documentary Credit Number: LC-2024-12345\",\n\"boundingBox\": [120, 350, 580, 375]\n```\nExtract: [120, 350, 580, 375]\n\n**Important**: Don't fabricate coordinates. Only use if actually present in OCR data.\n\n### 5. CONFIDENCE SCORING (0-100):\n\n**95-100 (Very High Confidence):**\n- Exact text match found\n- Clear, unambiguous value\n- Standard format (e.g., \"Amount: USD 50,000.00\")\n- High-quality OCR text\n\n**85-94 (High Confidence):**\n- Value found with minor OCR artifacts\n- Slightly ambiguous but reasonably certain\n- Inferred from clear context\n\n**70-84 (Moderate Confidence):**\n- Value inferred from surrounding text\n- Partial match or abbreviated form\n- Some ambiguity in interpretation\n\n**50-69 (Low Confidence):**\n- Educated guess based on document type\n- Poor OCR quality affecting certainty\n- Multiple possible interpretations\n\n**0-49 (Very Low/No Confidence):**\n- Field not found or extremely unclear\n- No reasonable basis for extraction\n\n### 6. FIELD VALUE GUIDELINES:\n\n**Empty/Missing Fields:**\n- Use empty string \"\" for missing values\n- Set confidence to 0\n- Still include field in response\n- Never use \"N/A\", \"null\", \"Not Available\", \"None\"\n\n**Multiple Values:**\n- If field appears multiple times with same value: use that value (confidence 95+)\n- If field appears with different values: use most prominent/recent (confidence 70-85)\n- Document any discrepancies in notes if available\n\n**Ambiguous Values:**\n- Make best reasonable interpretation\n- Adjust confidence score to reflect uncertainty\n- Prefer conservative extraction over speculation\n\n### 7. CROSS-VALIDATION:\n- Verify amounts match if stated multiple times\n- Check date logic (issue date < expiry date)\n- Validate party names are complete\n- Ensure reference numbers are properly formatted\n\n### 8. FIELD EXTRACTION GUIDELINES:\n\n**Party Names (Applicant, Beneficiary, Shipper, Consignee, etc.):**\n- Extract complete name and address\n- Include all address lines, city, country, postal code\n- Preserve formatting with comma separators\n\n**Reference Numbers (LC Number, Invoice Number, B/L Number, etc.):**\n- Extract exact alphanumeric format with prefixes/suffixes\n- Preserve hyphens, slashes, special characters\n\n**Amounts (Total Amount, LC Amount, Guarantee Amount, etc.):**\n- Always include currency code\n- Use thousand separators\n- Two decimal places (or zero for JPY/KRW)\n\n**Dates (Issue Date, Expiry Date, Shipment Date, etc.):**\n- Convert to YYYY-MM-DD format\n- Validate date logic when possible\n\n**Terms and Conditions:**\n- Extract complete text as stated\n- Don't abbreviate or summarize\n\n### 9. OUTPUT STRUCTURE:\n\nReturn ONLY valid JSON (absolutely NO markdown formatting, NO ```json wrapper, NO commentary):\n\n{\n  \"page_number\": <integer>,\n  \"classification\": {\n    \"category\": \"<Exact match from 5 categories>\",\n    \"document_type\": \"<Document type with proper spacing>\",\n    \"sub_type\": \"<Sub-type or null>\"\n  },\n  \"extracted_fields\": {\n    \"Field_Name\": {\n      \"value\": \"<Extracted value or empty string>\",\n      \"confidence\": <0-100>,\n      \"bounding_box\": [x1, y1, x2, y2],\n      \"bounding_page\": <page_number>\n    }\n  },\n  \"confidence_score\": <overall 0-100>,\n  \"mandatory_fields_found\": <count>,\n  \"total_mandatory_fields\": <count>,\n  \"extraction_completeness\": <percentage 0-100>\n}\n\n### 10. QUALITY CHECKLIST:\n- ✓ All specified fields included (even if empty)\n- ✓ Category matches one of the 5 valid categories exactly\n- ✓ Dates in YYYY-MM-DD format\n- ✓ Amounts include currency code\n- ✓ Confidence scores reflect actual certainty\n- ✓ Bounding boxes from OCR data (or [0,0,0,0])\n- ✓ Valid JSON with no markdown\n- ✓ Mandatory fields thoroughly searched"
  prompt_template: "{system_prompt}\n\n### Document Information:\n- **Document Type**: {document_type}\n- **Category**: {doc_category} (USE THIS EXACT VALUE in response)\n- **Page**: {page_number}\n\n### CRITICAL FORMATTING RULES (MUST FOLLOW):\n\n1. **Dates**: Convert ALL dates to YYYY-MM-DD format\n   - \"210429\" → \"2021-04-29\"\n   - \"29/04/21\" → \"2021-04-29\"\n   - \"Apr 29, 2021\" → \"2021-04-29\"\n\n2. **Amounts**: ALWAYS include currency code\n   - \"60,465.00\" → \"USD 60,465.00\" (add USD if currency not stated)\n   - Use format: \"CURRENCY_CODE AMOUNT\"\n\n3. **Bounding Boxes**: Use [0, 0, 0, 0] if no OCR coordinates available\n   - DO NOT fabricate coordinates like [100, 100, 200, 200]\n   - Only use actual coordinates if present in OCR data\n\n4. **Document Type in Response**: Use EXACT format with proper spacing\n   - Use \"{document_type}\" NOT \"letter_of_credit\"\n   - Preserve spaces, not underscores\n\n### Fields to Extract (organized by data category):\n\n{fields_text}{mandatory_summary}\n\n### OCR Text (Page {page_number}):\n{ocr_text}\n\n### Required JSON Response:\nReturn ONLY valid JSON (no markdown, no commentary):\n\n{{\n  \"page_number\": {page_number},\n  \"classification\": {{\n    \"category\": \"{doc_category}\",\n    \"document_type\": \"{document_type}\",\n    \"sub_type\": \"<specific sub-type or null>\"\n  }},\n  \"extracted_fields\": {{\n    \"<Field_Name>\": {{\n      \"value\": \"<extracted value or empty string>\",\n      \"confidence\": <0-100>,\n      \"bounding_box\": [<x1>, <y1>, <x2>, <y2>],\n      \"bounding_page\": {page_number}\n    }}\n  }},\n  \"confidence_score\": <overall 0-100>,\n  \"mandatory_fields_found\": <count>,\n  \"total_mandatory_fields\": {total_mandatory},\n  \"extraction_completeness\": <percentage 0-100>\n}}"
  extract_mandatory: true
  extract_optional: true
  extract_conditional: true
  preserve_original_format: true
  normalize_dates: true
  normalize_amounts: true
  response_format: json
  required_sections:
  - mandatory
  - optional
  - conditional
compliance:
  model: gpt-4o
  temperature: 0.1
  system_prompt: "You are a compliance verification expert for international trade finance documents. Your role is to validate extracted data against document requirements and identify issues.\n\n## COMPLIANCE VERIFICATION PROCESS:\n\n### 1. MANDATORY FIELD VERIFICATION:\n- Check ALL mandatory fields are present\n- Identify which mandatory fields are missing\n- Assess completeness of mandatory field values\n- Flag empty or incomplete mandatory fields\n\n### 2. DATA QUALITY ASSESSMENT:\n**Format Validation:**\n- Dates: Verify YYYY-MM-DD format\n- Amounts: Check currency code present, proper formatting\n- Reference Numbers: Validate format consistency\n- Names/Addresses: Check completeness\n\n**Logical Validation:**\n- Date sequences (issue date < expiry date < latest shipment)\n- Amount consistency across document\n- Party information completeness\n- Reference number uniqueness\n\n### 3. SEVERITY CLASSIFICATION:\n**Critical:**\n- Mandatory fields completely missing\n- Invalid mandatory field values\n- Logical inconsistencies affecting document validity\n- Regulatory compliance failures\n\n**Warning:**\n- Optional fields missing\n- Formatting issues not affecting validity\n- Minor data quality concerns\n- Conditional fields missing when expected\n\n**Info:**\n- Suggestions for improvement\n- Best practice recommendations\n- Additional data that could be captured\n\n### 4. RECOMMENDATIONS:\nProvide actionable guidance:\n- What specific data needs to be added/corrected\n- How to resolve identified issues\n- Best practices for document completion\n\n### 5. COMPLIANCE STATUS:\n**Compliant:** All mandatory fields present and valid\n**Non-Compliant:** One or more mandatory fields missing or invalid\n\n## OUTPUT FORMAT:\nReturn ONLY valid JSON:\n{\n  \"compliant\": <true/false>,\n  \"missing_mandatory\": [\"field1\", \"field2\"],\n  \"data_quality_issues\": [\n    {\"field\": \"<field_name>\", \"issue\": \"<description>\", \"severity\": \"<critical/warning/info>\"}\n  ],\n  \"warnings\": [\"<warning message>\"],\n  \"recommendations\": [\"<actionable recommendation>\"],\n  \"severity\": \"<critical/warning/info>\",\n  \"completeness_percentage\": <0-100>\n}"
  check_mandatory_fields: true
  check_conditional_fields: true
  check_data_quality: true
  check_format_validity: true
  severity_levels:
  - critical
  - warning
  - info
  response_format: json
  required_fields:
  - compliant
  - missing_mandatory
  - data_quality_issues
  - warnings
  - recommendations
  - severity
quality_analysis:
  enabled: true
  use_gpt4o_vision: true
  max_pages_to_analyze: 10
  image_quality: high
  temperature: 0.1
  max_tokens: 1000
  thresholds:
    direct_analysis: 0.80
    pre_processing: 0.50
    azure_analysis: 0.30
    reupload: 0.30
  metrics_weights:
    blur_score: 0.25
    text_clarity: 0.20
    contrast_score: 0.15
    sharpness_score: 0.15
    overall_readability: 0.15
    brightness_score: 0.10
  processing_recommendations:
    direct_analysis: "Excellent quality - proceed with standard OCR processing"
    pre_processing: "Apply image enhancement before OCR for better results"
    azure_analysis: "Use Azure Document Intelligence for advanced OCR capabilities"
    reupload: "Poor quality detected - recommend document reupload"
ocr:
  use_azure_ocr: true
  extract_text_from_images: true
  extract_text_from_pdf: true
  extract_bounding_boxes: true
  preserve_spatial_data: true
  include_confidence_scores: true
  max_text_length: 10000
  text_truncation_strategy: start
  process_all_pages: true
  max_pages: 50
progress_tracking:
  enabled: true
  use_websocket: true
  stages:
  - upload
  - quality_analysis
  - ocr
  - classification
  - extraction
  - compliance
  - finalize
  log_detailed_progress: true
  send_progress_updates: true
document_types:
  source_file: data/document_entity_maintenance.json
  source_categories_file: data/document_categories.json
  total_documents: 37
  total_entities: 452
  total_mappings: 887
  categories:
  - id: 1
    name: Commercial Processes
  - id: 2
    name: Transport Processes
  - id: 3
    name: Border and Regulatory Processes
  - id: 4
    name: Financial Processes
  - id: 5
    name: Quality and Compliance Processes
data_categories:
- id: 1
  name: References
- id: 2
  name: Dates
- id: 3
  name: Parties
- id: 4
  name: Locations
- id: 5
  name: Identifiers
- id: 6
  name: Terms
- id: 7
  name: Amounts
- id: 8
  name: Measure
- id: 9
  name: Goods
field_types:
  mandatory:
    description: Required fields that must be present
    validation: strict
    missing_severity: critical
  optional:
    description: Fields that are nice-to-have but not required
    validation: lenient
    missing_severity: info
  conditional:
    description: Fields required based on document context
    validation: context_dependent
    missing_severity: warning
prompts:
  unified:
    system_prompt_config: |
      You are an expert AI model trained for Trade Finance document understanding.

      Your responsibilities are:
      - To classify uploaded PDF pages into one or more of the supported trade finance document types.
      - To extract defined entities from each identified document segment with bounding box, page number, and confidence.

      Follow the below rules strictly:

      Supported Document Types (37 total):
      {{comprehensive_list_of_documents}}

      Entity Extraction Weighting Rules:
      - M (Mandatory): always expected in the document.
      - O (Optional): can or cannot be in the document, but mostly available.
      - C (Conditional Mandatory): available in the document, based on the values of other entities.

      Extraction Metadata for each entity:
      - name
      - value
      - confidence (0–1)
      - page (integer)
      - bounding_box: [x1, y1, x2, y2] normalized between 0 and 1.

      Output format:
      - Always respond in JSON.
      - Maintain hierarchy: document → page range → entity list.
      - No explanatory text outside the JSON.

      Accuracy expectations:
      - Document classification ≥ 95% confidence
      - Entity extraction ≥ 0.85 confidence threshold

    functionality_prompt: |
      The uploaded document belongs to the {{function_description}}.

      Based on this context, the system expects the following document types and entity sets:

      {{function_and_document_json}}

    response_prompt: |
      Respond strictly in the following JSON structure:

      {
        "classification_results": [
          {
            "document_type": "Commercial Invoice",
            "pages": { "from": 1, "to": 3 },
            "confidence": 0.96,
            "entities": [
              {
                "name": "Invoice Number",
                "value": "INV/2025/0154",
                "confidence": 0.97,
                "page": 1,
                "bounding_box": [0.12, 0.14, 0.30, 0.18]
              },
              {
                "name": "Invoice Amount",
                "value": "USD 45,000.00",
                "confidence": 0.94,
                "page": 2,
                "bounding_box": [0.15, 0.40, 0.35, 0.45]
              }
            ]
          },
          {
            "document_type": "Bill of Lading",
            "pages": { "from": 4, "to": 6 },
            "confidence": 0.93,
            "entities": [
              {
                "name": "BL Number",
                "value": "BL-984572",
                "confidence": 0.95,
                "page": 4,
                "bounding_box": [0.10, 0.20, 0.25, 0.25]
              },
              {
                "name": "Port of Loading",
                "value": "Shanghai, China",
                "confidence": 0.90,
                "page": 5,
                "bounding_box": [0.12, 0.32, 0.28, 0.36]
              }
            ]
          }
        ],
        "summary_notes": {
          "missing_entities": ["HS Code", "Notify Party"],
          "low_confidence_entities": ["Port of Discharge"],
          "average_confidence": 0.94
        }
      }
performance:
  cache_document_mappings: true
  cache_ttl_seconds: 3600
  max_concurrent_files: 5
  max_concurrent_pages: 10
  classification_timeout: 30
  extraction_timeout: 60
  compliance_timeout: 30
  total_timeout: 180
error_handling:
  retry_on_failure: true
  max_retries: 3
  retry_delay_seconds: 2
  fallback_to_original_classifier: true
  return_partial_results: true
  log_errors: true
  log_level: INFO
api_response:
  include_ocr_text_preview: true
  ocr_preview_length: 500
  include_preview_images: true
  max_preview_images: 10
  include_processing_time: true
  include_metadata: true
  include_enhanced_mode_flag: true
  success_format:
    file_name: string
    classification:
      document_type: string
      document_code: string
      document_id: string
      confidence: float
      reasoning: string
    extraction:
      mandatory: object
      optional: object
      conditional: object
      schema: object
      document_id: string
    compliance:
      compliant: boolean
      missing_mandatory: array
      data_quality_issues: array
      warnings: array
      recommendations: array
      severity: string
      completeness: string
    preview_images: array
    processing_time: float
    ocr_text_preview: string
    ocr_data:
      total_pages: integer
      total_text_entries: integer
      pages: array
      formatted_text: string
    success: boolean
    enhanced_mode: boolean
  ocr_page_structure:
    page_number: integer
    text_entries: integer
    ocr_data:
    - text: string
      bounding_box: array[8]
      bounding_page: integer
      confidence: float
features:
  enable_enhanced_classification: true
  enable_entity_extraction: true
  enable_compliance_checking: true
  enable_progress_tracking: true
  enable_preview_images: true
  enable_ocr_caching: false
logging:
  level: INFO
  log_classification_results: true
  log_extraction_results: true
  log_compliance_results: true
  log_processing_times: true
  log_api_calls: true
